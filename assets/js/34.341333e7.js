(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{365:function(E,a,t){"use strict";t.r(a);var s=t(8),g=Object(s.a)({},(function(){var E=this,a=E._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":E.$parent.slotKey}},[a("h1",{attrs:{id:"统一网关-gateway"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#统一网关-gateway"}},[E._v("#")]),E._v(" 统一网关 Gateway")]),E._v(" "),a("h2",{attrs:{id:"为什么需要网关"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要网关"}},[E._v("#")]),E._v(" 为什么需要网关")]),E._v(" "),a("p",[E._v("服务内部有相互访问的话Feign进行调用 但是外部的请求就没有安全措施了 不是所有业务都是对外公开的 我们得对用户的身份进行验证 否则拦截")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220211222707258.png",alt:"image-20220211222707258"}})]),E._v(" "),a("p",[E._v("这里网关就出现了并且带着这些功能来了")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220211222943540.png",alt:"image-20220211222943540"}})]),E._v(" "),a("p",[E._v("网关技术实现(目前来说都会使用gateway来进行网关)")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220211223038457.png",alt:"image-20220211223038457"}})]),E._v(" "),a("h2",{attrs:{id:"搭建网关服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#搭建网关服务"}},[E._v("#")]),E._v(" 搭建网关服务")]),E._v(" "),a("p",[E._v("搭建网关服务的步骤：")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220211223143755.png",alt:"image-20220211223143755"}})]),E._v(" "),a("p",[E._v("网关自己也是服务 需要被nacos发现")]),E._v(" "),a("p",[E._v("2.编写路由配置及nacos地址")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213102823916.png",alt:"image-20220213102823916"}})]),E._v(" "),a("p",[E._v("lb:loadBalance缩写")]),E._v(" "),a("p",[E._v("当前含义： 我要把请求路由到用户服务（userservice）")]),E._v(" "),a("p",[E._v("需要一个路由规则（和nginx很像）predicates:(判断请求是否符合路由规则)")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213103047250.png",alt:"image-20220213103047250"}})]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213103205052.png",alt:"image-20220213103205052"}})]),E._v(" "),a("p",[E._v("用nginx请求会到服务上，要在服务做鉴权，网关可以先鉴权拦截，不会给服务造成太大压力")]),E._v(" "),a("p",[E._v("总结：")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213103630598.png",alt:"image-20220213103630598"}})]),E._v(" "),a("h2",{attrs:{id:"路由断言工厂route-predicate-factory"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#路由断言工厂route-predicate-factory"}},[E._v("#")]),E._v(" 路由断言工厂Route Predicate Factory")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213103724932.png",alt:"image-20220213103724932"}})]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213103813127.png",alt:"image-20220213103813127"}})]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213103821591.png",alt:"image-20220213103821591"}})]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213104011647.png",alt:"image-20220213104011647"}})]),E._v(" "),a("p",[E._v("这里的路由规则是要求在2031年之后才可以访问, 访问的话就会报404")]),E._v(" "),a("p",[E._v("使用Before的话就可以访问到了")]),E._v(" "),a("p",[E._v("这个路由工厂的规则按照需求使用不用强记")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213104231303.png",alt:"image-20220213104231303"}})]),E._v(" "),a("h2",{attrs:{id:"路由过滤器-gatewayfilter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#路由过滤器-gatewayfilter"}},[E._v("#")]),E._v(" 路由过滤器 GatewayFilter")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213104412516.png",alt:"image-20220213104412516"}})]),E._v(" "),a("p",[E._v("这里响应结果的返回过程也是可以被网关做操作再返回给用户的，例如：把响应头拿出来，把响应体弄一弄之类")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213104557062.png",alt:"image-20220213104557062"}})]),E._v(" "),a("p",[E._v("（要点：根据名字来了解过滤器工厂的功能）")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213104730096.png",alt:"image-20220213104730096"}})]),E._v(" "),a("p",[E._v("验证 在这个方法中添加一个参数 加上这个注解"),a("code",[E._v("@RequestHeader")]),E._v(" 这样spring就能帮助我们获得这个请求头的这个参数，加required可以应对没有传过来的情况")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213105007102.png",alt:""}})]),E._v(" "),a("p",[E._v("我们如果要在所有的微服务都实现这个功能(配置在某个路由下只对那个服务有效 配置在default过滤器下 对所有的服务有效)")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213105148878.png",alt:"image-20220213105148878"}})]),E._v(" "),a("p",[E._v("总结：")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213105316392.png",alt:"image-20220213105316392"}})]),E._v(" "),a("h2",{attrs:{id:"全局过滤器-globalfilter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全局过滤器-globalfilter"}},[E._v("#")]),E._v(" 全局过滤器 GlobalFilter")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213105455040.png",alt:"image-20220213105455040"}})]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213105557044.png",alt:"image-20220213105557044"}})]),E._v(" "),a("p",[E._v("(未登录的状态码是401 返回状态码为了用户体验)")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213105941410.png",alt:"image-20220213105941410"}})]),E._v(" "),a("p",[E._v("实现这个过滤器在上面加两个注解")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213110130847.png",alt:"image-20220213110130847"}})]),E._v(" "),a("p",[E._v("@Order(-1)将过滤器的位置或者说执行顺序确定")]),E._v(" "),a("p",[E._v("或者不用这个注解 实现Ordered接口 继承它的getOrder()方法 一样可以实现过滤器执行顺序的指定")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213110219399.png",alt:"image-20220213110219399"}})]),E._v(" "),a("p",[E._v("测试：")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213110345992.png",alt:"image-20220213110345992"}})]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213110405566.png",alt:"image-20220213110405566"}})]),E._v(" "),a("p",[E._v("当然实际开发的登录拦截不会说逻辑这么简单")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213110417191.png",alt:"image-20220213110417191"}})]),E._v(" "),a("p",[E._v("总结：")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213110441418.png",alt:"image-20220213110441418"}})]),E._v(" "),a("h2",{attrs:{id:"过滤器执行顺序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#过滤器执行顺序"}},[E._v("#")]),E._v(" 过滤器执行顺序")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213110756047.png",alt:"image-20220213110756047"}})]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213110952750.png",alt:"image-20220213110952750"}})]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213110915743.png",alt:"image-20220213110915743"}})]),E._v(" "),a("p",[E._v("总结：")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213111026815.png",alt:"image-20220213111026815"}})]),E._v(" "),a("h2",{attrs:{id:"跨域问题处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域问题处理"}},[E._v("#")]),E._v(" 跨域问题处理")]),E._v(" "),a("p",[E._v("所有的请求都是先经过网关再到微服务 所以跨域请求不是在每个服务处理 只需要在网关里面处理就好了")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213111337534.png",alt:"image-20220213111337534"}})]),E._v(" "),a("p",[E._v("CORS： 浏览器问下服务器能不能走这个跨域请求")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213111419665.png",alt:"image-20220213111419665"}})]),E._v(" "),a("p",[E._v("我们的ajax采用的是CORS方案 这个方案有一次询问 这个询问也是会被网关拦截的 加上 "),a("code",[E._v("add-to-simple-url-handler-mapping: true")]),E._v("可以解决询问被拦截的问题")]),E._v(" "),a("p",[E._v("加上有效期"),a("code",[E._v("maxAge")]),E._v("的设置可以让询问不要每次都执行给服务器增加压力")]),E._v(" "),a("p",[E._v("测试：")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213111751571.png",alt:"image-20220213111751571"}})]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213111806120.png",alt:"image-20220213111806120"}})]),E._v(" "),a("p",[E._v("将网关的跨域配置加上以后重启服务")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213111907615.png",alt:"image-20220213111907615"}})]),E._v(" "),a("p",[E._v("总结：")]),E._v(" "),a("p",[a("img",{attrs:{src:"/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220213111934502.png",alt:"image-20220213111934502"}})]),E._v(" "),a("p",[E._v("我们现在已经学了微服务最常用的组件了")])])}),[],!1,null,null,null);a.default=g.exports}}]);