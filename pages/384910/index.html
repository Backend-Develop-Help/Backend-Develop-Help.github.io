<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sentinel微服务保护 | 开发自救手册</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <script src="https://cdn.wwads.cn/js/makemoney.js" type="text/javascript"></script>
    <meta name="description" content="一本注重提升思维能力的开发自救手册。">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    <meta name="wwads-cn-verify" content="6c4b761a28b734fe93831e3fb400ce87">
    
    <link rel="preload" href="/assets/css/0.styles.9bcbf02c.css" as="style"><link rel="preload" href="/assets/js/app.f107c529.js" as="script"><link rel="preload" href="/assets/js/2.388f75b7.js" as="script"><link rel="preload" href="/assets/js/38.63d6e3be.js" as="script"><link rel="prefetch" href="/assets/js/10.a3a8b7e9.js"><link rel="prefetch" href="/assets/js/11.3a4b3a6f.js"><link rel="prefetch" href="/assets/js/12.4b94c69a.js"><link rel="prefetch" href="/assets/js/13.0fc92fed.js"><link rel="prefetch" href="/assets/js/14.0e142cb8.js"><link rel="prefetch" href="/assets/js/15.52ed5af4.js"><link rel="prefetch" href="/assets/js/16.d7fb812a.js"><link rel="prefetch" href="/assets/js/17.b615de32.js"><link rel="prefetch" href="/assets/js/18.10aa16c6.js"><link rel="prefetch" href="/assets/js/19.891a786d.js"><link rel="prefetch" href="/assets/js/20.dc6a720f.js"><link rel="prefetch" href="/assets/js/21.d47ab2e2.js"><link rel="prefetch" href="/assets/js/22.d0bd460c.js"><link rel="prefetch" href="/assets/js/23.af8c6314.js"><link rel="prefetch" href="/assets/js/24.0b7170dd.js"><link rel="prefetch" href="/assets/js/25.996d2c16.js"><link rel="prefetch" href="/assets/js/26.31b97e81.js"><link rel="prefetch" href="/assets/js/27.9273c2dd.js"><link rel="prefetch" href="/assets/js/28.e2987f11.js"><link rel="prefetch" href="/assets/js/29.062c29f8.js"><link rel="prefetch" href="/assets/js/3.f554136f.js"><link rel="prefetch" href="/assets/js/30.8095effc.js"><link rel="prefetch" href="/assets/js/31.f0d92c2e.js"><link rel="prefetch" href="/assets/js/32.2a0247ac.js"><link rel="prefetch" href="/assets/js/33.9a1e6a1a.js"><link rel="prefetch" href="/assets/js/34.341333e7.js"><link rel="prefetch" href="/assets/js/35.3a407794.js"><link rel="prefetch" href="/assets/js/36.d75b1111.js"><link rel="prefetch" href="/assets/js/37.27191033.js"><link rel="prefetch" href="/assets/js/39.3a70cb1f.js"><link rel="prefetch" href="/assets/js/4.aa385005.js"><link rel="prefetch" href="/assets/js/5.bb37d451.js"><link rel="prefetch" href="/assets/js/6.c033c22d.js"><link rel="prefetch" href="/assets/js/7.9d22425d.js"><link rel="prefetch" href="/assets/js/8.1e827847.js"><link rel="prefetch" href="/assets/js/9.9e0bffeb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9bcbf02c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="开发自救手册" class="logo"> <span class="site-name can-hide">开发自救手册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发认知扩展" class="dropdown-title"><a href="/pages/4d70dc/" class="link-title">开发认知扩展</a> <span class="title" style="display:none;">开发认知扩展</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java指南</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/1ba529/" class="nav-link">手册的初衷以及适用人群</a></li><li class="dropdown-subitem"><a href="/pages/4d70dc/" class="nav-link">介绍</a></li><li class="dropdown-subitem"><a href="/pages/f5ef63/" class="nav-link">JAVA涉及技术总览</a></li></ul></li><li class="dropdown-item"><h4>技术场景</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b3dd9c/" class="nav-link">线上代码覆盖率监控</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="好文分享" class="dropdown-title"><a href="/pages/3001d9/" class="link-title">好文分享</a> <span class="title" style="display:none;">好文分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/3001d9/" class="nav-link">cpp自救指南</a></li><li class="dropdown-item"><!----> <a href="/pages/771788/" class="nav-link">go指南</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面经&amp;分享" class="dropdown-title"><!----> <span class="title" style="display:;">面经&amp;分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/950801/" class="nav-link">真正的面经系列</a></li><li class="dropdown-item"><!----> <a href="/pages/384910/404" class="nav-link">经历分享</a></li><li class="dropdown-item"><h4>相关文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/88cd1f/" class="nav-link">25届实习内推</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="八股文" class="dropdown-title"><!----> <span class="title" style="display:;">八股文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/771792/" class="nav-link">微服务</a></li></ul></div></div><div class="nav-item"><a href="/pages/daa40c/" class="nav-link">友情链接</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="参与分享" class="dropdown-title"><!----> <span class="title" style="display:;">参与分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/385249/" class="nav-link">团队介绍</a></li><li class="dropdown-item"><!----> <a href="/pages/c91501/" class="nav-link">如何加入</a></li></ul></div></div> <a href="https://github.com/Backend-Develop-Help/Backend-Develop-Help.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发认知扩展" class="dropdown-title"><a href="/pages/4d70dc/" class="link-title">开发认知扩展</a> <span class="title" style="display:none;">开发认知扩展</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java指南</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/1ba529/" class="nav-link">手册的初衷以及适用人群</a></li><li class="dropdown-subitem"><a href="/pages/4d70dc/" class="nav-link">介绍</a></li><li class="dropdown-subitem"><a href="/pages/f5ef63/" class="nav-link">JAVA涉及技术总览</a></li></ul></li><li class="dropdown-item"><h4>技术场景</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b3dd9c/" class="nav-link">线上代码覆盖率监控</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="好文分享" class="dropdown-title"><a href="/pages/3001d9/" class="link-title">好文分享</a> <span class="title" style="display:none;">好文分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/3001d9/" class="nav-link">cpp自救指南</a></li><li class="dropdown-item"><!----> <a href="/pages/771788/" class="nav-link">go指南</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面经&amp;分享" class="dropdown-title"><!----> <span class="title" style="display:;">面经&amp;分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/950801/" class="nav-link">真正的面经系列</a></li><li class="dropdown-item"><!----> <a href="/pages/384910/404" class="nav-link">经历分享</a></li><li class="dropdown-item"><h4>相关文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/88cd1f/" class="nav-link">25届实习内推</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="八股文" class="dropdown-title"><!----> <span class="title" style="display:;">八股文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/771792/" class="nav-link">微服务</a></li></ul></div></div><div class="nav-item"><a href="/pages/daa40c/" class="nav-link">友情链接</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="参与分享" class="dropdown-title"><!----> <span class="title" style="display:;">参与分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/385249/" class="nav-link">团队介绍</a></li><li class="dropdown-item"><!----> <a href="/pages/c91501/" class="nav-link">如何加入</a></li></ul></div></div> <a href="https://github.com/Backend-Develop-Help/Backend-Develop-Help.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>微服务</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/771792/" class="sidebar-link">微服务介绍</a></li><li><a href="/pages/50142d/" class="sidebar-link">EureKa注册中心</a></li><li><a href="/pages/c95a2f/" class="sidebar-link">Ribbon负载均衡</a></li><li><a href="/pages/c321d3/" class="sidebar-link">Nacos注册中心、配置中心</a></li><li><a href="/pages/00990d/" class="sidebar-link">OpenFeign远程调用</a></li><li><a href="/pages/009d95/" class="sidebar-link">Gateway统一网关</a></li><li><a href="/pages/947d80/" class="sidebar-link">Docker</a></li><li><a href="/pages/s87jds/" class="sidebar-link">DockerCompose</a></li><li><a href="/pages/940163/" class="sidebar-link">RabbitMQ</a></li><li><a href="/pages/384910/" aria-current="page" class="active sidebar-link">Sentinel微服务保护</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/384910/#初识sentinel" class="sidebar-link">初识Sentinel</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/384910/#雪崩问题" class="sidebar-link">雪崩问题</a></li><li class="sidebar-sub-header level4"><a href="/pages/384910/#什么是雪崩问题" class="sidebar-link">什么是雪崩问题</a></li><li class="sidebar-sub-header level4"><a href="/pages/384910/#解决雪崩问题" class="sidebar-link">解决雪崩问题</a></li><li class="sidebar-sub-header level3"><a href="/pages/384910/#服务保护技术对比" class="sidebar-link">服务保护技术对比</a></li><li class="sidebar-sub-header level3"><a href="/pages/384910/#安装sentinel控制台" class="sidebar-link">安装Sentinel控制台</a></li><li class="sidebar-sub-header level3"><a href="/pages/384910/#整合sentinel和微服务" class="sidebar-link">整合Sentinel和微服务</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/384910/#限流规则" class="sidebar-link">限流规则</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/384910/#流控模式" class="sidebar-link">流控模式</a></li><li class="sidebar-sub-header level3"><a href="/pages/384910/#流控效果" class="sidebar-link">流控效果</a></li><li class="sidebar-sub-header level3"><a href="/pages/384910/#热点参数限流" class="sidebar-link">热点参数限流</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/384910/#隔离和降级" class="sidebar-link">隔离和降级</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/384910/#feign整合sentinel" class="sidebar-link">Feign整合Sentinel</a></li><li class="sidebar-sub-header level3"><a href="/pages/384910/#线程隔离" class="sidebar-link">线程隔离</a></li><li class="sidebar-sub-header level3"><a href="/pages/384910/#熔断降级" class="sidebar-link">熔断降级</a></li><li class="sidebar-sub-header level3"><a href="/pages/384910/#授权规则" class="sidebar-link">授权规则</a></li><li class="sidebar-sub-header level3"><a href="/pages/384910/#自定义异常结果" class="sidebar-link">自定义异常结果</a></li><li class="sidebar-sub-header level3"><a href="/pages/384910/#规则持久化" class="sidebar-link">规则持久化</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>八股文</span></li><li data-v-06225672><span data-v-06225672>微服务</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="javascript:;" data-v-06225672>ethandu</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-04-27</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Sentinel微服务保护<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="微服务保护"><a href="#微服务保护" class="header-anchor">#</a> 微服务保护</h1> <h2 id="初识sentinel"><a href="#初识sentinel" class="header-anchor">#</a> 初识Sentinel</h2> <h3 id="雪崩问题"><a href="#雪崩问题" class="header-anchor">#</a> 雪崩问题</h3> <h4 id="什么是雪崩问题"><a href="#什么是雪崩问题" class="header-anchor">#</a> 什么是雪崩问题</h4> <p>微服务之间互相调用，因为调用链中的一个服务故障，引起整个链路都无法访问的情况。</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220831193107550.png" alt="image-20220831193107550"></p> <h4 id="解决雪崩问题"><a href="#解决雪崩问题" class="header-anchor">#</a> 解决雪崩问题</h4> <p>解决雪崩问题的常见方式有四种：</p> <ul><li><p>超时处理：设定超时时间，请求超过一定时间美誉相应就返回错误信息，不会无休止等待。</p></li> <li><p>舱壁模式：限定每个业务能使用的线程数，避免耗尽整个tomcat的资源，因此也叫<strong>线程隔离</strong>。</p></li> <li><p>熔断降级：由<strong>断路器</strong>统计业务执行的一场比例，如果超出阈值则会<strong>熔断</strong>该业务，拦截访问该业务的一切请求。</p></li> <li><p>流量控制：限制业务访问的QPS（每秒钟处理请求的数量）。避免服务因流量的徒增而故障。</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220831194047046.png" alt="image-20220831194047046"></p></li></ul> <blockquote><p>流量控制是预防雪崩，前面三种是已经出现问题了。</p></blockquote> <h3 id="服务保护技术对比"><a href="#服务保护技术对比" class="header-anchor">#</a> 服务保护技术对比</h3> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220831195551526.png" alt="image-20220831195551526"></p> <blockquote><p>Hystrix现在不维护了</p></blockquote> <p>Sentinel是alibaba开源的一款微服务流量控制组件。</p> <p>Sentinel具有以下特征：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220831200039551.png" alt="image-20220831200039551"></p> <h3 id="安装sentinel控制台"><a href="#安装sentinel控制台" class="header-anchor">#</a> 安装Sentinel控制台</h3> <p>去下载最新的jar包。</p> <p>https://github.com/alibaba/Sentinel</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220831201309612.png" alt="image-20220831201309612"></p> <p>执行命令：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">java</span> <span class="token parameter variable">-jar</span> sentinel-dashboard-1.8.5.jar
</code></pre></div><p>然后访问：localhost:8080 即可看到控制台界面，默认账户密码都是sentinel。</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220831201507442.png" alt="image-20220831201507442"></p> <p>如果要修改Sentinel的默认端口，账户，密码 可以通过下列配置：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220831201625154.png" alt="image-20220831201625154"></p> <p>举例：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">java</span> <span class="token parameter variable">-jar</span> sentinel-dashboard-1.8.5.jar <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token number">8090</span>
</code></pre></div><h3 id="整合sentinel和微服务"><a href="#整合sentinel和微服务" class="header-anchor">#</a> 整合Sentinel和微服务</h3> <blockquote><p>引入cloud-demo，项目结构如下：</p></blockquote> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913124023376.png" alt="image-20220913124023376"></p> <blockquote><p>微服务整合Sentinel</p></blockquote> <p>我们在order-service中整合Sentinel，并且链接Sentinel的控制台，步骤如下：</p> <ol><li><p>引入sentinel依赖：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>配置控制台地址：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">transport</span><span class="token punctuation">:</span>
        <span class="token key atrule">dashboard</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span>
</code></pre></div></li> <li><p>访问微服务的任意端点（endpoint，我们Spring MVC的任意一个Controller的接口都是一个端点），触发sentinel监控</p></li></ol> <p>访问过一次接口之后再看我们的控制台，就出现结果了。</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913125146196.png" alt="image-20220913125146196"></p> <h2 id="限流规则"><a href="#限流规则" class="header-anchor">#</a> 限流规则</h2> <blockquote><p>首先我们需要知道一个概念：</p></blockquote> <blockquote><p><strong>簇点链路</strong></p></blockquote> <p>簇点链路:就是项目内的调用链路，链路中被监控的每个接口就是一个资源。默认情况下sentinel会监控Spring MVC的每一个端点(Endpoint) ，因此Spring MVC的每一 个端 点(Endpoint)就是调用链路中的一个资源。</p> <p>流控、熔断等都是针对簇点链路中的资源来设置的，因此我们可以点击对应资源后面的按钮来设置规则:</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913125604325.png" alt="image-20220913125604325"></p> <p>如果我们点击资源/order/{orderId}后面的流控按钮，就可以弹出表单。表单中可以添加流控规则。</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913125738241.png" alt="image-20220913125738241"></p> <p>其含义是限制/order/{orderId}这个资源的单机QPS为1，即每秒值允许1次请求，超出的请求会被拦截并报错。</p> <ul><li><blockquote><p>案例</p> <p>需求:给/order/{orderld}这个资源设置流控规则，QPS不能超过5。然后利用jemeter测试。</p></blockquote> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913125936782.png" alt="image-20220913125936782"></p> <p>创建完成规则后我们使用Jemeter进行测试</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913130206387.png" alt="image-20220913130206387"></p> <p>接着看结果，限流的控制生效了！</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913130113975.png" alt="image-20220913130113975"></p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913130122352.png" alt="image-20220913130122352"></p></li></ul> <h3 id="流控模式"><a href="#流控模式" class="header-anchor">#</a> 流控模式</h3> <p>在添加限流规则时，点击高级选项，可以选择三种流控模式:</p> <ul><li>直接:统计当前资源的请求，触发阈值时对当前资源直接限流，也是默认的模式</li> <li>关联:统计与当前资源相关的另一个资源，触发阈值时，对当前资源限流</li> <li>链路:统计从指定链路访问到本资源的请求,触发阈值时,对指定链路限流</li></ul> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913130312814.png" alt="image-20220913130312814"></p> <ul><li><blockquote><p>流控模式 - 关联</p></blockquote> <ul><li>关联模式:统计与当前资源相关的另一个资源，触发阈值时,对当前资源限流</li> <li>使用场景:比如用户支付时需要修改订单状态，同时用户要查询订单。查询和修改操作会争抢数据库锁，产生竞争。
业务需求是有限支付和更新订单的业务，因此当修改订单业务触发阈值时,需要对查询订单业务限流。</li></ul> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913130533784.png" alt="image-20220913130533784"></p> <p>当/write资源访问量触发阈值时，就会对/read资源限流，避免影响/write资源。</p> <ul><li><blockquote><p>案例</p> <p>需求:</p> <ul><li>在OrderController新建 两个端点/order/query和/order/update, 无需实现业务</li> <li>配置流控规则，当/order/ update资源被访问的QPS超过5时，对/order/ query请求限流</li></ul></blockquote> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913130848482.png" alt="image-20220913130848482"></p> <p>我们对用Jemeter对/order/update进行QPS大于5的请求，查看结果：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913130923292.png" alt="image-20220913130923292"></p></li> <li><blockquote><p>什么时候使用关联模式？</p></blockquote> <ul><li>两个有竞争关系的资源</li> <li>一个优先级高，一个优先级低</li></ul></li></ul></li> <li><blockquote><p>流控模式 - 链路</p></blockquote> <p>链路模式:只针对从指定链路访问到本资源的请求做统计,判断是否超过阈值。
例如有两条请求链路:</p> <ul><li>/test1→/common</li> <li>/test2 →/common</li></ul> <p>如果只希望统计从/test2进入到/common的请求，则可以这样配置:</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913131332366.png" alt="image-20220913131332366"></p> <ul><li><blockquote><p>案例</p> <p>需求:有查询订单和创建订单业务,两者都需要查询商品。针对从查询订单进入到查询商品的请求统计,并设置限流。</p></blockquote> <ol><li>在OrderService中添加一个queryGoods方法,不用实现业务</li> <li>在OrderController中 ，改造/order/query端点，调用OrderService中的queryGoods方法</li> <li>在OrderController中 添加一个/order/save的端 点，调用OrderService的queryGoods方法</li> <li>给queryGoods设 置限流规则，从/order/query进 入queryGoods的方法限制QPS必须小于2</li></ol> <p>设定规则</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913140417661.png" alt="image-20220913140417661"></p> <p>用Jemeter请求，我们的save不受任何影响。</p></li> <li><blockquote><p>Sentinel默认只标记Controller中的方法为资源，如果要标记其他方法，需要利用@SentinelResource注解</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span><span class="token string">&quot;goods&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">queryGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;查询商品&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Sentinel默认会将Controller方法做context整合，导致链路模式的流控失效，需要修改application.yml，添加配置：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">web-context-unify</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 关闭context整合</span>
</code></pre></div><p>这样之后即便是Service层也可以被监控了。</p></li></ul></li></ul> <h3 id="流控效果"><a href="#流控效果" class="header-anchor">#</a> 流控效果</h3> <p>流控效果是指请求达到流控阈值时应该采取的措施，包括三种:</p> <ul><li>快速失败: 达到阈值后,新的请求会被立即拒绝并抛出FlowException异常。是默认的处理方式。</li> <li>warm up:预热模式，对超出阈值的请求同样是拒绝并抛出异常。但这种模式阈值会动态变化,从一个较小值逐渐增
加到最大阈值。</li> <li>排队等待:让所有的请求按照先后次序排队执行,两个请求的间隔不能小于指定时长</li></ul> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913151326814.png" alt="image-20220913151326814"></p> <ul><li><blockquote><p>流控效果 - warm up</p> <p>在服务刚启动的时候不能就把QPS给打满了</p></blockquote> <p>warm up也叫预热模式，是应对服务冷启动的一种方案。请求阈值初始值是threshold / coldFactor,持续指定时长后,逐渐提高到threshold值。而coldFactor的默认值是3.</p> <p>例如，我设置QPS的threshold为10，预热时间为5秒,那么初始阈值就是10/3,也就是3,然后在5秒后逐渐增长到10.</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913151601401.png" alt="image-20220913151601401"></p> <ul><li><blockquote><p>案例</p> <p>需求:给/order/{orderld}这个资源设置限流，最大QPS为10, 利用warm up效果,预热时长为5秒</p></blockquote> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913151650293.png" alt="image-20220913151650293"></p> <p>QPS是波动变化的</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913151708766.png" alt="image-20220913151708766"></p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913151724359.png" alt="image-20220913151724359"></p></li></ul></li> <li><blockquote><p>流控效果 - 排队等待</p></blockquote> <p>当请求超过QPS阈值时，快速失败和warm up会拒绝新的请求并抛出异常。而排队等待则是让所有请求进入- -个队列中,然后按照阈值允许的时间间隔依次执行。后来的请求必须等待前面执行完成，如果请求预期的等待时间超出最大时长,则会被拒绝。
例如: QPS=5,意味着每200ms处理一个队列中的请求; timeout = 2000,意味着预期等待超过2000ms的请求会被拒绝并抛出异常</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913151917628.png" alt="image-20220913151917628"></p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913151943807.png" alt="image-20220913151943807"></p> <ul><li><blockquote><p>案例</p> <p>流控效果 - 排队等待</p> <p>需求:给/order/{orderld}这 个资源设置限流，最大QPS为10,利用排队的流控效果，超时时长设置为5s</p></blockquote> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913152048294.png" alt="image-20220913152048294"></p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913152437202.png" alt="image-20220913152437202"></p> <p>我们的发送QPS是15，然后多出来的都进入到队列里面去了。</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913152453176.png" alt="image-20220913152453176"></p> <p>最终呈现出来的是非常平稳的QPS，形成了对微服务的保护。</p></li></ul></li></ul> <h3 id="热点参数限流"><a href="#热点参数限流" class="header-anchor">#</a> 热点参数限流</h3> <blockquote><p>前面的都是常见的，这个是特殊的。</p></blockquote> <p>之前的限流是统计访问某个资源的所有请求,判断是否超过QPS阈值。而热点参数限流是分别统计参数值相同的请求,判断是否超过QPS阈值。</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913153110310.png" alt="image-20220913153110310"></p> <ul><li><blockquote><p>配置示例：</p></blockquote> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913153130409.png" alt="image-20220913153130409"></p> <p>代表的含义是:对hot这个资源的0号参数(第一个参数)做统计,每1秒相同参数值的请求数不能超过5</p></li></ul> <blockquote><p>商品是有热点商品的，所以限流阈值不应该是一样的</p></blockquote> <p>在热点参数限流的高级选项中，可以对部分参数设置例外配置：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913153349541.png" alt="image-20220913153349541"></p> <p>结合上一个配置,这里的含义是对0号的long类型参数限流,每1秒相同参数的QPS不能超过5,有两个例外:</p> <ul><li><p>如果参数值是100,则每1秒允许的QPS为10</p></li> <li><p>如果参数值是101,则每1秒允许的QPS为15</p></li> <li><blockquote><p>案例</p> <p>给/order/{orderld}这个资源添加热点参数限流，规则如下:</p> <ul><li>默认的热点参数规则是每1秒请求量不超过2</li> <li>给102这 个参数设置例外:每1秒请求量不超过4</li> <li>给103这个参数设置例外:每1秒请求量不超过10</li></ul></blockquote> <blockquote><p>注意：</p> <p>热点参数限流对默认的SpringMVC资源无效</p></blockquote> <p>我们将它覆盖成Sentinel资源</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913153612818.png" alt="image-20220913153612818"></p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913153704090.png" alt="image-20220913153704090"></p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913153753470.png" alt="image-20220913153753470"></p> <p>添加完规则，进行Jemeter测试</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913153846851.png" alt="image-20220913153846851"></p> <p>==不同的参数，限流的上限是不一样的。热点参数限流是一种更细粒度的限流==</p></li></ul> <h2 id="隔离和降级"><a href="#隔离和降级" class="header-anchor">#</a> 隔离和降级</h2> <blockquote><p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923131555481.png" alt="image-20220923131555481"></p></blockquote> <p>虽然限流可以尽量避免因高并发而引起的服务故障,但服务还会因为其它原因而故障。而要将这些故障控制在一定范围，避免雪崩,就要靠线程隔离(舱壁模式)和熔断降级手段了。</p> <p>线程隔离：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913154252397.png" alt="image-20220913154252397"></p> <p>熔断：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220913154235612.png" alt="image-20220913154235612"></p> <h3 id="feign整合sentinel"><a href="#feign整合sentinel" class="header-anchor">#</a> Feign整合Sentinel</h3> <blockquote><p>不管是线程隔离还是熔断降级，都是对客户端（调用方）的保护</p> <p>而调用方是Feign，于是实际上是对Feign的保护。</p></blockquote> <ul><li><blockquote><p>Feign整合Sentinel</p></blockquote> <p>SpringCloud中，微服务调用都是通过Feign来实现的，因此做客户端必须整合Feign和Sentinel</p> <p>首先的准备：</p> <ol><li><p>修改OrderService的application.yml文件，<strong>开启Feign的Sentinel功能</strong></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">feign</span><span class="token punctuation">:</span>
  <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
    <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 开启Feign的Sentinel功能</span>
</code></pre></div></li> <li><p>给FeignClient编写失败后的降级逻辑</p> <ul><li>方式一：FallbackClass，无法对远程调用的异常做处理</li> <li>方式二：FallbackFactory，可以对远程调用的异常做处理，我们选择这种</li></ul></li></ol> <p>步骤一：在feign-api项目中定义类，<strong>实现FallbackFactory:</strong></p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923130625293.png" alt="image-20220923130625293"></p> <blockquote><p>create方法返回的就是UserClient对象，实现方法的过程中就是在编写备用的方案。记录日志，返回友好提示啊之类的。这个就是一个失败降级的业务逻辑了。</p></blockquote> <p>步骤二:在feing- api项目中的DefaultFeignConfiguration类中<strong>将UserClientFallbackFactory注册为一个Bean:</strong></p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923130939462.png" alt="image-20220923130939462"></p> <p>步骤三:在feing-api项目中的UserClient接口中<strong>使用UserClientFallbackFactory:</strong></p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923130958536.png" alt="image-20220923130958536"></p> <p>最后我们访问一下接口，这下链路就出来了。其中出现了Feign的请求接口，这下，我们就完成了Feign和Sentinel的整合了。</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923131431070.png" alt="image-20220923131431070"></p></li></ul> <h3 id="线程隔离"><a href="#线程隔离" class="header-anchor">#</a> 线程隔离</h3> <blockquote><p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923143632484.png" alt="image-20220923143632484"></p></blockquote> <blockquote><p>线程隔离有两种方式实现:</p></blockquote> <ul><li><p><strong>线程池隔离</strong></p> <ul><li><blockquote><p>优点</p></blockquote> <ul><li>支持主动超时</li> <li>支持异步调用</li></ul></li> <li><blockquote><p>缺点</p></blockquote> <ul><li>线程的额外开销比较大</li></ul></li> <li><blockquote><p>场景</p></blockquote> <ul><li>低扇出</li></ul></li></ul></li> <li><p><strong>信号量隔离</strong>(Sentinel默认采用)</p></li> <li><blockquote><p>优点</p></blockquote> <ul><li>轻量级，无额外开销</li></ul></li> <li><blockquote><p>缺点</p></blockquote> <ul><li>不支持主动超时</li> <li>不支持异步调用</li></ul></li> <li><blockquote><p>场景</p></blockquote> <ul><li>高频调用</li> <li>高扇出（网关就是这样的场景）</li></ul></li> <li><blockquote><p>线程池隔离（左），信号量隔离（右）</p></blockquote></li></ul> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923131759662.png" alt="image-20220923131759662"></p> <ul><li><blockquote><p>Sentinel如何实现线程隔离？</p></blockquote> <p>在添加限流规则时，可以选择两种阈值类型:</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923143225183.png" alt="image-20220923143225183"></p> <ul><li>QPS: 就是每秒的请求数，在快速入门中已经演示过。</li> <li>线程数：是改资源能够使用的tomcat线程数的最大值。也就是通过限制线程数量，实现<strong>舱壁模式</strong>。</li></ul></li> <li><blockquote><p>案例：</p> <p>需求:给UserClient的查询用户接口设置流控规则，线程数不能超过2。然后利用jemeter测试。</p></blockquote> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923143420099.png" alt="image-20220923143420099"></p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923143441768.png" alt="image-20220923143441768"></p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923143506668.png" alt="image-20220923143506668"></p> <p>前面的请求实际上都是正常的，后面多于2的请求就降级了。这个就实现了信号量的隔离。</p></li></ul> <h3 id="熔断降级"><a href="#熔断降级" class="header-anchor">#</a> 熔断降级</h3> <blockquote><p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923145146063.png" alt="image-20220923145146063"></p></blockquote> <p>熔断降级是解决雪崩问题的重要手段。其思路是由断路器统计服务调用的异常比例、慢请求比例，如果超出阈值则会熔断该服务。即拦截访问该服务的一切请求;而当服务恢复时，断路器会放行访问该服务的请求。</p> <blockquote><p>它是使用状态机来实现的。</p></blockquote> <blockquote><p>Sentinel里面断路器的3个状态，以及切换的流程和作用</p></blockquote> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923143806040.png" alt="image-20220923143806040"></p> <blockquote><p><strong>熔断策略-慢调用</strong></p></blockquote> <p>断路器熔断策略有三种:慢调用、异常比例、异常数</p> <ul><li><p>慢调用:<strong>业务的响应时长(RT)大于指定时长的请求认定为慢调用请求</strong>。在指定时间内，如果请求数量超过设定的
最小数量，慢调用比例大于设定的阈值，则触发熔断。例如:</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923144006088.png" alt="image-20220923144006088"></p> <blockquote><p>解读: RT超过500ms的调用是慢调用，统计最近10000ms内的请求,如果请求量超过10次，并且慢调用比例不低于0.5
则触发熔断，熔断时长为5秒。然后进入half-open状态,放行一次请求做测试。</p></blockquote></li> <li><blockquote><p>案例：</p> <p>需求:给UserClient的查询用户接口设置降级规则，慢调用的RT阈值为50ms,统计时间为1秒,最小请求数量为5,失败阈值比例为0.4,熔断时长为5
提示:为了触发慢调用规则，我们需要修改UserService中的业务,增加业务耗时:</p></blockquote> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923144208687.png" alt="image-20220923144208687"></p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923144505707.png" alt="image-20220923144505707"></p> <p>我们先刷5次/order/1，然后再看/order/2</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923144614238.png" alt="image-20220923144614238"></p> <p>发现已经熔断了。这个就是慢比例熔断了。</p></li></ul> <blockquote><p>熔断策略-异常比例、异常数</p></blockquote> <p>断路器熔断策略有三种:慢调用、异常比例或异常数</p> <ul><li><p>异常比例或异常数:统计指定时间内的调用，如果调用次数超过指定请求数,并且出现异常的比例达到设定的比例阈
值(或超过指定异常数) ,则触发熔断。例如:</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923144723285.png" alt="image-20220923144723285"><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923144759941.png" alt="image-20220923144759941"></p> <blockquote><p>解读:统计最近1000ms内的请求,如果请求量超过10次,并且异常比例不低于0.5,则触发熔断,熔断时长为5秒。然后进入half-open状态，放行一-次请 求做测试。</p></blockquote></li> <li><blockquote><p>案例：</p> <p>需求:给UserClient的查询用户接口设置降级规则，统计时间为1秒,最小请求数量为5,失败阈值比例为0.4,熔断时长为5s</p> <p>提示:为了触发异常统计,我们需要修改UserService中的业务,抛出异常:</p></blockquote> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923144839350.png" alt="image-20220923144839350"></p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923145006379.png" alt="image-20220923145006379"></p> <p>我们刷了5次异常的102，再访问103。出发了异常比例降级。</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923145107080.png" alt="image-20220923145107080"></p></li></ul> <h3 id="授权规则"><a href="#授权规则" class="header-anchor">#</a> 授权规则</h3> <blockquote><p>对请求者身份的判断</p></blockquote> <p>授权规则可以对<strong>调用方的来源做控制</strong>，有白名单和黑名单两种方式。</p> <ul><li><p>白名单:来源(origin)在白名单内的调用者允许访问</p></li> <li><p>黑名单:来源(origin) 在黑名单内的调用者不允许访问</p></li></ul> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923145322780.png" alt="image-20220923145322780"></p> <p>例如，我们只限定允许从网关来的请求访问order-service，那么流控应用中就填写网关的名称</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923145435568.png" alt="image-20220923145435568"></p> <p>Sentinel是通过RequestOriginParser这个接口的parseOrigin来获取请求的来源的。</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923145546980.png" alt="image-20220923145546980"></p> <p>我们需要自己编写这个业务逻辑。</p> <p>例如，我们尝试从request中获取一个名为origin的请娘娘球头，作为origin的值：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923145655313.png" alt="image-20220923145655313"></p> <p>我们还需要在gateway服务中，利用网关的过滤器添加名为gateway的origin头：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923145747672.png" alt="image-20220923145747672"></p> <p>给/order/{orderId}配置授权规则：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923145813126.png" alt="image-20220923145813126"></p> <h3 id="自定义异常结果"><a href="#自定义异常结果" class="header-anchor">#</a> 自定义异常结果</h3> <blockquote><p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923150742983.png" alt="image-20220923150742983"></p></blockquote> <p>默认情况下，发生限流、降级、授权拦截时，都会抛出异常到调用方。如果要自定义异常时的返回结果，需要实现BlockExceptionHandler接口：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923150157974.png" alt="image-20220923150157974"></p> <p>而BlockException包含很多个子类，分别对应不同的场景:</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923150254983.png" alt="image-20220923150254983"></p> <p>我们在order-service中定义类，实现BlockExceptionHandler接口：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923150325418.png" alt="image-20220923150325418"></p> <p>测试：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923150650180.png" alt="image-20220923150650180"></p> <p>可以看到被限流了：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923150657913.png" alt="image-20220923150657913"></p> <h3 id="规则持久化"><a href="#规则持久化" class="header-anchor">#</a> 规则持久化</h3> <blockquote><p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923152156519.png" alt="image-20220923152156519"></p></blockquote> <blockquote><p>这章学习如何让Sentinel的规则持久化</p></blockquote> <p>Sentinel的控制台规则管理有三种模式：</p> <ul><li><p>原始模式（不支持持久化）</p> <p>Sentinel的默认模式，将规则保存在内存，重启服务会丢失</p></li> <li><p>pull模式(存在处理一致性问题)</p> <p>pull模式:控制台将配置的规则推送到Sentinel客户端，而客户端会将配置规则保存在本地文件或数据库中。以后会定时去本地文件或数据库中查询，更新本地规则。</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923151012266.png" alt="image-20220923151012266"></p></li> <li><p>push模式（我们最推荐的）</p> <p>push模式:控制台将配置规则推送到远程配置中心，例如Nacos。 Sentinel客 户端监听Nacos,获取配置变更的推送消息，完成本地配置更新。</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923151130897.png" alt="image-20220923151130897"></p> <blockquote><p>实现push模式</p></blockquote> <p>push模式实现最为复杂，依赖于nacos, 并且需要修改Sentinel控制台源码。</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923152333777.png" alt="image-20220923152333777"></p> <p>我们需要修改OrderService，让其监听Nacos中的sentinel规则配置。</p> <p>具体步骤如下：</p> <ul><li><p>一、修改order-service服务</p> <ol><li><p>引入依赖</p> <p>在order-service中引入sentinel监听nacos的依赖：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923152535486.png" alt="image-20220923152535486"></p></li> <li><p>配置nacos地址</p> <p>在order-service中的application.yml文件配置nacos地址及监听的配置信息:</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923152605140.png" alt="image-20220923152605140"></p></li></ol></li> <li><p>二、修改sentinel-dashboard源码</p> <p>SentinelDashboard默认不支持nacos的持久化，需要修改源码</p> <ol><li><p>解压并打开项目</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923152912167.png" alt="image-20220923152912167"></p></li> <li><p>修改nacos依赖</p> <p>在sentinel-dashboard源码的pom文件中，nacos的依赖默认的scope是test，只能在测试时使用，这里要去除：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923153014419.png" alt="image-20220923153014419"></p> <p>将sentinel-datasource-nacos依赖的scope去掉：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923153100997.png" alt="image-20220923153100997"></p></li> <li><p>添加nacos支持</p> <p>在sentinel-dashboard的test包下，已经编写了对nacos的支持，我们需要将其拷贝到main下。</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923153422725.png" alt="image-20220923153422725"></p></li> <li><p>修改nacos地址</p> <p>然后，还需要修改测试代码中的NacosConfig类：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923154138371.png" alt="image-20220923154138371"></p> <p>修改其中的nacos地址，让其读取application.properties中的配置：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923154229866.png" alt="image-20220923154229866"></p> <p>在sentinel-dashboard的application.properties中添加nacos地址配置：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code>nacos.addr=localhost<span class="token punctuation">:</span><span class="token number">8848</span>
</code></pre></div></li> <li><p>配置nacos数据源</p> <p>另外，还需要修改com.alibaba.csp.sentinel.dashboard.controller.v2包下的FlowControllerV2类。</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923154420808.png" alt="image-20220923154420808"></p> <p>让我们添加的Nacos数据源生效：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923154443390.png" alt="image-20220923154443390"></p></li> <li><p>修改前端页面</p> <p>接下来，还需要修改前端页面，添加一个支持nacos的菜单</p> <p>修改src/amin/webapp/resources/app/scripts/directives/sidebar/目录下的sidebar.html文件：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923154504714.png" alt="image-20220923154504714"></p> <p>将其中的这部分注释打开：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923154650957.png" alt="image-20220923154650957"></p> <p>修改其中的文本：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923154705033.png" alt="image-20220923154705033"></p></li> <li><p>重新编译、打包项目</p> <p>运行IDEA中的maven插件，编译和打包修改好的Sentinel-Dashboard：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923155538464.png" alt="image-20220923155538464"></p> <p>在sentinel中新增限流规则：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923160353152.png" alt="image-20220923160353152"></p></li></ol> <p>在nacos中寻找一下：</p> <p><img src="/img/ethandu/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud+%E5%BE%AE%E6%9C%8D%E5%8A%A1.assets/image-20220923160142097.png" alt="image-20220923160142097"></p> <p>重启发现已经实现了持久化。</p></li></ul></li></ul></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/05/02, 13:47:32</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/940163/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">RabbitMQ</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/940163/" class="prev">RabbitMQ</a></span> <!----></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="https://github.com/Backend-Develop-Help/Backend-Develop-Help.github.io" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2024
    <span>Backend Development | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f107c529.js" defer></script><script src="/assets/js/2.388f75b7.js" defer></script><script src="/assets/js/38.63d6e3be.js" defer></script>
  </body>
</html>
