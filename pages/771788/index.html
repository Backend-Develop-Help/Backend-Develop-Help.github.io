<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>go语言开发 | 开发自救手册</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <script src="https://cdn.wwads.cn/js/makemoney.js" type="text/javascript"></script>
    <meta name="description" content="一本注重提升思维能力的开发自救手册。">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    <meta name="wwads-cn-verify" content="6c4b761a28b734fe93831e3fb400ce87">
    
    <link rel="preload" href="/assets/css/0.styles.9bcbf02c.css" as="style"><link rel="preload" href="/assets/js/app.f107c529.js" as="script"><link rel="preload" href="/assets/js/2.388f75b7.js" as="script"><link rel="preload" href="/assets/js/17.b615de32.js" as="script"><link rel="prefetch" href="/assets/js/10.a3a8b7e9.js"><link rel="prefetch" href="/assets/js/11.3a4b3a6f.js"><link rel="prefetch" href="/assets/js/12.4b94c69a.js"><link rel="prefetch" href="/assets/js/13.0fc92fed.js"><link rel="prefetch" href="/assets/js/14.0e142cb8.js"><link rel="prefetch" href="/assets/js/15.52ed5af4.js"><link rel="prefetch" href="/assets/js/16.d7fb812a.js"><link rel="prefetch" href="/assets/js/18.10aa16c6.js"><link rel="prefetch" href="/assets/js/19.891a786d.js"><link rel="prefetch" href="/assets/js/20.dc6a720f.js"><link rel="prefetch" href="/assets/js/21.d47ab2e2.js"><link rel="prefetch" href="/assets/js/22.d0bd460c.js"><link rel="prefetch" href="/assets/js/23.af8c6314.js"><link rel="prefetch" href="/assets/js/24.0b7170dd.js"><link rel="prefetch" href="/assets/js/25.996d2c16.js"><link rel="prefetch" href="/assets/js/26.31b97e81.js"><link rel="prefetch" href="/assets/js/27.9273c2dd.js"><link rel="prefetch" href="/assets/js/28.e2987f11.js"><link rel="prefetch" href="/assets/js/29.062c29f8.js"><link rel="prefetch" href="/assets/js/3.f554136f.js"><link rel="prefetch" href="/assets/js/30.8095effc.js"><link rel="prefetch" href="/assets/js/31.f0d92c2e.js"><link rel="prefetch" href="/assets/js/32.2a0247ac.js"><link rel="prefetch" href="/assets/js/33.9a1e6a1a.js"><link rel="prefetch" href="/assets/js/34.341333e7.js"><link rel="prefetch" href="/assets/js/35.3a407794.js"><link rel="prefetch" href="/assets/js/36.d75b1111.js"><link rel="prefetch" href="/assets/js/37.27191033.js"><link rel="prefetch" href="/assets/js/38.63d6e3be.js"><link rel="prefetch" href="/assets/js/39.3a70cb1f.js"><link rel="prefetch" href="/assets/js/4.aa385005.js"><link rel="prefetch" href="/assets/js/5.bb37d451.js"><link rel="prefetch" href="/assets/js/6.c033c22d.js"><link rel="prefetch" href="/assets/js/7.9d22425d.js"><link rel="prefetch" href="/assets/js/8.1e827847.js"><link rel="prefetch" href="/assets/js/9.9e0bffeb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9bcbf02c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="开发自救手册" class="logo"> <span class="site-name can-hide">开发自救手册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发认知扩展" class="dropdown-title"><a href="/pages/4d70dc/" class="link-title">开发认知扩展</a> <span class="title" style="display:none;">开发认知扩展</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java指南</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/1ba529/" class="nav-link">手册的初衷以及适用人群</a></li><li class="dropdown-subitem"><a href="/pages/4d70dc/" class="nav-link">介绍</a></li><li class="dropdown-subitem"><a href="/pages/f5ef63/" class="nav-link">JAVA涉及技术总览</a></li></ul></li><li class="dropdown-item"><h4>技术场景</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b3dd9c/" class="nav-link">线上代码覆盖率监控</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="好文分享" class="dropdown-title"><a href="/pages/3001d9/" class="link-title">好文分享</a> <span class="title" style="display:none;">好文分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/3001d9/" class="nav-link">cpp自救指南</a></li><li class="dropdown-item"><!----> <a href="/pages/771788/" aria-current="page" class="nav-link router-link-exact-active router-link-active">go指南</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面经&amp;分享" class="dropdown-title"><!----> <span class="title" style="display:;">面经&amp;分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/950801/" class="nav-link">真正的面经系列</a></li><li class="dropdown-item"><!----> <a href="/pages/771788/404" class="nav-link">经历分享</a></li><li class="dropdown-item"><h4>相关文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/88cd1f/" class="nav-link">25届实习内推</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="八股文" class="dropdown-title"><!----> <span class="title" style="display:;">八股文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/771792/" class="nav-link">微服务</a></li></ul></div></div><div class="nav-item"><a href="/pages/daa40c/" class="nav-link">友情链接</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="参与分享" class="dropdown-title"><!----> <span class="title" style="display:;">参与分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/385249/" class="nav-link">团队介绍</a></li><li class="dropdown-item"><!----> <a href="/pages/c91501/" class="nav-link">如何加入</a></li></ul></div></div> <a href="https://github.com/Backend-Develop-Help/Backend-Develop-Help.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发认知扩展" class="dropdown-title"><a href="/pages/4d70dc/" class="link-title">开发认知扩展</a> <span class="title" style="display:none;">开发认知扩展</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java指南</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/1ba529/" class="nav-link">手册的初衷以及适用人群</a></li><li class="dropdown-subitem"><a href="/pages/4d70dc/" class="nav-link">介绍</a></li><li class="dropdown-subitem"><a href="/pages/f5ef63/" class="nav-link">JAVA涉及技术总览</a></li></ul></li><li class="dropdown-item"><h4>技术场景</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b3dd9c/" class="nav-link">线上代码覆盖率监控</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="好文分享" class="dropdown-title"><a href="/pages/3001d9/" class="link-title">好文分享</a> <span class="title" style="display:none;">好文分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/3001d9/" class="nav-link">cpp自救指南</a></li><li class="dropdown-item"><!----> <a href="/pages/771788/" aria-current="page" class="nav-link router-link-exact-active router-link-active">go指南</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面经&amp;分享" class="dropdown-title"><!----> <span class="title" style="display:;">面经&amp;分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/950801/" class="nav-link">真正的面经系列</a></li><li class="dropdown-item"><!----> <a href="/pages/771788/404" class="nav-link">经历分享</a></li><li class="dropdown-item"><h4>相关文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/88cd1f/" class="nav-link">25届实习内推</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="八股文" class="dropdown-title"><!----> <span class="title" style="display:;">八股文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/771792/" class="nav-link">微服务</a></li></ul></div></div><div class="nav-item"><a href="/pages/daa40c/" class="nav-link">友情链接</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="参与分享" class="dropdown-title"><!----> <span class="title" style="display:;">参与分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/385249/" class="nav-link">团队介绍</a></li><li class="dropdown-item"><!----> <a href="/pages/c91501/" class="nav-link">如何加入</a></li></ul></div></div> <a href="https://github.com/Backend-Develop-Help/Backend-Develop-Help.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>cpp自救指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/3001d9/" class="sidebar-link">C++自救指南-总览</a></li><li><a href="/pages/fe7e63/" class="sidebar-link">C++自救指南-工具篇</a></li><li><a href="/pages/9133cc/" class="sidebar-link">C++自救指南-学习路线篇</a></li><li><a href="/pages/b217bd/" class="sidebar-link">C++自救指南-方向梳理篇</a></li><li><a href="/pages/926294/" class="sidebar-link">C++自救指南-资源分享篇</a></li><li><a href="/pages/5a3138/" class="sidebar-link">C++自救指南-项目实战篇</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>go指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/771788/" aria-current="page" class="active sidebar-link">go语言开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/771788/#golang的优势" class="sidebar-link">Golang的优势</a></li><li class="sidebar-sub-header level2"><a href="/pages/771788/#golang适合做什么" class="sidebar-link">Golang适合做什么</a></li><li class="sidebar-sub-header level2"><a href="/pages/771788/#golang明星作品" class="sidebar-link">Golang明星作品</a></li><li class="sidebar-sub-header level2"><a href="/pages/771788/#golang的不足" class="sidebar-link">Golang的不足</a></li><li class="sidebar-sub-header level2"><a href="/pages/771788/#main函数初见" class="sidebar-link">main函数初见</a></li><li class="sidebar-sub-header level2"><a href="/pages/771788/#变量的声明" class="sidebar-link">变量的声明</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/771788/#多变量声明" class="sidebar-link">多变量声明：</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/771788/#常量" class="sidebar-link">常量</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/771788/#优雅的常量-iota" class="sidebar-link">优雅的常量 iota</a></li><li class="sidebar-sub-header level3"><a href="/pages/771788/#自增长" class="sidebar-link">自增长</a></li><li class="sidebar-sub-header level3"><a href="/pages/771788/#iota和表达式" class="sidebar-link">iota和表达式</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/771788/#函数" class="sidebar-link">函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/771788/#函数返回多个值" class="sidebar-link">函数返回多个值</a></li><li class="sidebar-sub-header level3"><a href="/pages/771788/#init函数与import" class="sidebar-link">init函数与import</a></li><li class="sidebar-sub-header level3"><a href="/pages/771788/#函数参数" class="sidebar-link">函数参数</a></li><li class="sidebar-sub-header level5"><a href="/pages/771788/#值传递" class="sidebar-link">值传递</a></li><li class="sidebar-sub-header level5"><a href="/pages/771788/#引用传递-指针传递" class="sidebar-link">引用传递(指针传递)</a></li><li class="sidebar-sub-header level3"><a href="/pages/771788/#匿名函数和闭包" class="sidebar-link">匿名函数和闭包</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/771788/#slice和map" class="sidebar-link">slice和map</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level4"><a href="/pages/771788/#定义切片" class="sidebar-link">定义切片</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#切片初始化" class="sidebar-link">切片初始化</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#len-和-cap-函数" class="sidebar-link">len() 和 cap() 函数</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#空-nil-切片" class="sidebar-link">空(nil)切片</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#切片截取" class="sidebar-link">切片截取</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#append-和-copy-函数" class="sidebar-link">append() 和 copy() 函数</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#map" class="sidebar-link">map</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/771788/#面向对象的特征" class="sidebar-link">面向对象的特征</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level4"><a href="/pages/771788/#方法" class="sidebar-link">方法</a></li><li class="sidebar-sub-header level5"><a href="/pages/771788/#心法" class="sidebar-link">心法</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#方法值和方法表达式" class="sidebar-link">方法值和方法表达式</a></li><li class="sidebar-sub-header level5"><a href="/pages/771788/#方法值" class="sidebar-link">方法值</a></li><li class="sidebar-sub-header level5"><a href="/pages/771788/#方法表达式" class="sidebar-link">方法表达式</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#理清楚" class="sidebar-link">理清楚</a></li><li class="sidebar-sub-header level5"><a href="/pages/771788/#receiver可以使用指针" class="sidebar-link">receiver可以使用指针</a></li><li class="sidebar-sub-header level5"><a href="/pages/771788/#如何判断receiver是否要用指针" class="sidebar-link">如何判断receiver是否要用指针</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/771788/#interface与类型断言" class="sidebar-link">interface与类型断言</a></li><li class="sidebar-sub-header level2"><a href="/pages/771788/#反射reflect" class="sidebar-link">反射reflect</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level4"><a href="/pages/771788/#编程语言中反射的概念" class="sidebar-link">编程语言中反射的概念</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#interface-和-反射" class="sidebar-link">interface 和 反射</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#golang的反射reflect" class="sidebar-link">Golang的反射reflect</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#通过reflect-value设置实际变量的值" class="sidebar-link">通过reflect.Value设置实际变量的值</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#通过reflect-valueof来进行方法的调用" class="sidebar-link">通过reflect.ValueOf来进行方法的调用</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#golang的反射reflect性能" class="sidebar-link">Golang的反射reflect性能</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#反射的基本原理" class="sidebar-link">反射的基本原理</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/771788/#结构体标签" class="sidebar-link">结构体标签</a></li><li class="sidebar-sub-header level2"><a href="/pages/771788/#go-modules" class="sidebar-link">Go Modules</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level4"><a href="/pages/771788/#a、什么是go-modules" class="sidebar-link">A、什么是Go Modules?</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#b、gopath的工作模式" class="sidebar-link">B、GOPATH的工作模式</a></li><li class="sidebar-sub-header level5"><a href="/pages/771788/#_1-wait-is-gopath" class="sidebar-link">(1) Wait is GOPATH?</a></li><li class="sidebar-sub-header level5"><a href="/pages/771788/#_2-gopath模式的弊端" class="sidebar-link">(2) GOPATH模式的弊端</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#c、go-modules模式" class="sidebar-link">C、Go Modules模式</a></li><li class="sidebar-sub-header level5"><a href="/pages/771788/#_1-go-mod命令" class="sidebar-link">(1) go mod命令</a></li><li class="sidebar-sub-header level5"><a href="/pages/771788/#_2-go-mod环境变量" class="sidebar-link">(2) go mod环境变量</a></li><li class="sidebar-sub-header level6"><a href="/pages/771788/#go111module" class="sidebar-link">GO111MODULE</a></li><li class="sidebar-sub-header level6"><a href="/pages/771788/#goproxy-2" class="sidebar-link">GOPROXY</a></li><li class="sidebar-sub-header level6"><a href="/pages/771788/#修改goproxy" class="sidebar-link">修改goproxy</a></li><li class="sidebar-sub-header level6"><a href="/pages/771788/#gosumdb" class="sidebar-link">GOSUMDB</a></li><li class="sidebar-sub-header level6"><a href="/pages/771788/#gonoproxy-gonosumdb-goprivate" class="sidebar-link">GONOPROXY/GONOSUMDB/GOPRIVATE</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#d、使用go-modules初始化项目" class="sidebar-link">D、使用Go Modules初始化项目</a></li><li class="sidebar-sub-header level5"><a href="/pages/771788/#_1-开启go-modules" class="sidebar-link">(1) 开启Go Modules</a></li><li class="sidebar-sub-header level5"><a href="/pages/771788/#_2-初始化项目" class="sidebar-link">(2) 初始化项目</a></li><li class="sidebar-sub-header level5"><a href="/pages/771788/#_3-查看go-mod文件" class="sidebar-link">(3) 查看go.mod文件</a></li><li class="sidebar-sub-header level5"><a href="/pages/771788/#_4-查看go-sum文件" class="sidebar-link">(4) 查看go.sum文件</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#e、修改模块的版本依赖关系" class="sidebar-link">E、修改模块的版本依赖关系</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/771788/#goroutine" class="sidebar-link">goroutine</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level4"><a href="/pages/771788/#协程并发" class="sidebar-link">协程并发</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#go并发" class="sidebar-link">Go并发</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#什么是goroutine" class="sidebar-link">什么是Goroutine</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#创建goroutine" class="sidebar-link">创建Goroutine</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#goroutine特性" class="sidebar-link">Goroutine特性</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#goexit函数" class="sidebar-link">Goexit函数</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/771788/#channel" class="sidebar-link">channel</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level4"><a href="/pages/771788/#定义channel变量" class="sidebar-link">定义channel变量</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#无缓冲的channel" class="sidebar-link">无缓冲的channel</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#有缓冲的channel" class="sidebar-link">有缓冲的channel</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#关闭channel" class="sidebar-link">关闭channel</a></li><li class="sidebar-sub-header level4"><a href="/pages/771788/#单向channel及应用" class="sidebar-link">单向channel及应用</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/771788/#select" class="sidebar-link">Select</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level4"><a href="/pages/771788/#select作用" class="sidebar-link">select作用</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>好文分享</span></li><li data-v-06225672><span data-v-06225672>go指南</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="javascript:;" data-v-06225672>ethandu</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-04-27</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">go语言开发<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p>https://www.yuque.com/aceld/mo95lb/haizwm</p> <h1 id="一、引言"><a href="#一、引言" class="header-anchor">#</a> 一、引言</h1> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501141628420.png" alt="image-20220501141628420"></p> <h3 id="golang生态拓展介绍-站在巨人的肩膀上"><a href="#golang生态拓展介绍-站在巨人的肩膀上" class="header-anchor">#</a> Golang生态拓展介绍“站在巨人的肩膀上”</h3> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/yuque_diagram.jpg" alt="environment"></p> <h1 id="二、go开发环境"><a href="#二、go开发环境" class="header-anchor">#</a> 二、go开发环境</h1> <h3 id="goproxy"><a href="#goproxy" class="header-anchor">#</a> GOPROXY</h3> <p>Go1.14版本之后，都推荐使用<code>go mod</code>模式来管理依赖了，也不再强制我们把代码必须写在<code>GOPATH</code>下面的<code>src</code>目录了，你可以在你电脑的任意位置编写go代码。</p> <p>默认GoPROXY配置是：<code>GOPROXY=https://proxy.golang.org,direct</code>，
由于国内访问不到 <code>https://proxy.golang.org</code> 所以我们需要换一个<code>PROXY</code>，这里推荐使用<code>https://goproxy.io</code> 或 <code>https://goproxy.cn</code>。</p> <p>可以执行下面的命令修改<code>GOPROXY</code>：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable"><span class="token variable">`</span>go <span class="token function">env</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">GOPROXY</span><span class="token operator">=</span>https://goproxy.cn,direct<span class="token variable">`</span></span>
</code></pre></div><h1 id="三、golang语言特性"><a href="#三、golang语言特性" class="header-anchor">#</a> 三、Golang语言特性</h1> <h2 id="golang的优势"><a href="#golang的优势" class="header-anchor">#</a> Golang的优势</h2> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501142220892.png" alt="image-20220501142220892"></p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501142226896.png" alt="image-20220501142226896"></p> <p>(和动态类型的js不同)</p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/1650471330308-12d4e2a3-7355-46f6-9af4-1ed10e39538e.png" alt="6-golang优势2.png"></p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501142300272.png" alt="image-20220501142300272"></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main
  
<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">goFunc</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;goroutine &quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token string">&quot; ...&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        <span class="token keyword">go</span> <span class="token function">goFunc</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">//开启一个并发协程</span>
    <span class="token punctuation">}</span>

    time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/1650471374246-adf62ac5-7eba-45c9-bcd7-ccc2f8141640.png" alt="8-golang优势3.png"></p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501142324375.png" alt="image-20220501142324375"></p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501142331358.png" alt="image-20220501142331358"></p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501142405598.png" alt="image-20220501142405598"></p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501142415251.png" alt="image-20220501142415251"></p> <h2 id="golang适合做什么"><a href="#golang适合做什么" class="header-anchor">#</a> Golang适合做什么</h2> <p><strong>(1)、云计算基础设施领域</strong></p> <p>代表项目：docker、kubernetes、etcd、consul、cloudflare CDN、七牛云存储等。</p> <p><strong>(2)、基础后端软件</strong></p> <p>代表项目：tidb、influxdb、cockroachdb等。</p> <p><strong>(3)、微服务</strong></p> <p>代表项目：go-kit、micro、monzo bank的typhon、bilibili等。</p> <p><strong>(4)、互联网基础设施</strong></p> <p>代表项目：以太坊、hyperledger等。</p> <h2 id="golang明星作品"><a href="#golang明星作品" class="header-anchor">#</a> Golang明星作品</h2> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/1650471498432-166e36fd-6294-460c-bbcd-96f6e784f8a9.png" alt="13-golang优势8.png"></p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/1650471506905-c3bf704e-d2fc-41e1-8e01-0a4907ae28fc.png" alt="14-golang优势9.png"></p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/1650471515654-27569b7e-d67a-45f6-8d8f-54bd616da975.png" alt="15-golang优势10.png"></p> <h2 id="golang的不足"><a href="#golang的不足" class="header-anchor">#</a> Golang的不足</h2> <p>1、包管理，大部分包都在<strong>github</strong>上</p> <p>2、无泛化类型</p> <p>3、所有<strong>Excepiton</strong>都用<strong>Error</strong>来处理(比较有争议)。</p> <p>4、对<strong>C</strong>的降级处理，并非无缝，没有<strong>C</strong>降级到<strong>asm</strong>那么完美(序列化问题)</p> <h1 id="四、golang语法新奇"><a href="#四、golang语法新奇" class="header-anchor">#</a> 四、Golang语法新奇</h1> <h2 id="main函数初见"><a href="#main函数初见" class="header-anchor">#</a> main函数初见</h2> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main


  <span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>


  <span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">/* 简单的程序 万能的hello world */</span>
          fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Go&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><div class="language-go extra-class"><pre class="language-go"><code>$ <span class="token keyword">go</span> run test1_hello<span class="token punctuation">.</span><span class="token keyword">go</span> 
Hello Go
$
</code></pre></div><p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501142941173.png" alt="image-20220501142941173"></p> <p>go run 表示 直接编译go语言并执行应用程序，一步完成</p> <p>你也可以先编译，然后再执行</p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501143041730.png" alt="image-20220501143041730"></p> <ul><li>第一行代码<strong>package main</strong>定义了包名。你必须在源文件中非注释的第一行指明这个文件属于哪个包，如：package main。<strong>package main表示一个可独立执行的程序，每个 Go 应用程序都包含一个名为 main 的包。</strong></li> <li>下一行**import &quot;fmt&quot;**告诉 Go 编译器这个程序需要使用 fmt 包（的函数，或其他元素），<strong>fmt 包实现了格式化 IO（输入/输出）的函数。</strong></li> <li><strong>下一行func main()是程序开始执行的函数。main 函数是每一个可执行程序所必须包含的，一般来说都是在启动后第一个执行的函数（如果有 init() 函数则会先执行该函数）。</strong></li></ul> <p><strong>注意：这里面go语言的语法，定义函数的时候，‘{’ 必须和函数名在同一行，不能另起一行。</strong>(这个按照java的规范就ok了)</p> <ul><li>下一行 /<em>...</em>/ 是注释，在程序执行时将被忽略。单行注释是最常见的注释形式，你可以在任何地方使用以 // 开头的单行注释。多行注释也叫块注释，均已以 / <em>开头，并以</em> / 结尾，且不可以嵌套使用，多行注释一般用于包的文档描述或注释成块的代码片段。</li> <li>下一行fmt.Println(...)可以将字符串输出到控制台，并在最后自动增加换行字符 \n。 使用 fmt.Print(&quot;hello, world\n&quot;) 可以得到相同的结果。 Print 和 Println 这两个函数也支持使用变量，如：fmt.Println(arr)。如果没有特别指定，它们会以默认的打印格式将变量 arr 输出到控制台。</li></ul> <h2 id="变量的声明"><a href="#变量的声明" class="header-anchor">#</a> 变量的声明</h2> <p>声明变量的一般形式是使用 var 关键字</p> <p><strong>变量声明</strong></p> <p>第一种，指定变量类型，声明后若不赋值，使用默认值0。(不赋值的话，实际上就是js的声明方式再加上type约束)</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> v_name v_type
v_name <span class="token operator">=</span> value
<span class="token keyword">package</span> main


<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>


<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> a <span class="token builtin">int</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot; = %d\n&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span>
<span class="token punctuation">}</span>


$<span class="token keyword">go</span> run test<span class="token punctuation">.</span><span class="token keyword">go</span>
a <span class="token operator">=</span> <span class="token number">0</span>
</code></pre></div><p>第二种，根据值自行判定变量类型。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> v_name <span class="token operator">=</span> value
</code></pre></div><p>第三种，省略var, 注意 :=左侧的变量不应该是已经声明过的，否则会导致编译错误。</p> <p>:=声明 go语言特产</p> <div class="language-go extra-class"><pre class="language-go"><code>v_name <span class="token operator">:=</span> value


<span class="token comment">// 例如</span>
<span class="token keyword">var</span> a <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">10</span>
c <span class="token punctuation">:</span> <span class="token operator">=</span> <span class="token number">10</span>
</code></pre></div><p>例如：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main


<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>


<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//第一种 使用默认值</span>
        <span class="token keyword">var</span> a <span class="token builtin">int</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;a = %d\n&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span>


        <span class="token comment">//第二种</span>
        <span class="token keyword">var</span> b <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">10</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;b = %d\n&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>


        <span class="token comment">//第三种 省略后面的数据类型,自动匹配类型</span>
        <span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token number">20</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;c = %d\n&quot;</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>


        <span class="token comment">//第四种 省略var关键字</span>
        d <span class="token operator">:=</span> <span class="token number">3.14</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;d = %f\n&quot;</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="多变量声明"><a href="#多变量声明" class="header-anchor">#</a> <strong>多变量声明</strong>：</h3> <p>var(</p> <p>​	a int</p> <p>​	b bool</p> <p>)</p> <p>这种写法多用于全局变量声明。并且注意中间不需要加”，“或者”；“只需要换行就好了，然后注意到，go语言好像就不需要写&quot;;&quot;</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main


<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>


<span class="token keyword">var</span> x<span class="token punctuation">,</span> y <span class="token builtin">int</span>
<span class="token keyword">var</span> <span class="token punctuation">(</span> <span class="token comment">//这种分解的写法,一般用于声明全局变量</span>
        a <span class="token builtin">int</span>
        b <span class="token builtin">bool</span>
<span class="token punctuation">)</span>


<span class="token keyword">var</span> c<span class="token punctuation">,</span> d <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span>
<span class="token keyword">var</span> e<span class="token punctuation">,</span> f <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token string">&quot;liudanbing&quot;</span>


<span class="token comment">//这种不带声明格式的只能在函数体内声明</span>
<span class="token comment">//g, h := 123, &quot;需要在func函数体内实现&quot;</span>


<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        g<span class="token punctuation">,</span> h <span class="token operator">:=</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token string">&quot;需要在func函数体内实现&quot;</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">,</span> f<span class="token punctuation">,</span> g<span class="token punctuation">,</span> h<span class="token punctuation">)</span>


        <span class="token comment">//不能对g变量再次做初始化声明</span>
        <span class="token comment">//g := 400</span>


        <span class="token boolean">_</span><span class="token punctuation">,</span> value <span class="token operator">:=</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span>  <span class="token comment">//实际上7的赋值被废弃，变量 _  不具备读特性</span>
        <span class="token comment">//fmt.Println(_) //_变量的是读不出来的</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token comment">//5</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样的写法就和python很像了！</p> <h2 id="常量"><a href="#常量" class="header-anchor">#</a> 常量</h2> <p>常量是一个简单值的标识符，在程序运行时，不会被修改的量。</p> <p>常量中的数据类型只可以是布尔型、数字型（整数型、浮点型和复数）和字符串型。</p> <p>常量的定义格式：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">const</span> identifier <span class="token punctuation">[</span><span class="token keyword">type</span><span class="token punctuation">]</span> <span class="token operator">=</span> value
</code></pre></div><p>你可以省略类型说明符 [type]，因为编译器可以根据变量的值来推断其类型。</p> <ul><li>显式类型定义：</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">const</span> b <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span>
</code></pre></div><ul><li>隐式类型定义：</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span>
</code></pre></div><p>例如：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main


<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>


<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> LENGTH <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">10</span>
   <span class="token keyword">const</span> WIDTH <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">5</span>   
   <span class="token keyword">var</span> area <span class="token builtin">int</span>
   <span class="token keyword">const</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">&quot;str&quot;</span> <span class="token comment">//多重赋值</span>


   area <span class="token operator">=</span> LENGTH <span class="token operator">*</span> WIDTH
   fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;面积为 : %d\n&quot;</span><span class="token punctuation">,</span> area<span class="token punctuation">)</span>
   <span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span>   
<span class="token punctuation">}</span>
</code></pre></div><p>以上实例运行结果为：</p> <div class="language-txt extra-class"><pre class="language-txt"><code>面积为 : 50
1 false str
</code></pre></div><p>常量还可以用作枚举：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">const</span> <span class="token punctuation">(</span>
    Unknown <span class="token operator">=</span> <span class="token number">0</span>
    Female <span class="token operator">=</span> <span class="token number">1</span>
    Male <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">)</span>
</code></pre></div><p>数字 0、1 和 2 分别代表未知性别、女性和男性。</p> <p>常量可以用len(), cap(), unsafe.Sizeof()常量计算表达式的值。常量表达式中，函数必须是内置函数，否则编译不过：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main


<span class="token keyword">import</span> <span class="token string">&quot;unsafe&quot;</span>
<span class="token keyword">const</span> <span class="token punctuation">(</span>
    a <span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span>
    b <span class="token operator">=</span> <span class="token function">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    c <span class="token operator">=</span> unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token punctuation">)</span>


<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>输出结果为：abc, 3, 16</p> <blockquote><p>unsafe.Sizeof(a)输出的结果是16 。</p> <p>字符串类型在 go 里是个结构, <strong>包含指向底层数组的指针和长度,这两部分每部分都是 8 个字节，所以字符串类型大小为 16 个字节。</strong></p></blockquote> <h3 id="优雅的常量-iota"><a href="#优雅的常量-iota" class="header-anchor">#</a> 优雅的常量 iota</h3> <p>有些概念有名字，并且有时候我们关注这些名字，甚至（特别）是在我们代码中。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">const</span> <span class="token punctuation">(</span>
    CCVisa            <span class="token operator">=</span> <span class="token string">&quot;Visa&quot;</span>
    CCMasterCard      <span class="token operator">=</span> <span class="token string">&quot;MasterCard&quot;</span>
    CCAmericanExpress <span class="token operator">=</span> <span class="token string">&quot;American Express&quot;</span>
<span class="token punctuation">)</span>
</code></pre></div><p>在其他时候，我们仅仅关注能把一个东西与其他的做区分。有些时候，有些时候一件事没有本质上的意义。比如，我们在一个数据库表中存储产品，我们可能不想以 string 存储他们的分类。我们不关注这个分类是怎样命名的，此外，该名字在市场上一直在变化。</p> <p>我们仅仅关注它们是怎么彼此区分的。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">const</span> <span class="token punctuation">(</span>
    CategoryBooks    <span class="token operator">=</span> <span class="token number">0</span>
    CategoryHealth   <span class="token operator">=</span> <span class="token number">1</span>
    CategoryClothing <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">)</span>
</code></pre></div><p>使用 0, 1, 和 2 代替，我们也可以选择 17， 43， 和 61。这些值是任意的。</p> <p>在 Go，常量有许多微妙之处。当用好了，可以使得代码非常优雅且易维护的。</p> <h3 id="自增长"><a href="#自增长" class="header-anchor">#</a> 自增长</h3> <p>在 golang 中，一个方便的习惯就是使用<code>iota</code>标示符，它简化了常量用于增长数字的定义，给以上相同的值以准确的分类。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">const</span> <span class="token punctuation">(</span>
    CategoryBooks <span class="token operator">=</span> <span class="token boolean">iota</span> <span class="token comment">// 0</span>
    CategoryHealth       <span class="token comment">// 1</span>
    CategoryClothing     <span class="token comment">// 2</span>
<span class="token punctuation">)</span>
</code></pre></div><p>(可能这种写法比较优雅吧)</p> <h3 id="iota和表达式"><a href="#iota和表达式" class="header-anchor">#</a> iota和表达式</h3> <p><strong><code>iota</code>可以做更多事情，而不仅仅是 increment。更精确地说，<code>iota</code>总是用于 increment</strong>，但是它可以用于表达式，在常量中的存储结果值。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> Allergen <span class="token builtin">int</span>


<span class="token keyword">const</span> <span class="token punctuation">(</span>
    IgEggs Allergen <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token boolean">iota</span>         <span class="token comment">// 1 &lt;&lt; 0 which is 00000001</span>
    IgChocolate                         <span class="token comment">// 1 &lt;&lt; 1 which is 00000010</span>
    IgNuts                              <span class="token comment">// 1 &lt;&lt; 2 which is 00000100</span>
    IgStrawberries                      <span class="token comment">// 1 &lt;&lt; 3 which is 00001000</span>
    IgShellfish                         <span class="token comment">// 1 &lt;&lt; 4 which is 00010000</span>
<span class="token punctuation">)</span>
</code></pre></div><p>（常量的声明中运用了iota放在表达式的写法，实际上在这个一行行声明的过程中，iota在increment，并且其它的常量都遵循这个表达式的规则。于是常量中实际存的式表达式的结果值）</p> <p>（iota的自增性质用于区分概念常量）</p> <p>这个工作是因为当你在一个<code>const</code>组中仅仅有一个标示符在一行的时候，它将使用增长的<code>iota</code>取得前面的表达式并且再运用它，。在 Go 语言的<a href="https://legacy.gitbook.com/book/aceld/how-do-go/edit#" target="_blank" rel="noopener noreferrer">spec<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中， 这就是所谓的隐性重复最后一个非空的表达式列表.</p> <p>如果你对鸡蛋，巧克力和海鲜过敏，把这些 bits 翻转到 “on” 的位置（从左到右映射 bits）。然后你将得到一个 bit 值<code>00010011</code>，它对应十进制的 19。</p> <div class="language-go extra-class"><pre class="language-go"><code>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>IgEggs <span class="token operator">|</span> IgChocolate <span class="token operator">|</span> IgShellfish<span class="token punctuation">)</span>


<span class="token comment">// output:</span>
<span class="token comment">// 19</span>
<span class="token keyword">type</span> ByteSize <span class="token builtin">float64</span>


<span class="token keyword">const</span> <span class="token punctuation">(</span>
    <span class="token boolean">_</span>           <span class="token operator">=</span> <span class="token boolean">iota</span>                   <span class="token comment">// ignore first value by assigning to blank identifier</span>
    KB ByteSize <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">*</span> <span class="token boolean">iota</span><span class="token punctuation">)</span>       <span class="token comment">// 1 &lt;&lt; (10*1)</span>
    MB                                   <span class="token comment">// 1 &lt;&lt; (10*2)</span>
    GB                                   <span class="token comment">// 1 &lt;&lt; (10*3)</span>
    TB                                   <span class="token comment">// 1 &lt;&lt; (10*4)</span>
    PB                                   <span class="token comment">// 1 &lt;&lt; (10*5)</span>
    EB                                   <span class="token comment">// 1 &lt;&lt; (10*6)</span>
    ZB                                   <span class="token comment">// 1 &lt;&lt; (10*7)</span>
    YB                                   <span class="token comment">// 1 &lt;&lt; (10*8)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>当你在把两个常量定义在一行的时候会发生什么？</p> <p>Banana 的值是什么？ 2 还是 3？ Durian 的值又是？</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">const</span> <span class="token punctuation">(</span>
    Apple<span class="token punctuation">,</span> Banana <span class="token operator">=</span> <span class="token boolean">iota</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">iota</span> <span class="token operator">+</span> <span class="token number">2</span>
    Cherimoya<span class="token punctuation">,</span> Durian
    Elderberry<span class="token punctuation">,</span> Fig
<span class="token punctuation">)</span>
</code></pre></div><p>在下一行增长，而不是立即取得它的引用。（这里说明引用的概念是可以套用的）</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// Apple: 1</span>
<span class="token comment">// Banana: 2</span>
<span class="token comment">// Cherimoya: 2</span>
<span class="token comment">// Durian: 3</span>
<span class="token comment">// Elderberry: 3</span>
<span class="token comment">// Fig: 4</span>
</code></pre></div><p>(iota是编译器编译的时候是按照行自增规则来的)</p> <h2 id="函数"><a href="#函数" class="header-anchor">#</a> 函数</h2> <h3 id="函数返回多个值"><a href="#函数返回多个值" class="header-anchor">#</a> 函数返回多个值</h3> <p>Go 函数可以返回多个值，例如：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main


<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>


<span class="token keyword">func</span> <span class="token function">swap</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> y<span class="token punctuation">,</span> x
<span class="token punctuation">}</span>


<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   a<span class="token punctuation">,</span> b <span class="token operator">:=</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token string">&quot;Mahesh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Kumar&quot;</span><span class="token punctuation">)</span>
   fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>以上实例执行结果为：</p> <p>Kumar Mahesh</p> <p>(这个swap的写法讲实话还是挺骚的。。。)</p> <p>(这个写法py好像也能写)</p> <h3 id="init函数与import"><a href="#init函数与import" class="header-anchor">#</a> init函数与import</h3> <p>首先我们看一个例子：init函数：</p> <p>init 函数可在package main中，可在其他package中，可在同一个package中出现多次。</p> <p><strong>main函数</strong></p> <p>main 函数只能在package main中。</p> <p><strong>执行顺序</strong></p> <p>golang里面有两个保留的函数：init函数（能够应用于所有的package）和main函数（只能应用于package main）。这两个函数在定义时不能有任何的参数和返回值。</p> <p>虽然一个package里面可以写任意多个init函数，但这无论是对于可读性还是以后的可维护性来说，我们都强烈建议用户在一个package中每个文件只写一个init函数。</p> <p>go程序会自动调用init()和main()，所以你不需要在任何地方调用这两个函数。每个package中的init函数都是可选的，但package main就必须包含一个main函数。</p> <p>程序的初始化和执行都起始于main包。</p> <p>如果main包还导入了其它的包，那么就会在编译时将它们依次导入。有时一个包会被多个包同时导入，那么它只会被导入一次（例如很多包可能都会用到fmt包，但它只会被导入一次，因为没有必要导入多次）。</p> <p>当一个包被导入时，如果该包还导入了其它的包，那么会先将其它包导入进来，然后再对这些包中的包级常量和变量进行初始化，接着执行init函数（如果有的话），依次类推。</p> <p>等所有被导入的包都加载完毕了，就会开始对main包中的包级常量和变量进行初始化，然后执行main包中的init函数（如果存在的话），最后执行main函数。下图详细地解释了整个执行过程：</p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501150049823.png" alt="image-20220501150049823"></p> <p>(包管理的概念，这个跟nodejs是一样的。Java的Spring则是用的ioc容器。)</p> <p>除了main包是执行完import然后是声明式然后执行init()-&gt;main()函数的逻辑</p> <p>其它的包都是执行完import然后是声明式然后是init()</p> <p>（这里的init()如果在nodeJS的概念中有可能是go自动调用的export？）</p> <p>首先我们看一个例子：</p> <p>代码结构：</p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501150432731.png" alt="image-20220501150432731"></p> <p>Lib1.go</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> InitLib1

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;lib1&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Lib2.go</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> InitLib2

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;lib2&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>main.go</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token boolean">_</span> <span class="token string">&quot;GolangTraining/InitLib1&quot;</span>
    <span class="token boolean">_</span> <span class="token string">&quot;GolangTraining/InitLib2&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;libmain init&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;libmian main&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>代码很简单，只是一些简单的输出</p> <div class="language-go extra-class"><pre class="language-go"><code>lib1
lib2
libmain init
libmian main
</code></pre></div><p>输出的顺序与我们上面图给出的顺序是一致的</p> <p><strong>那我们现在就改动一个地方，Lib1包导入Lib2，main包不管</strong></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> InitLib1

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token boolean">_</span> <span class="token string">&quot;GolangTraining/InitLib2&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;lib1&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>输出：</p> <div class="language-go extra-class"><pre class="language-go"><code>lib2
lib1
libmain init
libmian main
</code></pre></div><p>main包以及Lib1包都导入了Lib2，但是只出现一次，并且最先输出，</p> <p>==<strong>说明如果一个包会被多个包同时导入，那么它只会被导入一次，而先输出lib2是因为main包中导入Lib1时，Lib1又导入了Lib2，会首先初始化Lib2包的东西</strong>==</p> <h3 id="函数参数"><a href="#函数参数" class="header-anchor">#</a> 函数参数</h3> <p>函数如果使用参数，该变量可称为函数的形参。</p> <p>形参就像定义在函数体内的局部变量。</p> <p>调用函数，可以通过两种方式来传递参数：</p> <h5 id="值传递"><a href="#值传递" class="header-anchor">#</a> 值传递</h5> <p>值传递是指在调用函数时将实际参数复制一份传递到函数中，这样在函数中如果对参数进行修改，将不会影响到实际参数。</p> <p>默认情况下，Go 语言使用的是值传递，即在调用过程中不会影响到实际参数。</p> <p>（Java中只有值传递，只是对象（的引用）作为参数的时候传递过去的值是地址值，然后函数形参本身和对象（的引用）的地位相同，接受它的值，然后实际也是得到了对象的引用。我习惯理解成引用也是对象，值存的就是真实对象的地址值。</p> <p>而放到基本类型（包括String）来看就没这么麻烦了，就是传值（普遍意义上的）而已（传递了值得拷贝）</p> <p>）</p> <p>以下定义了 swap() 函数：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">/* 定义相互交换值的函数 */</span>
<span class="token keyword">func</span> <span class="token function">swap</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
   <span class="token keyword">var</span> temp <span class="token builtin">int</span>


   temp <span class="token operator">=</span> x <span class="token comment">/* 保存 x 的值 */</span>
   x <span class="token operator">=</span> y    <span class="token comment">/* 将 y 值赋给 x */</span>
   y <span class="token operator">=</span> temp <span class="token comment">/* 将 temp 值赋给 y*/</span>


   <span class="token keyword">return</span> temp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>接下来，让我们使用值传递来调用 swap() 函数：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main


<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>


<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">/* 定义局部变量 */</span>
   <span class="token keyword">var</span> a <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">100</span>
   <span class="token keyword">var</span> b <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">200</span>


   fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;交换前 a 的值为 : %d\n&quot;</span><span class="token punctuation">,</span> a <span class="token punctuation">)</span>
   fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;交换前 b 的值为 : %d\n&quot;</span><span class="token punctuation">,</span> b <span class="token punctuation">)</span>


   <span class="token comment">/* 通过调用函数来交换值 */</span>
   <span class="token function">swap</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>


   fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;交换后 a 的值 : %d\n&quot;</span><span class="token punctuation">,</span> a <span class="token punctuation">)</span>
   fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;交换后 b 的值 : %d\n&quot;</span><span class="token punctuation">,</span> b <span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token comment">/* 定义相互交换值的函数 */</span>
<span class="token keyword">func</span> <span class="token function">swap</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
   <span class="token keyword">var</span> temp <span class="token builtin">int</span>


   temp <span class="token operator">=</span> x <span class="token comment">/* 保存 x 的值 */</span>
   x <span class="token operator">=</span> y    <span class="token comment">/* 将 y 值赋给 x */</span>
   y <span class="token operator">=</span> temp <span class="token comment">/* 将 temp 值赋给 y*/</span>


   <span class="token keyword">return</span> temp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>以下代码执行结果为：</p> <div class="language-go extra-class"><pre class="language-go"><code>交换前 a 的值为 <span class="token punctuation">:</span> <span class="token number">100</span>



交换前 b 的值为 <span class="token punctuation">:</span> <span class="token number">200</span>



交换后 a 的值 <span class="token punctuation">:</span> <span class="token number">100</span>



交换后 b 的值 <span class="token punctuation">:</span> <span class="token number">200</span>
</code></pre></div><h5 id="引用传递-指针传递"><a href="#引用传递-指针传递" class="header-anchor">#</a> 引用传递(指针传递)</h5> <p><strong>指针</strong></p> <p>Go 语言中指针是很容易学习的，Go 语言中使用指针可以更简单的执行一些任务。</p> <p>接下来让我们来一步步学习 Go 语言指针。</p> <p><strong>我们都知道，变量是一种使用方便的占位符，用于引用计算机内存地址。</strong></p> <p>Go 语言的取地址符是 &amp;，放到一个变量前使用就会返回相应变量的内存地址。</p> <p>以下实例演示了变量在内存中地址：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main


<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>


<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">var</span> a <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">10</span>   


   fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;变量的地址: %x\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>a  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>执行以上代码输出结果为：</p> <div class="language-go extra-class"><pre class="language-go"><code>变量的地址<span class="token punctuation">:</span> 20818a220
</code></pre></div><p>现在我们已经了解了什么是内存地址和如何去访问它。接下来我们将具体介绍指针。</p> <p>引用传递是指在调用函数时将实际参数的地址传递到函数中，那么在函数中对参数所进行的修改，将影响到实际参数。</p> <p>引用传递指针参数传递到函数内，以下是交换函数 swap() 使用了引用传递：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">/* 定义交换值函数*/</span>
<span class="token keyword">func</span> <span class="token function">swap</span><span class="token punctuation">(</span>x <span class="token operator">*</span><span class="token builtin">int</span><span class="token punctuation">,</span> y <span class="token operator">*</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">var</span> temp <span class="token builtin">int</span>
   temp <span class="token operator">=</span> <span class="token operator">*</span>x    <span class="token comment">/* 保持 x 地址上的值 */</span>
   <span class="token operator">*</span>x <span class="token operator">=</span> <span class="token operator">*</span>y      <span class="token comment">/* 将 y 值赋给 x */</span>
   <span class="token operator">*</span>y <span class="token operator">=</span> temp    <span class="token comment">/* 将 temp 值赋给 y */</span>
<span class="token punctuation">}</span>
</code></pre></div><p>以下我们通过使用引用传递来调用 swap() 函数：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main


<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>


<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">/* 定义局部变量 */</span>
   <span class="token keyword">var</span> a <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">100</span>
   <span class="token keyword">var</span> b <span class="token builtin">int</span><span class="token operator">=</span> <span class="token number">200</span>


   fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;交换前，a 的值 : %d\n&quot;</span><span class="token punctuation">,</span> a <span class="token punctuation">)</span>
   fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;交换前，b 的值 : %d\n&quot;</span><span class="token punctuation">,</span> b <span class="token punctuation">)</span>


   <span class="token comment">/* 调用 swap() 函数
   * &amp;a 指向 a 指针，a 变量的地址
   * &amp;b 指向 b 指针，b 变量的地址
   */</span>
   <span class="token function">swap</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token operator">&amp;</span>b<span class="token punctuation">)</span>


   fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;交换后，a 的值 : %d\n&quot;</span><span class="token punctuation">,</span> a <span class="token punctuation">)</span>
   fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;交换后，b 的值 : %d\n&quot;</span><span class="token punctuation">,</span> b <span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token keyword">func</span> <span class="token function">swap</span><span class="token punctuation">(</span>x <span class="token operator">*</span><span class="token builtin">int</span><span class="token punctuation">,</span> y <span class="token operator">*</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">var</span> temp <span class="token builtin">int</span>
   temp <span class="token operator">=</span> <span class="token operator">*</span>x    <span class="token comment">/* 保存 x 地址上的值 */</span>
   <span class="token operator">*</span>x <span class="token operator">=</span> <span class="token operator">*</span>y      <span class="token comment">/* 将 y 值赋给 x */</span>
   <span class="token operator">*</span>y <span class="token operator">=</span> temp    <span class="token comment">/* 将 temp 值赋给 y */</span>
<span class="token punctuation">}</span>
</code></pre></div><p>(Java中由于只有传值，所以想做到和它们这种支持传址（传引用）的语言相比就麻烦些。需要用到数组等对象辅助)</p> <p>(传值就是形参获取实参的值的拷贝。传址就是形参获取实参的地址，直接对地址操作)</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//交换两个整数</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> source<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">int</span> temp <span class="token operator">=</span> source<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    source<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> source<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
    source<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="匿名函数和闭包"><a href="#匿名函数和闭包" class="header-anchor">#</a> 匿名函数和闭包</h3> <p>详细解释：</p> <p>在Go语言中匿名函数和闭包是一个概念：</p> <p><strong>闭包是可以包含自由（未绑定到特定对象）变量的代码块</strong>，这些变量不在这个代码块内或者 任何全局上下文中定义，而是在定义代码块的环境中定义。要执行的代码块（由于自由变量包含 在代码块中，所以这些自由变量以及它们引用的对象没有被释放）为自由变量提供绑定的计算环 境（作用域）。</p> <p>闭包的价值: 闭包的价值在于可以作为函数对象或者匿名函数，对于类型系统而言，这意味着不仅要表示 数据还要表示代码。支持闭包的多数语言都将函数作为第一级对象，就是说这些函数可以存储到 变量中作为参数传递给其他函数，最重要的是能够被函数动态创建和返回。(总的来说就是可以使用匿名函数返回，匿名函数层层依赖到外面的变量)</p> <p>Go语言中的闭包同样也会引用到函数外的变量。闭包的实现确保只要闭包还被使用，那么被闭包引用的变量会一直存在。</p> <p>例子：</p> <p>Go 函数可以是一个闭包。闭包是一个函数值（就是return的那个玩意），它引用了其函数体之外的变量（adder()中的sum）。该函数可以访问并赋予其引用的变量的值(sum)，换句话说，该函数（匿名的函数）被这些变量（sum）“绑定”在一起。</p> <p>例如，函数 <code>adder</code> 返回一个闭包。每个闭包都被绑定在其各自的 <code>sum</code> 变量上。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main


<span class="token keyword">func</span> <span class="token function">adder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
	sum <span class="token operator">:=</span> <span class="token number">0</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>x <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
		sum <span class="token operator">+=</span> x
		<span class="token keyword">return</span> sum
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	pos<span class="token punctuation">,</span> neg <span class="token operator">:=</span> <span class="token function">adder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">adder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>
			<span class="token function">pos</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token function">neg</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>
</code></pre></div><p>这里就可以很好的理解我们刚才的解释了，在函数addr()中，sum这个变量就被”包“在了另一个匿名函数中了。这个匿名函数就是我们上面的自由变量的概念。</p> <h2 id="slice和map"><a href="#slice和map" class="header-anchor">#</a> slice和map</h2> <p>==Go 语言切片是对数组的抽象。==</p> <p>Go 数组的长度不可改变，在特定场景中这样的集合就不太适用，Go中提供了一种灵活，功能强悍的内置类型切片<code>(&quot;动态数组&quot;)</code>,与数组相比切片的长度是不固定的，可以追加元素，在追加时可能使切片的容量增大。</p> <h4 id="定义切片"><a href="#定义切片" class="header-anchor">#</a> 定义切片</h4> <p>你可以声明一个未指定大小的数组来定义切片：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> identifier <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">type</span>
</code></pre></div><p>切片不需要说明长度。</p> <p>或使用make()函数来创建切片:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> slice1 <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">type</span> <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">type</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">)</span>


也可以简写为


slice1 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">type</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">)</span>
</code></pre></div><p>也可以指定容量，其中capacity为可选参数。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>T<span class="token punctuation">,</span> length<span class="token punctuation">,</span> capacity<span class="token punctuation">)</span>
</code></pre></div><p>这里 len 是数组的长度并且也是切片的初始长度。</p> <h4 id="切片初始化"><a href="#切片初始化" class="header-anchor">#</a> 切片初始化</h4> <div class="language-go extra-class"><pre class="language-go"><code>s <span class="token operator">:=</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token builtin">int</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span> <span class="token punctuation">}</span>
</code></pre></div><p>直接初始化切片，[]表示是切片类型，{1,2,3}初始化值依次是1,2,3.其cap=len=3</p> <div class="language-go extra-class"><pre class="language-go"><code>s <span class="token operator">:=</span> arr<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
</code></pre></div><p>初始化切片s,<strong>是数组arr的引用</strong></p> <div class="language-go extra-class"><pre class="language-go"><code>s <span class="token operator">:=</span> arr<span class="token punctuation">[</span>startIndex<span class="token punctuation">:</span>endIndex<span class="token punctuation">]</span>
</code></pre></div><p>将arr中从下标startIndex到endIndex-1 下的元素创建为一个新的切片</p> <div class="language-go extra-class"><pre class="language-go"><code>s <span class="token operator">:=</span> arr<span class="token punctuation">[</span>startIndex<span class="token punctuation">:</span><span class="token punctuation">]</span>
</code></pre></div><p>缺省endIndex时将表示一直到arr的最后一个元素</p> <div class="language-go extra-class"><pre class="language-go"><code>s <span class="token operator">:=</span> arr<span class="token punctuation">[</span><span class="token punctuation">:</span>endIndex<span class="token punctuation">]</span>
</code></pre></div><p>缺省startIndex时将表示从arr的第一个元素开始</p> <div class="language-go extra-class"><pre class="language-go"><code>s1 <span class="token operator">:=</span> s<span class="token punctuation">[</span>startIndex<span class="token punctuation">:</span>endIndex<span class="token punctuation">]</span>
</code></pre></div><p>通过切片s初始化切片s1</p> <div class="language- extra-class"><pre class="language-text"><code>s :=make([]int,len,cap)
</code></pre></div><p>通过内置函数make()初始化切片s,[]int 标识为其元素类型为int的切片</p> <h4 id="len-和-cap-函数"><a href="#len-和-cap-函数" class="header-anchor">#</a> len() 和 cap() 函数</h4> <p>切片是可索引的，并且可以由 len() 方法获取长度。</p> <p>切片提供了计算容量的方法 cap() 可以测量切片最长可以达到多少。</p> <p>以下为具体实例：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main


<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>


<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">var</span> numbers <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>


   <span class="token function">printSlice</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token keyword">func</span> <span class="token function">printSlice</span><span class="token punctuation">(</span>x <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;len=%d cap=%d slice=%v\n&quot;</span><span class="token punctuation">,</span><span class="token function">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">cap</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>以上实例运行输出结果为:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token builtin">len</span><span class="token operator">=</span><span class="token number">3</span> <span class="token builtin">cap</span><span class="token operator">=</span><span class="token number">5</span> slice<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span><span class="token punctuation">]</span>
</code></pre></div><h4 id="空-nil-切片"><a href="#空-nil-切片" class="header-anchor">#</a> 空(nil)切片</h4> <p>一个切片在未初始化之前默认为 nil，长度为 0，实例如下：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main


<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>


<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">var</span> numbers <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>


   <span class="token function">printSlice</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>


   <span class="token keyword">if</span><span class="token punctuation">(</span>numbers <span class="token operator">==</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;切片是空的&quot;</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">func</span> <span class="token function">printSlice</span><span class="token punctuation">(</span>x <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;len=%d cap=%d slice=%v\n&quot;</span><span class="token punctuation">,</span><span class="token function">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">cap</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>以上实例运行输出结果为:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token builtin">len</span><span class="token operator">=</span><span class="token number">0</span> <span class="token builtin">cap</span><span class="token operator">=</span><span class="token number">0</span> slice<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
切片是空的
</code></pre></div><h4 id="切片截取"><a href="#切片截取" class="header-anchor">#</a> 切片截取</h4> <p>可以通过设置下限及上限来设置截取切片*[lower-bound:upper-bound]*，实例如下：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main


<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>


<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">/* 创建切片 */</span>
   numbers <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">}</span>   
   <span class="token function">printSlice</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>


   <span class="token comment">/* 打印原始切片 */</span>
   fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;numbers ==&quot;</span><span class="token punctuation">,</span> numbers<span class="token punctuation">)</span>


   <span class="token comment">/* 打印子切片从索引1(包含) 到索引4(不包含)*/</span>
   fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;numbers[1:4] ==&quot;</span><span class="token punctuation">,</span> numbers<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


   <span class="token comment">/* 默认下限为 0*/</span>
   fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;numbers[:3] ==&quot;</span><span class="token punctuation">,</span> numbers<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


   <span class="token comment">/* 默认上限为 len(s)*/</span>
   fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;numbers[4:] ==&quot;</span><span class="token punctuation">,</span> numbers<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


   numbers1 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
   <span class="token function">printSlice</span><span class="token punctuation">(</span>numbers1<span class="token punctuation">)</span>


   <span class="token comment">/* 打印子切片从索引  0(包含) 到索引 2(不包含) */</span>
   number2 <span class="token operator">:=</span> numbers<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
   <span class="token function">printSlice</span><span class="token punctuation">(</span>number2<span class="token punctuation">)</span>


   <span class="token comment">/* 打印子切片从索引 2(包含) 到索引 5(不包含) */</span>
   number3 <span class="token operator">:=</span> numbers<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>
   <span class="token function">printSlice</span><span class="token punctuation">(</span>number3<span class="token punctuation">)</span>


<span class="token punctuation">}</span>


<span class="token keyword">func</span> <span class="token function">printSlice</span><span class="token punctuation">(</span>x <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;len=%d cap=%d slice=%v\n&quot;</span><span class="token punctuation">,</span><span class="token function">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">cap</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>执行以上代码输出结果为：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token builtin">len</span><span class="token operator">=</span><span class="token number">9</span> <span class="token builtin">cap</span><span class="token operator">=</span><span class="token number">9</span> slice<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token number">6</span> <span class="token number">7</span> <span class="token number">8</span><span class="token punctuation">]</span>
numbers <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token number">6</span> <span class="token number">7</span> <span class="token number">8</span><span class="token punctuation">]</span>
numbers<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span><span class="token punctuation">]</span>
numbers<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span><span class="token punctuation">]</span>
numbers<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token number">4</span> <span class="token number">5</span> <span class="token number">6</span> <span class="token number">7</span> <span class="token number">8</span><span class="token punctuation">]</span>
<span class="token builtin">len</span><span class="token operator">=</span><span class="token number">0</span> <span class="token builtin">cap</span><span class="token operator">=</span><span class="token number">5</span> slice<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token builtin">len</span><span class="token operator">=</span><span class="token number">2</span> <span class="token builtin">cap</span><span class="token operator">=</span><span class="token number">9</span> slice<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">1</span><span class="token punctuation">]</span>
<span class="token builtin">len</span><span class="token operator">=</span><span class="token number">3</span> <span class="token builtin">cap</span><span class="token operator">=</span><span class="token number">7</span> slice<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span><span class="token punctuation">]</span>
</code></pre></div><h4 id="append-和-copy-函数"><a href="#append-和-copy-函数" class="header-anchor">#</a> append() 和 copy() 函数</h4> <p>如果想增加切片的容量，我们必须创建一个新的更大的切片并把原分片的内容都拷贝过来。</p> <p>下面的代码描述了从拷贝切片的 copy 方法和向切片追加新元素的 append 方法。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main


<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>


<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">var</span> numbers <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>
   <span class="token function">printSlice</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>


   <span class="token comment">/* 允许追加空切片 */</span>
   numbers <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>numbers<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
   <span class="token function">printSlice</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>


   <span class="token comment">/* 向切片添加一个元素 */</span>
   numbers <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>numbers<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
   <span class="token function">printSlice</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>


   <span class="token comment">/* 同时添加多个元素 */</span>
   numbers <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>numbers<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>
   <span class="token function">printSlice</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>


   <span class="token comment">/* 创建切片 numbers1 是之前切片的两倍容量*/</span>
   numbers1 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token function">cap</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>


   <span class="token comment">/* 拷贝 numbers 的内容到 numbers1 */</span>
   <span class="token function">copy</span><span class="token punctuation">(</span>numbers1<span class="token punctuation">,</span>numbers<span class="token punctuation">)</span>
   <span class="token function">printSlice</span><span class="token punctuation">(</span>numbers1<span class="token punctuation">)</span>   
<span class="token punctuation">}</span>


<span class="token keyword">func</span> <span class="token function">printSlice</span><span class="token punctuation">(</span>x <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;len=%d cap=%d slice=%v\n&quot;</span><span class="token punctuation">,</span><span class="token function">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">cap</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>以上代码执行输出结果为：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token builtin">len</span><span class="token operator">=</span><span class="token number">0</span> <span class="token builtin">cap</span><span class="token operator">=</span><span class="token number">0</span> slice<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token builtin">len</span><span class="token operator">=</span><span class="token number">1</span> <span class="token builtin">cap</span><span class="token operator">=</span><span class="token number">1</span> slice<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token builtin">len</span><span class="token operator">=</span><span class="token number">2</span> <span class="token builtin">cap</span><span class="token operator">=</span><span class="token number">2</span> slice<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">1</span><span class="token punctuation">]</span>
<span class="token builtin">len</span><span class="token operator">=</span><span class="token number">5</span> <span class="token builtin">cap</span><span class="token operator">=</span><span class="token number">6</span> slice<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span><span class="token punctuation">]</span>
<span class="token builtin">len</span><span class="token operator">=</span><span class="token number">5</span> <span class="token builtin">cap</span><span class="token operator">=</span><span class="token number">12</span> slice<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span><span class="token punctuation">]</span>
</code></pre></div><h4 id="map"><a href="#map" class="header-anchor">#</a> <strong>map</strong></h4> <p>map和slice类似，只不过是数据结构不同，下面是map的一些声明方式。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main
<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//第一种声明</span>
    <span class="token keyword">var</span> test1 <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span>
    <span class="token comment">//在使用map前，需要先make，make的作用就是给map分配数据空间</span>
    test1 <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> 
    test1<span class="token punctuation">[</span><span class="token string">&quot;one&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;php&quot;</span>
    test1<span class="token punctuation">[</span><span class="token string">&quot;two&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;golang&quot;</span>
    test1<span class="token punctuation">[</span><span class="token string">&quot;three&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;java&quot;</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>test1<span class="token punctuation">)</span> <span class="token comment">//map[two:golang three:java one:php]</span>


    <span class="token comment">//第二种声明</span>
    test2 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span>
    test2<span class="token punctuation">[</span><span class="token string">&quot;one&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;php&quot;</span>
    test2<span class="token punctuation">[</span><span class="token string">&quot;two&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;golang&quot;</span>
    test2<span class="token punctuation">[</span><span class="token string">&quot;three&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;java&quot;</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>test2<span class="token punctuation">)</span> <span class="token comment">//map[one:php two:golang three:java]</span>

    <span class="token comment">//第三种声明</span>
    test3 <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>
        <span class="token string">&quot;one&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;php&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;two&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;golang&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;three&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;java&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>test3<span class="token punctuation">)</span> <span class="token comment">//map[one:php two:golang three:java]</span>


    
    language <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span>
    language<span class="token punctuation">[</span><span class="token string">&quot;php&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    language<span class="token punctuation">[</span><span class="token string">&quot;php&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span>
    language<span class="token punctuation">[</span><span class="token string">&quot;php&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;desc&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;php是世界上最美的语言&quot;</span>
    language<span class="token punctuation">[</span><span class="token string">&quot;golang&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    language<span class="token punctuation">[</span><span class="token string">&quot;golang&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;2&quot;</span>
    language<span class="token punctuation">[</span><span class="token string">&quot;golang&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;desc&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;golang抗并发非常good&quot;</span>
    
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>language<span class="token punctuation">)</span> <span class="token comment">//map[php:map[id:1 desc:php是世界上最美的语言] golang:map[id:2 desc:golang抗并发非常good]]</span>


    <span class="token comment">//增删改查</span>
    <span class="token comment">// val, key := language[&quot;php&quot;]  //查找是否有php这个子元素</span>
    <span class="token comment">// if key {</span>
    <span class="token comment">//     fmt.Printf(&quot;%v&quot;, val)</span>
    <span class="token comment">// } else {</span>
    <span class="token comment">//     fmt.Printf(&quot;no&quot;);</span>
    <span class="token comment">// }</span>

    <span class="token comment">//language[&quot;php&quot;][&quot;id&quot;] = &quot;3&quot; //修改了php子元素的id值</span>
    <span class="token comment">//language[&quot;php&quot;][&quot;nickname&quot;] = &quot;啪啪啪&quot; //增加php元素里的nickname值</span>
    <span class="token comment">//delete(language, &quot;php&quot;)  //删除了php子元素</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>language<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="面向对象的特征"><a href="#面向对象的特征" class="header-anchor">#</a> 面向对象的特征</h2> <h4 id="方法"><a href="#方法" class="header-anchor">#</a> 方法</h4> <p>假设有两个方法，一个方法的接收者是指针类型，一个方法的接收者是值类型，那么：</p> <ul><li>对于值类型的变量和指针类型的变量，这两个方法有什么区别？</li> <li>如果这两个方法是为了实现一个接口，那么这两个方法都可以调用吗？</li> <li>如果方法是嵌入到其他结构体中的，那么上面两种情况又是怎样的？</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main


<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>


<span class="token comment">//定义一个结构体</span>
<span class="token keyword">type</span> T <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    name <span class="token builtin">string</span>
<span class="token punctuation">}</span>


<span class="token keyword">func</span> <span class="token punctuation">(</span>t T<span class="token punctuation">)</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;new name1&quot;</span>
<span class="token punctuation">}</span>


<span class="token keyword">func</span> <span class="token punctuation">(</span>t <span class="token operator">*</span>T<span class="token punctuation">)</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;new name2&quot;</span>
<span class="token punctuation">}</span>


<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>


    t <span class="token operator">:=</span> T<span class="token punctuation">{</span><span class="token string">&quot;old name&quot;</span><span class="token punctuation">}</span>


    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;method1 调用前 &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    t<span class="token punctuation">.</span><span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;method1 调用后 &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>name<span class="token punctuation">)</span>


    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;method2 调用前 &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    t<span class="token punctuation">.</span><span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;method2 调用后 &quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-go extra-class"><pre class="language-go"><code>method1 调用前  old name
method1 调用后  old name
method2 调用前  old name
method2 调用后  <span class="token builtin">new</span> name2
</code></pre></div><p>当调用<code>t.method1()</code>时相当于<code>method1(t)</code>，实参和行参都是类型 T，可以接受。此时在<code>method1</code>()中的t只是参数t的值拷贝，所以<code>method1</code>()的修改影响不到main中的t变量。</p> <p>当调用<code>t.method2()</code>=&gt;<code>method2(t)</code>，这是将 T 类型传给了 *T 类型，go可能会取 t 的地址传进去：<code>method2(&amp;t)</code>。所以 <code>method1</code>() 的修改可以影响 t。</p> <p>T 类型的变量这两个方法都是拥有的。</p> <h5 id="心法"><a href="#心法" class="header-anchor">#</a> 心法</h5> <p>(这里想用Java的方式理解可能会比较困难。毕竟go和js的自定义类一样都是不被class结构给约束的，这里可以看出，正常的成员变量声明还是放在结构里面的。然后方法参考js，对象是通过原型，直接无中生有一个引用来接收方法对象。所以实际上我们可以想到只要给了方法类型的对象的地址就好了，这样就能操作对象里面的成员了。怎么个给法就是语法问题。==所以感觉golang编程的时候不用太关心类和对象的概念，只需要清楚你想达到这种效果需要什么条件，然后按照语法把条件给它，最后达到的效果实际上每个语言都是一样的==)</p> <p>(==然后这里点名表扬一下java是可以做到完全带着概念编程的==)</p> <h4 id="方法值和方法表达式"><a href="#方法值和方法表达式" class="header-anchor">#</a> 方法值和方法表达式</h4> <h5 id="方法值"><a href="#方法值" class="header-anchor">#</a> 方法值</h5> <p>我们经常选择一个方法，并且在同一个表达式里执行，比如常见的p.Distance()形式，实际上将其分成两步来执行也是可能的。p.Distance叫作“选择器”，</p> <p>选择器会返回一个方法&quot;值&quot;</p> <p><code>一个将方法(Point.Distance)绑定到特定接收器变量的函数</code>。</p> <p>这个函数可以不通过指定其接收器即可被调用；即调用时不需要指定接收器，只要传入函数的参数即可：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main


<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>
<span class="token keyword">import</span> <span class="token string">&quot;math&quot;</span>


<span class="token keyword">type</span> Point <span class="token keyword">struct</span><span class="token punctuation">{</span> X<span class="token punctuation">,</span> Y <span class="token builtin">float64</span> <span class="token punctuation">}</span>


<span class="token comment">//这是给struct Point类型定义一个方法</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>p Point<span class="token punctuation">)</span> <span class="token function">Distance</span><span class="token punctuation">(</span>q Point<span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">Hypot</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>X<span class="token operator">-</span>p<span class="token punctuation">.</span>X<span class="token punctuation">,</span> q<span class="token punctuation">.</span>Y<span class="token operator">-</span>p<span class="token punctuation">.</span>Y<span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>


    p <span class="token operator">:=</span> Point<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span>
    q <span class="token operator">:=</span> Point<span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">}</span>


    distanceFormP <span class="token operator">:=</span> p<span class="token punctuation">.</span>Distance   <span class="token comment">// 方法值(相当于C语言的函数地址,函数指针)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">distanceFormP</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// &quot;5&quot;</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">Distance</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// &quot;5&quot;</span>


    <span class="token comment">//实际上distanceFormP 就绑定了 p接收器的方法Distance</span>


    distanceFormQ <span class="token operator">:=</span> q<span class="token punctuation">.</span>Distance   <span class="token comment">//</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">distanceFormQ</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// &quot;5&quot;</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span><span class="token function">Distance</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// &quot;5&quot;</span>


    <span class="token comment">//实际上distanceFormQ 就绑定了 q接收器的方法Distance</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在一个包的API需要一个函数值、且调用方希望操作的是某一个绑定了对象的方法的话，方法&quot;值&quot;会非常实用.</p> <p>举例来说，下面例子中的time.AfterFunc这个函数的功能是在指定的延迟时间之后来执行一个(译注：另外的)函数。且这个函数操作的是一个Rocket对象r</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> Rocket <span class="token keyword">struct</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>Rocket<span class="token punctuation">)</span> <span class="token function">Launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
r <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>Rocket<span class="token punctuation">)</span>
time<span class="token punctuation">.</span><span class="token function">AfterFunc</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> r<span class="token punctuation">.</span><span class="token function">Launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>直接用方法&quot;值&quot;传入AfterFunc的话可以更为简短：</p> <div class="language-go extra-class"><pre class="language-go"><code>time<span class="token punctuation">.</span><span class="token function">AfterFunc</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span> r<span class="token punctuation">.</span>Launch<span class="token punctuation">)</span>
</code></pre></div><p>省掉了上面那个例子里的匿名函数。</p> <p>(嘛，这个方法&quot;值&quot;的概念感觉吹的有点花哨了，实际上就是可以理解成是方法对象嘛，选择器不就是方法对象的引用名嘛,只是清楚这个选择器是主动自动返回方法&quot;值&quot;的就行)</p> <h5 id="方法表达式"><a href="#方法表达式" class="header-anchor">#</a> 方法表达式</h5> <p>和方法&quot;值&quot;相关的还有方法表达式。当调用一个方法时，与调用一个普通的函数相比，我们必须要用选择器(p.Distance)语法来指定方法的接收器。</p> <p>当T是一个类型时，方法表达式可能会写作<code>T.f</code>或者<code>(*T).f</code>，会返回一个函数&quot;值&quot;，这种函数会将其第一个参数用作接收器，所以可以用通常(译注：不写选择器)的方式来对其进行调用：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main


<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>
<span class="token keyword">import</span> <span class="token string">&quot;math&quot;</span>


<span class="token keyword">type</span> Point <span class="token keyword">struct</span><span class="token punctuation">{</span> X<span class="token punctuation">,</span> Y <span class="token builtin">float64</span> <span class="token punctuation">}</span>


<span class="token comment">//这是给struct Point类型定义一个方法</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>p Point<span class="token punctuation">)</span> <span class="token function">Distance</span><span class="token punctuation">(</span>q Point<span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">Hypot</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>X<span class="token operator">-</span>p<span class="token punctuation">.</span>X<span class="token punctuation">,</span> q<span class="token punctuation">.</span>Y<span class="token operator">-</span>p<span class="token punctuation">.</span>Y<span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>


    p <span class="token operator">:=</span> Point<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span>
    q <span class="token operator">:=</span> Point<span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">}</span>




    distance1 <span class="token operator">:=</span> Point<span class="token punctuation">.</span>Distance <span class="token comment">//方法表达式, 是一个函数值(相当于C语言的函数指针)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">distance1</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T\n&quot;</span><span class="token punctuation">,</span> distance1<span class="token punctuation">)</span> <span class="token comment">//%T表示打出数据类型 ,这个必须放在Printf使用</span>


    distance2 <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">*</span>Point<span class="token punctuation">)</span><span class="token punctuation">.</span>Distance <span class="token comment">//方法表达式,必须传递指针类型</span>
    <span class="token function">distance2</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">,</span> q<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%T\n&quot;</span><span class="token punctuation">,</span> distance2<span class="token punctuation">)</span>


<span class="token punctuation">}</span>
</code></pre></div><p>执行结果</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token number">5</span>
<span class="token keyword">func</span><span class="token punctuation">(</span>main<span class="token punctuation">.</span>Point<span class="token punctuation">,</span> main<span class="token punctuation">.</span>Point<span class="token punctuation">)</span> <span class="token builtin">float64</span>
<span class="token keyword">func</span><span class="token punctuation">(</span><span class="token operator">*</span>main<span class="token punctuation">.</span>Point<span class="token punctuation">,</span> main<span class="token punctuation">.</span>Point<span class="token punctuation">)</span> <span class="token builtin">float64</span>
<span class="token comment">// 这个Distance实际上是指定了Point对象为接收器的一个方法func (p Point) Distance()，</span>
<span class="token comment">// 但通过Point.Distance得到的函数需要比实际的Distance方法多一个参数，</span>
<span class="token comment">// 即其需要用第一个额外参数指定接收器，后面排列Distance方法的参数。</span>
<span class="token comment">// 看起来本书中函数和方法的区别是指有没有接收器，而不像其他语言那样是指有没有返回值。</span>
</code></pre></div><p>当你根据一个变量来决定调用同一个类型的哪个函数时，方法表达式就显得很有用了。你可以根据选择来调用接收器各不相同的方法。下面的例子，变量op代表Point类型的addition或者subtraction方法，Path.TranslateBy方法会为其Path数组中的每一个Point来调用对应的方法：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main


<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>
<span class="token keyword">import</span> <span class="token string">&quot;math&quot;</span>


<span class="token keyword">type</span> Point <span class="token keyword">struct</span><span class="token punctuation">{</span> X<span class="token punctuation">,</span> Y <span class="token builtin">float64</span> <span class="token punctuation">}</span>


<span class="token comment">//这是给struct Point类型定义一个方法</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>p Point<span class="token punctuation">)</span> <span class="token function">Distance</span><span class="token punctuation">(</span>q Point<span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">Hypot</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>X<span class="token operator">-</span>p<span class="token punctuation">.</span>X<span class="token punctuation">,</span> q<span class="token punctuation">.</span>Y<span class="token operator">-</span>p<span class="token punctuation">.</span>Y<span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token keyword">func</span> <span class="token punctuation">(</span>p Point<span class="token punctuation">)</span> <span class="token function">Add</span><span class="token punctuation">(</span>another Point<span class="token punctuation">)</span> Point <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Point<span class="token punctuation">{</span>p<span class="token punctuation">.</span>X <span class="token operator">+</span> another<span class="token punctuation">.</span>X<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Y <span class="token operator">+</span> another<span class="token punctuation">.</span>Y<span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">func</span> <span class="token punctuation">(</span>p Point<span class="token punctuation">)</span> <span class="token function">Sub</span><span class="token punctuation">(</span>another Point<span class="token punctuation">)</span> Point <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Point<span class="token punctuation">{</span>p<span class="token punctuation">.</span>X <span class="token operator">-</span> another<span class="token punctuation">.</span>X<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Y <span class="token operator">-</span> another<span class="token punctuation">.</span>Y<span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">func</span> <span class="token punctuation">(</span>p Point<span class="token punctuation">)</span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;{%f, %f}\n&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>X<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Y<span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token comment">//定义一个Point切片类型 Path</span>
<span class="token keyword">type</span> Path <span class="token punctuation">[</span><span class="token punctuation">]</span>Point


<span class="token comment">//方法的接收器 是Path类型数据, 方法的选择器是TranslateBy(Point, bool)</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>path Path<span class="token punctuation">)</span> <span class="token function">TranslateBy</span><span class="token punctuation">(</span>another Point<span class="token punctuation">,</span> add <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> op <span class="token keyword">func</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> q Point<span class="token punctuation">)</span> Point <span class="token comment">//定义一个 op变量 类型是方法表达式 能够接收Add,和 Sub方法</span>
        <span class="token keyword">if</span> add <span class="token operator">==</span> <span class="token boolean">true</span> <span class="token punctuation">{</span>
                op <span class="token operator">=</span> Point<span class="token punctuation">.</span>Add <span class="token comment">//给op变量赋值为Add方法</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                op <span class="token operator">=</span> Point<span class="token punctuation">.</span>Sub <span class="token comment">//给op变量赋值为Sub方法</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> path <span class="token punctuation">{</span>
                <span class="token comment">//调用 path[i].Add(another) 或者 path[i].Sub(another)</span>
                path<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span>path<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> another<span class="token punctuation">)</span>
                path<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        points <span class="token operator">:=</span> Path<span class="token punctuation">{</span>
                <span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>


        anotherPoint <span class="token operator">:=</span> Point<span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span>


        points<span class="token punctuation">.</span><span class="token function">TranslateBy</span><span class="token punctuation">(</span>anotherPoint<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>


        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;------------------&quot;</span><span class="token punctuation">)</span>


        points<span class="token punctuation">.</span><span class="token function">TranslateBy</span><span class="token punctuation">(</span>anotherPoint<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>运行结果：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token number">5.000000</span><span class="token punctuation">,</span> <span class="token number">5.000000</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token number">6.000000</span><span class="token punctuation">,</span> <span class="token number">6.000000</span><span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token punctuation">{</span><span class="token number">10.000000</span><span class="token punctuation">,</span> <span class="token number">10.000000</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token number">11.000000</span><span class="token punctuation">,</span> <span class="token number">11.000000</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="理清楚"><a href="#理清楚" class="header-anchor">#</a> 理清楚</h4> <p><code>Go</code> 语言的方法非常纯粹， 可以看作特殊类型的函数， <strong>其显式地将对象实例或指针作为函数的第一个参数， 并且参数名可以自己指定， 而不强制要求一定是 <code>this</code> 或 <code>self</code> 。这个对象实例或指针称为方法的接收者（reciever）。</strong></p> <p>（给方法找个归属，它是在哪个类里面的，哪个对象里面的。或者直接理解成方法的调用者就好了嘛，就是this的概念!只是可以写在前面，或者让编译器指定参数表中的第一个参数为这个角色）</p> <p>为命名类型定义方法的语法格式如下：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 类型方法接收者是值类型</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>t TypeName<span class="token punctuation">)</span> MethodName <span class="token punctuation">(</span>ParamList <span class="token punctuation">)</span> <span class="token punctuation">(</span>Returnlist<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//method body</span>
<span class="token punctuation">}</span>

<span class="token comment">// 类型方法接收者是指针</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>t <span class="token operator">*</span>TypeName<span class="token punctuation">)</span> MethodName <span class="token punctuation">(</span>ParamList<span class="token punctuation">)</span> <span class="token punctuation">(</span>Returnlist<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//method body</span>
<span class="token punctuation">}</span>
</code></pre></div><p>说明：</p> <p>t 是接收者或者叫接收器变量，<strong>官方建议使用接收器类型名 TypeName 的 第一个小写字母，而不是 self 、 this 之类的命名。例如， Socket 类型的接收器变量应该命名为 s， Connector 类型的接收器变量应该命名为 c 等；</strong></p> <p>TypeName 为命名类型的类型名；</p> <p>MethodName 为方法名，是一个自定义标识符；</p> <p>ParamList 是形参列表；</p> <p>ReturnList 是返回值列表；</p> <p>接收者的定义和普通变量、函数参数等一样，前面是变量名，后面是接收者类型。</p> <p><strong>Go 方法实质上是以方法的 receiver 参数作为第一个参数的普通函数，没有使用隐式的指针，我们可以将类型的方法改写为常规的函数。示例如下：</strong></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">//类型方法接收者是值类型</span>
<span class="token keyword">func</span> <span class="token function">TypName_MethodName</span><span class="token punctuation">(</span>t TypeName <span class="token punctuation">,</span> otherParamList<span class="token punctuation">)</span> <span class="token punctuation">(</span>Returnlist<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//method body</span>
<span class="token punctuation">}</span>
<span class="token comment">//类型方法接收者是指针</span>
<span class="token keyword">func</span> TypName_MethodName <span class="token punctuation">(</span>t <span class="token operator">*</span>TypeName <span class="token punctuation">,</span> otherParamList<span class="token punctuation">)</span> <span class="token punctuation">(</span>Returnlist<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//method body</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="receiver可以使用指针"><a href="#receiver可以使用指针" class="header-anchor">#</a> <strong>receiver可以使用指针</strong></h5> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">type</span> MyStruct <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    x <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m MyStruct<span class="token punctuation">)</span> <span class="token function">Set1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    m<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>MyStruct<span class="token punctuation">)</span> <span class="token function">Set2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    m<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    s <span class="token operator">:=</span> MyStruct<span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
    s<span class="token punctuation">.</span><span class="token function">Set1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span><span class="token function">Set2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>输出</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token number">0</span>
<span class="token number">2</span>
</code></pre></div><p>可以看出，Set1并没有修改值，Set2才修改了值，是因为指针receiver才是修改原来的值，否则只是复制变量出来成为函数里的局部变量</p> <h5 id="如何判断receiver是否要用指针"><a href="#如何判断receiver是否要用指针" class="header-anchor">#</a> <strong>如何判断receiver是否要用指针</strong></h5> <p>method的value receiver和pointer receiver怎么选择，官方说了2个原因来使用pointer receiver</p> <ol><li>需要修改原来的值</li> <li>防止每次调用method时候都拷贝value，比如当struct很大的时候每次都拷贝value会降低效率</li></ol> <p>下面是我个人理解，不一定准确：</p> <p>实际应用中，有一个情况是不能用pointer receiver：pointer可能造成安全风险，例如某个method只是要获取金额，而不是修改金额，那么使用pointer的话就存在当内存被泄露等情况导致金额被修改。</p> <p>因此，若没有涉及性能问题，且method的功能是读，而非写的时候，首选value receiver</p> <h2 id="interface与类型断言"><a href="#interface与类型断言" class="header-anchor">#</a> <strong>interface与类型断言</strong></h2> <p>Golang的语言中提供了断言的功能。golang中的所有程序都实现了interface{}的接口，这意味着，所有的类型如string,int,int64甚至是自定义的struct类型都就此拥有了interface{}的接口，这种做法和java中的Object类型比较类似。那么在一个数据通过func funcName(interface{})的方式传进来的时候，也就意味着这个参数被自动的转为interface{}的类型。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">funcName</span><span class="token punctuation">(</span>a <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token function">string</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>编译器会返回</p> <div class="language-txt extra-class"><pre class="language-txt"><code>cannot convert a (type interface{}) to type string: need type assertion
</code></pre></div><p>此时，意味着整个转化的过程需要类型断言。类型断言有以下几种形式：(其实就是类型转型)</p> <p>1）直接断言使用</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> a <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>


fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Where are you,Jonny?&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>但是如果断言失败一般会导致panic的发生。所以为了防止panic的发生，我们需要在断言前进行一定的判断</p> <div class="language-go extra-class"><pre class="language-go"><code>value<span class="token punctuation">,</span> ok <span class="token operator">:=</span> a<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span>
</code></pre></div><p>如果断言失败，那么ok的值将会是false,但是如果断言成功ok的值将会是true,同时value将会得到所期待的正确的值。示例：</p> <div class="language-go extra-class"><pre class="language-go"><code>value<span class="token punctuation">,</span> ok <span class="token operator">:=</span> a<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;It's not ok for type string&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;The value is &quot;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
</code></pre></div><p>完整例子如下：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main


<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>


<span class="token comment">/*
func funcName(a interface{}) string {
        return string(a)
}
*/</span>


<span class="token keyword">func</span> <span class="token function">funcName</span><span class="token punctuation">(</span>a <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
        value<span class="token punctuation">,</span> ok <span class="token operator">:=</span> a<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
                fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;It is not ok for type string&quot;</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span>
        <span class="token punctuation">}</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;The value is &quot;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>


        <span class="token keyword">return</span> value
<span class="token punctuation">}</span>


<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//      str := &quot;123&quot;</span>
        <span class="token comment">//      funcName(str)</span>
        <span class="token comment">//var a interface{}</span>
        <span class="token comment">//var a string = &quot;123&quot;</span>
        <span class="token keyword">var</span> a <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">10</span>
        <span class="token function">funcName</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>2）配合switch使用</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> t <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
t <span class="token operator">=</span> <span class="token function">functionOfSomeType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">switch</span> t <span class="token operator">:=</span> t<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">default</span><span class="token punctuation">:</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;unexpected type %T&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>       <span class="token comment">// %T prints whatever type t has</span>
<span class="token keyword">case</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;boolean %t\n&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>             <span class="token comment">// t has type bool</span>
<span class="token keyword">case</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;integer %d\n&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>             <span class="token comment">// t has type int</span>
<span class="token keyword">case</span> <span class="token operator">*</span><span class="token builtin">bool</span><span class="token punctuation">:</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;pointer to boolean %t\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span>t<span class="token punctuation">)</span> <span class="token comment">// t has type *bool</span>
<span class="token keyword">case</span> <span class="token operator">*</span><span class="token builtin">int</span><span class="token punctuation">:</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;pointer to integer %d\n&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span>t<span class="token punctuation">)</span> <span class="token comment">// t has type *int</span>
<span class="token punctuation">}</span>
</code></pre></div><p>或者如下使用方法</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">sqlQuote</span><span class="token punctuation">(</span>x <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> x <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;NULL&quot;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> ok <span class="token operator">:=</span> x<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
        <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%d&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> ok <span class="token operator">:=</span> x<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
        <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%d&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> b<span class="token punctuation">,</span> ok <span class="token operator">:=</span> x<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
        <span class="token keyword">if</span> b <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;TRUE&quot;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">&quot;FALSE&quot;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> s<span class="token punctuation">,</span> ok <span class="token operator">:=</span> x<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">sqlQuoteString</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token comment">// (not shown)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">panic</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;unexpected type %T: %v&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="反射reflect"><a href="#反射reflect" class="header-anchor">#</a> <strong>反射reflect</strong></h2> <h4 id="编程语言中反射的概念"><a href="#编程语言中反射的概念" class="header-anchor">#</a> 编程语言中反射的概念</h4> <p>在计算机科学领域，反射是指一类应用，它们能够自描述和自控制。也就是说，这类应用通过采用某种机制来实现对自己行为的描述（self-representation）和监测（examination），并能根据自身行为的状态和结果，调整或修改应用所描述行为的状态和相关的语义。</p> <p>每种语言的反射模型都不同，并且有些语言根本不支持反射。Golang语言实现了反射，<strong>反射机制就是在运行时动态的调用对象的方法和属性，官方自带的reflect包就是反射相关的，只要包含这个包就可以使用。</strong></p> <p>多插一句，Golang的gRPC也是通过反射实现的。</p> <h4 id="interface-和-反射"><a href="#interface-和-反射" class="header-anchor">#</a> interface 和 反射</h4> <p>在讲反射之前，先来看看Golang关于类型设计的一些原则</p> <ul><li>变量包括（type, value）两部分</li> <li>type 包括 <code>static type</code>和<code>concrete type</code>. 简单来说 <code>static type</code>是你在编码是看见的类型(如int、string)，<code>concrete type</code>是<code>runtime</code>系统看见的类型</li> <li>类型断言能否成功，取决于变量的<code>concrete type</code>，而不是<code>static type</code>. 因此，一个 <code>reader</code>变量如果它的<code>concrete type</code>也实现了<code>write</code>方法的话，它也可以被类型断言为<code>writer</code>.</li></ul> <p>接下来要讲的<code>反射</code>，就是建立在类型之上的，Golang的指定类型的变量的类型是静态的（也就是指定int、string这些的变量，它的type是static type），在创建变量的时候就已经确定，反射主要与Golang的interface类型相关（它的type是concrete type），只有interface类型才有反射一说。</p> <p>在Golang的实现中，每个interface变量都有一个对应pair，pair中记录了实际变量的值和类型:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token keyword">type</span><span class="token punctuation">)</span>
</code></pre></div><p>value是实际变量值，type是实际变量的类型。一个interface{}类型的变量包含了2个指针，一个指针指向值的类型【对应concrete type】，另外一个指针指向实际的值【对应value】。</p> <p>例如，创建类型为*os.File的变量，然后将其赋给一个接口变量r：</p> <div class="language-go extra-class"><pre class="language-go"><code>tty<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span><span class="token string">&quot;/dev/tty&quot;</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_RDWR<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> r io<span class="token punctuation">.</span>Reader
r <span class="token operator">=</span> tty
</code></pre></div><p>接口变量r的pair中将记录如下信息：(tty, *os.File)，这个pair在接口变量的连续赋值过程中是不变的，将接口变量r赋给另一个接口变量w:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> w io<span class="token punctuation">.</span>Writer
w <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>Writer<span class="token punctuation">)</span>
</code></pre></div><p>接口变量w的pair与r的pair相同，都是:(tty, *os.File)，即使w是空接口类型，pair也是不变的。</p> <p>interface及其pair的存在，是Golang中实现反射的前提，理解了pair，就更容易理解反射。反射就是用来检测存储在接口变量内部(值value；类型concrete type) pair对的一种机制。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;io&quot;</span>
	<span class="token string">&quot;os&quot;</span>
<span class="token punctuation">)</span>


<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	tty<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span><span class="token string">&quot;/dev/tty&quot;</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_RDWR<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;open file error&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">var</span> r io<span class="token punctuation">.</span>Reader
	r <span class="token operator">=</span> tty

	<span class="token keyword">var</span> w io<span class="token punctuation">.</span>Writer
	w <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>Writer<span class="token punctuation">)</span>
	w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;HELLO THIS IS A TEST!!!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>再比如:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">type</span> Reader <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">ReadBook</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Writer <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">WriteBook</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//具体类型</span>
<span class="token keyword">type</span> Book <span class="token keyword">struct</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>this <span class="token operator">*</span>Book<span class="token punctuation">)</span> <span class="token function">ReadBook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Read a book.&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>this <span class="token operator">*</span>Book<span class="token punctuation">)</span> <span class="token function">WriteBook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Write a book.&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	b <span class="token operator">:=</span> <span class="token operator">&amp;</span>Book<span class="token punctuation">{</span><span class="token punctuation">}</span>

	<span class="token keyword">var</span> r Reader
	r <span class="token operator">=</span> b

	r<span class="token punctuation">.</span><span class="token function">ReadBook</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">var</span> w Writer
	w <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token punctuation">(</span>Writer<span class="token punctuation">)</span>
	w<span class="token punctuation">.</span><span class="token function">WriteBook</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="golang的反射reflect"><a href="#golang的反射reflect" class="header-anchor">#</a> Golang的反射reflect</h4> <p><strong>reflect的基本功能TypeOf和ValueOf</strong></p> <p>既然反射就是用来检测存储在接口变量内部(值value；类型concrete type) pair对的一种机制。那么在Golang的reflect反射包中有什么样的方式可以让我们直接获取到变量内部的信息呢？ 它提供了两种类型（或者说两个方法）让我们可以很容易的访问接口变量内容，分别是reflect.ValueOf() 和 reflect.TypeOf()，看看官方的解释</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// ValueOf returns a new Value initialized to the concrete value</span>
<span class="token comment">// stored in the interface i.  ValueOf(nil) returns the zero </span>
<span class="token keyword">func</span> <span class="token function">ValueOf</span><span class="token punctuation">(</span>i <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> Value <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

<span class="token comment">//ValueOf用来获取输入参数接口中的数据的值，如果接口为空则返回0</span>


<span class="token comment">// TypeOf returns the reflection Type that represents the dynamic type of i.</span>
<span class="token comment">// If i is a nil interface value, TypeOf returns nil.</span>
<span class="token keyword">func</span> <span class="token function">TypeOf</span><span class="token punctuation">(</span>i <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> Type <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

<span class="token comment">//TypeOf用来动态获取输入参数接口中的值的类型，如果接口为空则返回nil</span>
</code></pre></div><p>reflect.TypeOf()是获取pair中的type，reflect.ValueOf()获取pair中的value，示例如下：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;reflect&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> num <span class="token builtin">float64</span> <span class="token operator">=</span> <span class="token number">1.2345</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;type: &quot;</span><span class="token punctuation">,</span> reflect<span class="token punctuation">.</span><span class="token function">TypeOf</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;value: &quot;</span><span class="token punctuation">,</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

运行结果<span class="token punctuation">:</span>
<span class="token keyword">type</span><span class="token punctuation">:</span>  <span class="token builtin">float64</span>
value<span class="token punctuation">:</span>  <span class="token number">1.2345</span>
</code></pre></div><p>说明</p> <ol><li>reflect.TypeOf： 直接给到了我们想要的type类型，如float64、int、各种pointer、struct 等等真实的类型</li> <li>reflect.ValueOf：直接给到了我们想要的具体的值，如1.2345这个具体数值，或者类似&amp;{1 &quot;Allen.Wu&quot; 25} 这样的结构体struct的值</li> <li>也就是说明反射可以将“接口类型变量”转换为“反射类型对象”，反射类型指的是reflect.Type和reflect.Value这两种</li></ol> <p><strong>从relfect.Value中获取接口interface的信息</strong></p> <p>当执行reflect.ValueOf(interface)之后，就得到了一个类型为”relfect.Value”变量，可以通过它本身的Interface()方法获得接口变量的真实内容，然后可以通过类型判断进行转换，转换为原有真实类型。不过，我们可能是已知原有类型，也有可能是未知原有类型，因此，下面分两种情况进行说明。</p> <p>已知原有类型【进行“强制转换”】</p> <p>已知类型后转换为其对应的类型的做法如下，直接通过Interface方法然后强制转换，如下：</p> <div class="language-go extra-class"><pre class="language-go"><code>realValue <span class="token operator">:=</span> value<span class="token punctuation">.</span><span class="token function">Interface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span>已知的类型<span class="token punctuation">)</span>
</code></pre></div><p>示例如下：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;reflect&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> num <span class="token builtin">float64</span> <span class="token operator">=</span> <span class="token number">1.2345</span>

    pointer <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>num<span class="token punctuation">)</span>
    value <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>

    <span class="token comment">// 可以理解为“强制转换”，但是需要注意的时候，转换的时候，如果转换的类型不完全符合，则直接panic</span>
    <span class="token comment">// Golang 对类型要求非常严格，类型一定要完全符合</span>
    <span class="token comment">// 如下两个，一个是*float64，一个是float64，如果弄混，则会panic</span>
    convertPointer <span class="token operator">:=</span> pointer<span class="token punctuation">.</span><span class="token function">Interface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">float64</span><span class="token punctuation">)</span>
    convertValue <span class="token operator">:=</span> value<span class="token punctuation">.</span><span class="token function">Interface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">float64</span><span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>convertPointer<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>convertValue<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

运行结果：
<span class="token number">0xc42000e238</span>
<span class="token number">1.2345</span>
</code></pre></div><p>说明</p> <ol><li>转换的时候，如果转换的类型不完全符合，则直接panic，类型要求非常严格！</li> <li>转换的时候，要区分是指针还是指</li> <li>也就是说反射可以将“反射类型对象”再重新转换为“接口类型变量”</li></ol> <p>未知原有类型【遍历探测其Filed】</p> <p>很多情况下，我们可能并不知道其具体类型，那么这个时候，该如何做呢？需要我们进行遍历探测其Filed来得知，示例如下:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;reflect&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Id   <span class="token builtin">int</span>
    Name <span class="token builtin">string</span>
    Age  <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>u User<span class="token punctuation">)</span> <span class="token function">ReflectCallFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Allen.Wu ReflectCallFunc&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    user <span class="token operator">:=</span> User<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;Allen.Wu&quot;</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">}</span>

    <span class="token function">DoFiledAndMethod</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

<span class="token punctuation">}</span>

<span class="token comment">// 通过接口来获取任意参数，然后一一揭晓</span>
<span class="token keyword">func</span> <span class="token function">DoFiledAndMethod</span><span class="token punctuation">(</span>input <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    getType <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">TypeOf</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;get Type is :&quot;</span><span class="token punctuation">,</span> getType<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    getValue <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;get all Fields is:&quot;</span><span class="token punctuation">,</span> getValue<span class="token punctuation">)</span>

    <span class="token comment">// 获取方法字段</span>
    <span class="token comment">// 1. 先获取interface的reflect.Type，然后通过NumField进行遍历</span>
    <span class="token comment">// 2. 再通过reflect.Type的Field获取其Field</span>
    <span class="token comment">// 3. 最后通过Field的Interface()得到对应的value</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> getType<span class="token punctuation">.</span><span class="token function">NumField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        field <span class="token operator">:=</span> getType<span class="token punctuation">.</span><span class="token function">Field</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        value <span class="token operator">:=</span> getValue<span class="token punctuation">.</span><span class="token function">Field</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Interface</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s: %v = %v\n&quot;</span><span class="token punctuation">,</span> field<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> field<span class="token punctuation">.</span>Type<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 获取方法</span>
    <span class="token comment">// 1. 先获取interface的reflect.Type，然后通过.NumMethod进行遍历</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> getType<span class="token punctuation">.</span><span class="token function">NumMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        m <span class="token operator">:=</span> getType<span class="token punctuation">.</span><span class="token function">Method</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s: %v\n&quot;</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> m<span class="token punctuation">.</span>Type<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

运行结果：
get Type is <span class="token punctuation">:</span> User
get all Fields is<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token number">1</span> Allen<span class="token punctuation">.</span>Wu <span class="token number">25</span><span class="token punctuation">}</span>
Id<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">1</span>
Name<span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> Allen<span class="token punctuation">.</span>Wu
Age<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">25</span>
ReflectCallFunc<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>main<span class="token punctuation">.</span>User<span class="token punctuation">)</span>
</code></pre></div><p>说明</p> <p>通过运行结果可以得知获取未知类型的interface的具体变量及其类型的步骤为：</p> <p>1先获取interface的reflect.Type，然后通过NumField进行遍历</p> <p>2再通过reflect.Type的Field获取其Field</p> <p>3最后通过Field的Interface()得到对应的value</p> <p>通过运行结果可以得知获取未知类型的interface的所属方法（函数）的步骤为：</p> <p>1先获取interface的reflect.Type，然后通过NumMethod进行遍历</p> <p>2再分别通过reflect.Type的Method获取对应的真实的方法（函数）</p> <p>3最后对结果取其Name和Type得知具体的方法名</p> <p>4也就是说反射可以将“反射类型对象”再重新转换为“接口类型变量”</p> <p>5struct 或者 struct 的嵌套都是一样的判断处理方式</p> <h4 id="通过reflect-value设置实际变量的值"><a href="#通过reflect-value设置实际变量的值" class="header-anchor">#</a> 通过reflect.Value设置实际变量的值</h4> <p>reflect.Value是通过reflect.ValueOf(X)获得的，只有当X是指针的时候，才可以通过reflec.Value修改实际变量X的值，即：要修改反射类型的对象就一定要保证其值是“addressable”的。</p> <p>示例如下：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;reflect&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">var</span> num <span class="token builtin">float64</span> <span class="token operator">=</span> <span class="token number">1.2345</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;old value of pointer:&quot;</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span>

    <span class="token comment">// 通过reflect.ValueOf获取num中的reflect.Value，注意，参数必须是指针才能修改其值</span>
    pointer <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>num<span class="token punctuation">)</span>
    newValue <span class="token operator">:=</span> pointer<span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;type of pointer:&quot;</span><span class="token punctuation">,</span> newValue<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;settability of pointer:&quot;</span><span class="token punctuation">,</span> newValue<span class="token punctuation">.</span><span class="token function">CanSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// 重新赋值</span>
    newValue<span class="token punctuation">.</span><span class="token function">SetFloat</span><span class="token punctuation">(</span><span class="token number">77</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;new value of pointer:&quot;</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span>

    <span class="token comment">////////////////////</span>
    <span class="token comment">// 如果reflect.ValueOf的参数不是指针，会如何？</span>
    pointer <span class="token operator">=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
    <span class="token comment">//newValue = pointer.Elem() // 如果非指针，这里直接panic，“panic: reflect: call of reflect.Value.Elem on float64 Value”</span>
<span class="token punctuation">}</span>

运行结果：
old value of pointer<span class="token punctuation">:</span> <span class="token number">1.2345</span>
<span class="token keyword">type</span> of pointer<span class="token punctuation">:</span> <span class="token builtin">float64</span>
settability of pointer<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token builtin">new</span> value of pointer<span class="token punctuation">:</span> <span class="token number">77</span>
</code></pre></div><p>说明</p> <p>1需要传入的参数是* float64这个指针，然后可以通过pointer.Elem()去获取所指向的Value，注意一定要是指针。</p> <p>2如果传入的参数不是指针，而是变量，那么</p> <p>○通过Elem获取原始值对应的对象则直接panic</p> <p>○通过CanSet方法查询是否可以设置返回false</p> <p>3newValue.CantSet()表示是否可以重新设置其值，如果输出的是true则可修改，否则不能修改，修改完之后再进行打印发现真的已经修改了。</p> <p>4reflect.Value.Elem() 表示获取原始值对应的反射对象，只有原始对象才能修改，当前反射对象是不能修改的</p> <p>5也就是说如果要修改反射类型对象，其值必须是“addressable”【对应的要传入的是指针，同时要通过Elem方法获取原始值对应的反射对象】</p> <p>6struct 或者 struct 的嵌套都是一样的判断处理方式</p> <h4 id="通过reflect-valueof来进行方法的调用"><a href="#通过reflect-valueof来进行方法的调用" class="header-anchor">#</a> 通过reflect.ValueOf来进行方法的调用</h4> <p>这算是一个高级用法了，前面我们只说到对类型、变量的几种反射的用法，包括如何获取其值、其类型、如果重新设置新值。但是在工程应用中，另外一个常用并且属于高级的用法，就是通过reflect来进行方法【函数】的调用。比如我们要做框架工程的时候，需要可以随意扩展方法，或者说用户可以自定义方法，那么我们通过什么手段来扩展让用户能够自定义呢？关键点在于用户的自定义方法是未可知的，因此我们可以通过reflect来搞定</p> <p>示例如下：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;reflect&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Id   <span class="token builtin">int</span>
    Name <span class="token builtin">string</span>
    Age  <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>u User<span class="token punctuation">)</span> <span class="token function">ReflectCallFuncHasArgs</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">,</span> age <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;ReflectCallFuncHasArgs name: &quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token string">&quot;, age:&quot;</span><span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token string">&quot;and origal User.Name:&quot;</span><span class="token punctuation">,</span> u<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>u User<span class="token punctuation">)</span> <span class="token function">ReflectCallFuncNoArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;ReflectCallFuncNoArgs&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 如何通过反射来进行方法的调用？</span>
<span class="token comment">// 本来可以用u.ReflectCallFuncXXX直接调用的，但是如果要通过反射，那么首先要将方法注册，也就是MethodByName，然后通过反射调动mv.Call</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    user <span class="token operator">:=</span> User<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;Allen.Wu&quot;</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">}</span>
    
    <span class="token comment">// 1. 要通过反射来调用起对应的方法，必须要先通过reflect.ValueOf(interface)来获取到reflect.Value，得到“反射类型对象”后才能做下一步处理</span>
    getValue <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

    <span class="token comment">// 一定要指定参数为正确的方法名</span>
    <span class="token comment">// 2. 先看看带有参数的调用方法</span>
    methodValue <span class="token operator">:=</span> getValue<span class="token punctuation">.</span><span class="token function">MethodByName</span><span class="token punctuation">(</span><span class="token string">&quot;ReflectCallFuncHasArgs&quot;</span><span class="token punctuation">)</span>
    args <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>Value<span class="token punctuation">{</span>reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span><span class="token string">&quot;wudebao&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    methodValue<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>

    <span class="token comment">// 一定要指定参数为正确的方法名</span>
    <span class="token comment">// 3. 再看看无参数的调用方法</span>
    methodValue <span class="token operator">=</span> getValue<span class="token punctuation">.</span><span class="token function">MethodByName</span><span class="token punctuation">(</span><span class="token string">&quot;ReflectCallFuncNoArgs&quot;</span><span class="token punctuation">)</span>
    args <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>Value<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    methodValue<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
<span class="token punctuation">}</span>


运行结果：
ReflectCallFuncHasArgs name<span class="token punctuation">:</span>  wudebao <span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">30</span> and origal User<span class="token punctuation">.</span>Name<span class="token punctuation">:</span> Allen<span class="token punctuation">.</span>Wu
ReflectCallFuncNoArgs
</code></pre></div><p>说明</p> <ol><li>要通过反射来调用起对应的方法，必须要先通过reflect.ValueOf(interface)来获取到reflect.Value，得到“反射类型对象”后才能做下一步处理</li> <li>reflect.Value.MethodByName这.MethodByName，需要指定准确真实的方法名字，如果错误将直接panic，MethodByName返回一个函数值对应的reflect.Value方法的名字。</li> <li>[]reflect.Value，这个是最终需要调用的方法的参数，可以没有或者一个或者多个，根据实际参数来定。</li> <li>reflect.Value的 Call 这个方法，这个方法将最终调用真实的方法，参数务必保持一致，如果reflect.Value'Kind不是一个方法，那么将直接panic。</li> <li>本来可以用u.ReflectCallFuncXXX直接调用的，但是如果要通过反射，那么首先要将方法注册，也就是MethodByName，然后通过反射调用methodValue.Call</li></ol> <h4 id="golang的反射reflect性能"><a href="#golang的反射reflect性能" class="header-anchor">#</a> Golang的反射reflect性能</h4> <p>Golang的反射很慢，这个和它的API设计有关。在 java 里面，我们一般使用反射都是这样来弄的。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Field</span> field <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getField</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
field<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>
field<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>但是Golang的反射不是这样设计的:</p> <div class="language-go extra-class"><pre class="language-go"><code>type_ <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">TypeOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
field<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> type_<span class="token punctuation">.</span><span class="token function">FieldByName</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>这里取出来的 field 对象是 reflect.StructField 类型，但是它没有办法用来取得对应对象上的值。如果要取值，得用另外一套对object，而不是type的反射</p> <div class="language-go extra-class"><pre class="language-go"><code>type_ <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
fieldValue <span class="token operator">:=</span> type_<span class="token punctuation">.</span><span class="token function">FieldByName</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>这里取出来的 fieldValue 类型是 reflect.Value，它是一个具体的值，而不是一个可复用的反射对象了，每次反射都需要malloc这个reflect.Value结构体，并且还涉及到GC。</p> <div class="language-go extra-class"><pre class="language-go"><code>Golang reflect慢主要有两个原因
 
涉及到内存分配以及后续的GC；
reflect实现里面有大量的枚举，也就是<span class="token keyword">for</span>循环，比如类型之类的<span class="token punctuation">.</span>
</code></pre></div><h4 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h4> <p>上述详细说明了Golang的反射reflect的各种功能和用法，都附带有相应的示例，相信能够在工程应用中进行相应实践，总结一下就是：</p> <ul><li><p>反射可以大大提高程序的灵活性，使得interface{}有更大的发挥余地</p></li> <li><ul><li>反射必须结合interface才玩得转</li> <li>变量的type要是concrete type的（也就是interface变量）才有反射一说</li></ul></li> <li><p>反射可以将“接口类型变量”转换为“反射类型对象”</p></li> <li><ul><li>反射使用 TypeOf 和 ValueOf 函数从接口中获取目标对象信息</li></ul></li> <li><p>反射可以将“反射类型对象”转换为“接口类型变量</p></li> <li><ul><li>reflect.value.Interface().(已知的类型)</li> <li>遍历reflect.Type的Field获取其Field</li></ul></li> <li><p>反射可以修改反射类型对象，但是其值必须是“addressable”</p></li> <li><ul><li>想要利用反射修改对象状态，前提是 interface.data 是 settable,即 pointer-interface</li></ul></li> <li><p>通过反射可以“动态”调用方法</p></li> <li><p>因为Golang本身不支持模板，因此在以往需要使用模板的场景下往往就需要使用反射(reflect)来实现</p></li></ul> <h4 id="反射的基本原理"><a href="#反射的基本原理" class="header-anchor">#</a> 反射的基本原理</h4> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501164354016.png" alt="image-20220501164354016"></p> <h2 id="结构体标签"><a href="#结构体标签" class="header-anchor">#</a> 结构体标签</h2> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;reflect&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> resume <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Name <span class="token builtin">string</span> <span class="token string">`json:&quot;name&quot; doc:&quot;我的名字&quot;`</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">findDoc</span><span class="token punctuation">(</span>stru <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token punctuation">{</span>
    t <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">TypeOf</span><span class="token punctuation">(</span>stru<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    doc <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> t<span class="token punctuation">.</span><span class="token function">NumField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        doc<span class="token punctuation">[</span>t<span class="token punctuation">.</span><span class="token function">Field</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>Tag<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">Field</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>Tag<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;doc&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> doc

<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> stru resume
    doc <span class="token operator">:=</span> <span class="token function">findDoc</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>stru<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;name字段为：%s\n&quot;</span><span class="token punctuation">,</span> doc<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="五、高阶"><a href="#五、高阶" class="header-anchor">#</a> 五、高阶</h1> <h2 id="go-modules"><a href="#go-modules" class="header-anchor">#</a> <strong>Go Modules</strong></h2> <h4 id="a、什么是go-modules"><a href="#a、什么是go-modules" class="header-anchor">#</a> A、什么是Go Modules?</h4> <p>Go modules 是 Go 语言的依赖解决方案，发布于 Go1.11，成长于 Go1.12，丰富于 Go1.13，正式于 Go1.14 推荐在生产上使用。</p> <p>Go moudles 目前集成在 Go 的工具链中，只要安装了 Go，自然而然也就可以使用 Go moudles 了，而 Go modules 的出现也解决了在 Go1.11 前的几个常见争议问题：</p> <ol><li>Go 语言长久以来的依赖管理问题。</li> <li>“淘汰”现有的 GOPATH 的使用模式。</li> <li>统一社区中的其它的依赖管理工具（提供迁移功能）。</li></ol> <h4 id="b、gopath的工作模式"><a href="#b、gopath的工作模式" class="header-anchor">#</a> B、GOPATH的工作模式</h4> <p>Go Modoules的目的之一就是淘汰GOPATH,  那么GOPATH是个什么?</p> <p>为什么在 Go1.11 前就使用 GOPATH，而 Go1.11 后就开始逐步建议使用 Go modules，不再推荐 GOPATH 的模式了呢？</p> <h5 id="_1-wait-is-gopath"><a href="#_1-wait-is-gopath" class="header-anchor">#</a> (1) Wait is GOPATH?</h5> <div class="language-go extra-class"><pre class="language-go"><code>$ <span class="token keyword">go</span> env

GOPATH<span class="token operator">=</span><span class="token string">&quot;/home/itheima/go&quot;</span>
<span class="token operator">...</span>
</code></pre></div><p>我们输入go env命令行后可以查看到 GOPATH 变量的结果，我们进入到该目录下进行查看，如下：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">go</span>
├── bin
├── pkg
└── src
    ├── github<span class="token punctuation">.</span>com
    ├── golang<span class="token punctuation">.</span>org
    ├── google<span class="token punctuation">.</span>golang<span class="token punctuation">.</span>org
    ├── gopkg<span class="token punctuation">.</span>in
    <span class="token operator">...</span><span class="token punctuation">.</span>
</code></pre></div><p>GOPATH目录下一共包含了三个子目录，分别是：</p> <ul><li>bin：存储所编译生成的二进制文件。</li> <li>pkg：存储预编译的目标文件，以加快程序的后续编译速度。</li> <li>src：存储所有<code>.go</code>文件或源代码。在编写 Go 应用程序，程序包和库时，一般会以<code>$GOPATH/src/github.com/foo/bar</code>的路径进行存放。</li></ul> <p>因此在使用 GOPATH 模式下，我们需要将应用代码存放在固定的<code>$GOPATH/src</code>目录下，并且如果执行<code>go get</code>来拉取外部依赖会自动下载并安装到<code>$GOPATH</code>目录下。</p> <h5 id="_2-gopath模式的弊端"><a href="#_2-gopath模式的弊端" class="header-anchor">#</a> (2) GOPATH模式的弊端</h5> <p>在 GOPATH 的 <code>$GOPATH/src</code> 下进行 <code>.go</code> 文件或源代码的存储，我们可以称其为 GOPATH 的模式，这个模式拥有一些弊端.</p> <ul><li><p><strong>A. 无版本控制概念.</strong> 在执行<code>go get</code>的时候，你无法传达任何的版本信息的期望，也就是说你也无法知道自己当前更新的是哪一个版本，也无法通过指定来拉取自己所期望的具体版本。</p></li> <li><p><strong>B.无法同步一致第三方版本号.</strong> 在运行 Go 应用程序的时候，你无法保证其它人与你所期望依赖的第三方库是相同的版本，也就是说在项目依赖库的管理上，你无法保证所有人的依赖版本都一致。</p></li> <li><p><strong>C.无法指定当前项目引用的第三方版本号.</strong>  你没办法处理 v1、v2、v3 等等不同版本的引用问题，因为 GOPATH 模式下的导入路径都是一样的，都是<code>github.com/foo/bar</code>。</p></li></ul> <h4 id="c、go-modules模式"><a href="#c、go-modules模式" class="header-anchor">#</a> C、Go Modules模式</h4> <p>我们接下来用Go Modules的方式创建一个项目, 建议为了与GOPATH分开,不要将项目创建在<code>GOPATH/src</code>下.</p> <h5 id="_1-go-mod命令"><a href="#_1-go-mod命令" class="header-anchor">#</a> (1) go mod命令</h5> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501165107825.png" alt="image-20220501165107825"></p> <h5 id="_2-go-mod环境变量"><a href="#_2-go-mod环境变量" class="header-anchor">#</a> (2) go mod环境变量</h5> <p>可以通过 <code>go env</code> 命令来进行查看</p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501183229680.png" alt="image-20220501183229680"></p> <div class="language-go extra-class"><pre class="language-go"><code>$ <span class="token keyword">go</span> env
GO111MODULE<span class="token operator">=</span><span class="token string">&quot;auto&quot;</span>
GOPROXY<span class="token operator">=</span><span class="token string">&quot;https://proxy.golang.org,direct&quot;</span>
GONOPROXY<span class="token operator">=</span><span class="token string">&quot;&quot;</span>
GOSUMDB<span class="token operator">=</span><span class="token string">&quot;sum.golang.org&quot;</span>
GONOSUMDB<span class="token operator">=</span><span class="token string">&quot;&quot;</span>
GOPRIVATE<span class="token operator">=</span><span class="token string">&quot;&quot;</span>
<span class="token operator">...</span>
</code></pre></div><h6 id="go111module"><a href="#go111module" class="header-anchor">#</a> GO111MODULE</h6> <p>Go语言提供了 <code>GO111MODULE</code>这个环境变量来作为 Go modules 的开关，其允许设置以下参数：</p> <ul><li>auto：只要项目包含了 go.mod 文件的话启用 Go modules，目前在 Go1.11 至 Go1.14 中仍然是默认值。</li> <li>on：启用 Go modules，推荐设置，将会是未来版本中的默认值。</li> <li>off：禁用 Go modules，不推荐设置。</li></ul> <p>可以通过来设置</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ go <span class="token function">env</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">GO111MODULE</span><span class="token operator">=</span>on
</code></pre></div><h6 id="goproxy-2"><a href="#goproxy-2" class="header-anchor">#</a> GOPROXY</h6> <p>这个环境变量主要是用于设置 Go 模块代理（Go module proxy）,其作用是用于使 Go 在后续拉取模块版本时直接通过镜像站点来快速拉取。</p> <p>GOPROXY 的默认值是：<code>https://proxy.golang.org,direct</code></p> <p><code>proxy.golang.org</code>国内访问不了,需要设置国内的代理.</p> <ul><li>阿里云
https://mirrors.aliyun.com/goproxy/</li> <li>七牛云
https://goproxy.cn,direct</li></ul> <p>如:</p> <div class="language-go extra-class"><pre class="language-go"><code>$ <span class="token keyword">go</span> env <span class="token operator">-</span>w GOPROXY<span class="token operator">=</span>https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>goproxy<span class="token punctuation">.</span>cn<span class="token punctuation">,</span>direct
</code></pre></div><p>GOPROXY 的值是一个以英文逗号 “,” 分割的 Go 模块代理列表，允许设置多个模块代理，假设你不想使用，也可以将其设置为 “off” ，这将会禁止 Go 在后续操作中使用任何 Go 模块代理。</p> <p>如:</p> <div class="language-go extra-class"><pre class="language-go"><code>$ <span class="token keyword">go</span> env <span class="token operator">-</span>w GOPROXY<span class="token operator">=</span>https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>goproxy<span class="token punctuation">.</span>cn<span class="token punctuation">,</span>https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com<span class="token operator">/</span>goproxy<span class="token operator">/</span><span class="token punctuation">,</span>direct
</code></pre></div><p>direct</p> <p>而在刚刚设置的值中，我们可以发现值列表中有 “direct” 标识，它又有什么作用呢？</p> <p>实际上 “direct” 是一个特殊指示符，用于指示 Go 回源到模块版本的源地址去抓取（比如 GitHub 等），场景如下：当值列表中上一个 Go 模块代理返回 404 或 410 错误时，Go 自动尝试列表中的下一个，遇见 “direct” 时回源，也就是回到源地址去抓取，而遇见 EOF 时终止并抛出类似 “invalid version: unknown revision...” 的错误。</p> <h6 id="修改goproxy"><a href="#修改goproxy" class="header-anchor">#</a> 修改goproxy</h6> <div class="language-go extra-class"><pre class="language-go"><code>$env<span class="token punctuation">:</span>GOPROXY <span class="token operator">=</span> <span class="token string">&quot;https://goproxy.cn,direct&quot;</span>

</code></pre></div><h6 id="gosumdb"><a href="#gosumdb" class="header-anchor">#</a> GOSUMDB</h6> <p>它的值是一个 Go checksum database，用于在拉取模块版本时（无论是从源站拉取还是通过 Go module proxy 拉取）保证拉取到的模块版本数据未经过篡改，若发现不一致，也就是可能存在篡改，将会立即中止。</p> <p>GOSUMDB 的默认值为：<code>sum.golang.org</code>，在国内也是无法访问的，但是 GOSUMDB 可以被 Go 模块代理所代理（详见：Proxying a Checksum Database）。</p> <p>因此我们可以通过设置 GOPROXY 来解决，而先前我们所设置的模块代理 <code>goproxy.cn</code> 就能支持代理 <code>sum.golang.org</code>，所以这一个问题在设置 GOPROXY 后，你可以不需要过度关心。</p> <p>另外若对 GOSUMDB 的值有自定义需求，其支持如下格式：</p> <ul><li>格式 1：<code>&lt;SUMDB_NAME&gt;+&lt;PUBLIC_KEY&gt;</code>。</li> <li>格式 2：<code>&lt;SUMDB_NAME&gt;+&lt;PUBLIC_KEY&gt; &lt;SUMDB_URL&gt;</code>。</li></ul> <p>也可以将其设置为“off”，也就是禁止 Go 在后续操作中校验模块版本。</p> <h6 id="gonoproxy-gonosumdb-goprivate"><a href="#gonoproxy-gonosumdb-goprivate" class="header-anchor">#</a> GONOPROXY/GONOSUMDB/GOPRIVATE</h6> <p>这三个环境变量都是用在当前项目依赖了私有模块，例如像是你公司的私有 git 仓库，又或是 github 中的私有库，都是属于私有模块，都是要进行设置的，否则会拉取失败。</p> <p>更细致来讲，就是依赖了由 GOPROXY 指定的 Go 模块代理或由 GOSUMDB 指定 Go checksum database 都无法访问到的模块时的场景。</p> <p>而一般<strong>建议直接设置 GOPRIVATE，它的值将作为 GONOPROXY 和 GONOSUMDB 的默认值，所以建议的最佳姿势是直接使用 GOPRIVATE</strong>。</p> <p>并且它们的值都是一个以英文逗号 “,” 分割的模块路径前缀，也就是可以设置多个，例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>$ <span class="token keyword">go</span> env <span class="token operator">-</span>w GOPRIVATE<span class="token operator">=</span><span class="token string">&quot;git.example.com,github.com/eddycjy/mquote&quot;</span>
</code></pre></div><p>设置后，前缀为 git.xxx.com 和 github.com/eddycjy/mquote 的模块都会被认为是私有模块。</p> <p>如果不想每次都重新设置，我们也可以利用通配符，例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>$ <span class="token keyword">go</span> env <span class="token operator">-</span>w GOPRIVATE<span class="token operator">=</span><span class="token string">&quot;*.example.com&quot;</span>
</code></pre></div><p>这样子设置的话，所有模块路径为 example.com 的子域名（例如：git.example.com）都将不经过 Go module proxy 和 Go checksum database，<strong>需要注意的是不包括 example.com 本身</strong>。</p> <h4 id="d、使用go-modules初始化项目"><a href="#d、使用go-modules初始化项目" class="header-anchor">#</a> D、使用Go Modules初始化项目</h4> <h5 id="_1-开启go-modules"><a href="#_1-开启go-modules" class="header-anchor">#</a> (1) 开启Go Modules</h5> <div class="language-go extra-class"><pre class="language-go"><code> $ <span class="token keyword">go</span> env <span class="token operator">-</span>w GO111MODULE<span class="token operator">=</span>on
</code></pre></div><p>又或是可以通过直接设置系统环境变量（写入对应的~/.bash_profile 文件亦可）来实现这个目的：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">GO111MODULE</span><span class="token operator">=</span>on
</code></pre></div><h5 id="_2-初始化项目"><a href="#_2-初始化项目" class="header-anchor">#</a> (2) 初始化项目</h5> <p>创建项目目录</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token environment constant">$HOME</span>/aceld/modules_test
$ <span class="token builtin class-name">cd</span> <span class="token environment constant">$HOME</span>/aceld/modules_test
</code></pre></div><p>执行Go modules 初始化</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ go mod init github.com/aceld/modules_test
go: creating new go.mod: module github.com/aceld/modules_test
</code></pre></div><p>​</p> <p>在执行 go mod init 命令时，我们指定了模块导入路径为 github.com/aceld/modules_test。接下来我们在该项目根目录下创建 main.go 文件，如下：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;github.com/aceld/zinx/znet&quot;</span>
    <span class="token string">&quot;github.com/aceld/zinx/ziface&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">//ping test 自定义路由</span>
<span class="token keyword">type</span> PingRouter <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    znet<span class="token punctuation">.</span>BaseRouter
<span class="token punctuation">}</span>

<span class="token comment">//Ping Handle</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>this <span class="token operator">*</span>PingRouter<span class="token punctuation">)</span> <span class="token function">Handle</span><span class="token punctuation">(</span>request ziface<span class="token punctuation">.</span>IRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//先读取客户端的数据</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;recv from client : msgId=&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">GetMsgID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
              <span class="token string">&quot;, data=&quot;</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">GetData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">//再回写ping...ping...ping</span>
    err <span class="token operator">:=</span> request<span class="token punctuation">.</span><span class="token function">GetConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SendBuffMsg</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;ping...ping...ping&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
      fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//1 创建一个server句柄</span>
    s <span class="token operator">:=</span> znet<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">//2 配置路由</span>
    s<span class="token punctuation">.</span><span class="token function">AddRouter</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>PingRouter<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">//3 开启服务</span>
    s<span class="token punctuation">.</span><span class="token function">Serve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>OK, 我们先不要关注代码本身,我们看当前的main.go也就是我们的<code>aceld/modules_test</code>项目,是依赖一个叫<code>github.com/aceld/zinx</code>库的. <code>znet</code>和<code>ziface</code>只是<code>zinx</code>的两个模块.</p> <p>接下来我们在<code>$HOME/aceld/modules_test</code>,本项目的根目录执行</p> <div class="language-go extra-class"><pre class="language-go"><code>$ <span class="token keyword">go</span> get github<span class="token punctuation">.</span>com<span class="token operator">/</span>aceld<span class="token operator">/</span>zinx<span class="token operator">/</span>znet

<span class="token keyword">go</span><span class="token punctuation">:</span> downloading github<span class="token punctuation">.</span>com<span class="token operator">/</span>aceld<span class="token operator">/</span>zinx v0<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token operator">-</span><span class="token number">20200221135252</span><span class="token operator">-</span>8a8954e75100
<span class="token keyword">go</span><span class="token punctuation">:</span> found github<span class="token punctuation">.</span>com<span class="token operator">/</span>aceld<span class="token operator">/</span>zinx<span class="token operator">/</span>znet in github<span class="token punctuation">.</span>com<span class="token operator">/</span>aceld<span class="token operator">/</span>zinx v0<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token operator">-</span><span class="token number">20200221135252</span><span class="token operator">-</span>8a8954e75100
</code></pre></div><p>我们会看到 我们的<code>go.mod</code>被修改,同时多了一个<code>go.sum</code>文件.</p> <h5 id="_3-查看go-mod文件"><a href="#_3-查看go-mod文件" class="header-anchor">#</a> (3) 查看go.mod文件</h5> <p>aceld/modules_test/go.mod</p> <div class="language-go extra-class"><pre class="language-go"><code>module github<span class="token punctuation">.</span>com<span class="token operator">/</span>aceld<span class="token operator">/</span>modules_test

<span class="token keyword">go</span> <span class="token number">1.14</span>

require github<span class="token punctuation">.</span>com<span class="token operator">/</span>aceld<span class="token operator">/</span>zinx v0<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token operator">-</span><span class="token number">20200221135252</span><span class="token operator">-</span>8a8954e75100 <span class="token comment">// indirect</span>
</code></pre></div><p>我们来简单看一下这里面的关键字</p> <p>module: 用于定义当前项目的模块路径</p> <p>go:标识当前Go版本.即初始化版本</p> <p>require: 当前项目依赖的一个特定的必须版本</p> <p>// indirect: 示该模块为间接依赖，也就是在当前应用程序中的 import 语句中，并没有发现这个模块的明确引用，有可能是你先手动 go get 拉取下来的，也有可能是你所依赖的模块所依赖的.我们的代码很明显是依赖的&quot;github.com/aceld/zinx/znet&quot;和&quot;github.com/aceld/zinx/ziface&quot;,所以就间接的依赖了github.com/aceld/zinx</p> <h5 id="_4-查看go-sum文件"><a href="#_4-查看go-sum文件" class="header-anchor">#</a> (4) 查看go.sum文件</h5> <p>在第一次拉取模块依赖后，会发现多出了一个 go.sum 文件，其详细罗列了当前项目直接或间接依赖的所有模块版本，并写明了那些模块版本的 SHA-256 哈希值以备 Go 在今后的操作中保证项目所依赖的那些模块版本不会被篡改</p> <div class="language-go extra-class"><pre class="language-go"><code>github<span class="token punctuation">.</span>com<span class="token operator">/</span>aceld<span class="token operator">/</span>zinx v0<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token operator">-</span><span class="token number">20200221135252</span><span class="token operator">-</span>8a8954e75100 h1<span class="token punctuation">:</span>Ez5iM6cKGMtqvIJ8nvR9h74Ln8FvFDgfb7bJIbrKv54<span class="token operator">=</span>
github<span class="token punctuation">.</span>com<span class="token operator">/</span>aceld<span class="token operator">/</span>zinx v0<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token operator">-</span><span class="token number">20200221135252</span><span class="token operator">-</span>8a8954e75100<span class="token operator">/</span><span class="token keyword">go</span><span class="token punctuation">.</span>mod h1<span class="token punctuation">:</span>bMiERrPdR8FzpBOo86nhWWmeHJ1cCaqVvWKCGcDVJ5M<span class="token operator">=</span>
github<span class="token punctuation">.</span>com<span class="token operator">/</span>golang<span class="token operator">/</span>protobuf v1<span class="token punctuation">.</span><span class="token number">3.3</span><span class="token operator">/</span><span class="token keyword">go</span><span class="token punctuation">.</span>mod h1<span class="token punctuation">:</span>vzj43D7<span class="token operator">+</span>SQXF<span class="token operator">/</span>4pzW<span class="token operator">/</span>hwtAqwc6iTitCiVSaWz5lYuqw<span class="token operator">=</span>
</code></pre></div><p>我们可以看到一个模块路径可能有如下两种：</p> <p>h1:hash情况</p> <div class="language-go extra-class"><pre class="language-go"><code>github<span class="token punctuation">.</span>com<span class="token operator">/</span>aceld<span class="token operator">/</span>zinx v0<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token operator">-</span><span class="token number">20200221135252</span><span class="token operator">-</span>8a8954e75100 h1<span class="token punctuation">:</span>Ez5iM6cKGMtqvIJ8nvR9h74Ln8FvFDgfb7bJIbrKv54<span class="token operator">=</span>
</code></pre></div><p>go.mod hash情况</p> <div class="language-go extra-class"><pre class="language-go"><code>github<span class="token punctuation">.</span>com<span class="token operator">/</span>aceld<span class="token operator">/</span>zinx v0<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token operator">-</span><span class="token number">20200221135252</span><span class="token operator">-</span>8a8954e75100<span class="token operator">/</span><span class="token keyword">go</span><span class="token punctuation">.</span>mod h1<span class="token punctuation">:</span>bMiERrPdR8FzpBOo86nhWWmeHJ1cCaqVvWKCGcDVJ5M<span class="token operator">=</span>
github<span class="token punctuation">.</span>com<span class="token operator">/</span>golang<span class="token operator">/</span>protobuf v1<span class="token punctuation">.</span><span class="token number">3.3</span><span class="token operator">/</span><span class="token keyword">go</span><span class="token punctuation">.</span>mod h1<span class="token punctuation">:</span>vzj43D7<span class="token operator">+</span>SQXF<span class="token operator">/</span>4pzW<span class="token operator">/</span>hwtAqwc6iTitCiVSaWz5lYuqw<span class="token operator">=</span>
</code></pre></div><p>h1 hash 是 Go modules 将目标模块版本的 zip 文件开包后，针对所有包内文件依次进行 hash，然后再把它们的 hash 结果按照固定格式和算法组成总的 hash 值。</p> <p>而 h1 hash 和 go.mod hash 两者，要不就是同时存在，要不就是只存在 go.mod hash。那什么情况下会不存在 h1 hash 呢，就是当 Go 认为肯定用不到某个模块版本的时候就会省略它的 h1 hash，就会出现不存在 h1 hash，只存在 go.mod hash 的情况。</p> <h4 id="e、修改模块的版本依赖关系"><a href="#e、修改模块的版本依赖关系" class="header-anchor">#</a> E、修改模块的版本依赖关系</h4> <p>​		为了作尝试,假定我们现在都zinx版本作了升级, 由<code>zinx v0.0.0-20200221135252-8a8954e75100</code> 升级到 <code>zinx v0.0.0-20200306023939-bc416543ae24</code> (注意zinx是一个没有打版本tag打第三方库,如果有的版本号是有tag的,那么可以直接对应v后面的版本号即可)</p> <p>​		那么,我们是怎么知道zinx做了升级呢, 我们又是如何知道的最新的<code>zinx</code>版本号是多少呢?</p> <p>​		先回到<code>$HOME/aceld/modules_test</code>,本项目的根目录执行</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ go get github.com/aceld/zinx/znet
go: downloading github.com/aceld/zinx v0.0.0-20200306023939-bc416543ae24
go: found github.com/aceld/zinx/znet <span class="token keyword">in</span> github.com/aceld/zinx v0.0.0-20200306023939-bc416543ae24
go: github.com/aceld/zinx upgrade <span class="token operator">=</span><span class="token operator">&gt;</span> v0.0.0-20200306023939-bc416543ae24
</code></pre></div><p>这样我们,下载了最新的zinx, 版本是<code>v0.0.0-20200306023939-bc416543ae24</code></p> <p>​		然后,我么看一下go.mod</p> <div class="language-go extra-class"><pre class="language-go"><code>module github<span class="token punctuation">.</span>com<span class="token operator">/</span>aceld<span class="token operator">/</span>modules_test

<span class="token keyword">go</span> <span class="token number">1.14</span>

require github<span class="token punctuation">.</span>com<span class="token operator">/</span>aceld<span class="token operator">/</span>zinx v0<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token operator">-</span><span class="token number">20200306023939</span><span class="token operator">-</span>bc416543ae24 <span class="token comment">// indirect</span>
</code></pre></div><p>我们会看到,当我们执行<code>go get</code> 的时候, 会自动的将本地将当前项目的<code>require</code>更新了.变成了最新的依赖.</p> <p>好了, 现在我们就要做另外一件事,就是,我们想用一个旧版本的zinx. 来修改当前<code>zinx</code>模块的依赖版本号.</p> <p>目前我们在<code>$GOPATH/pkg/mod/github.com/aceld</code>下,已经有了两个版本的zinx库</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">/</span>pkg<span class="token operator">/</span>mod<span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>aceld$ ls
zinx@v0<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token operator">-</span><span class="token number">20200221135252</span><span class="token operator">-</span>8a8954e75100
zinx@v0<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token operator">-</span><span class="token number">20200306023939</span><span class="token operator">-</span>bc416543ae24
</code></pre></div><p>​		目前,我们<code>/aceld/modules_test</code>依赖的是<code>zinx@v0.0.0-20200306023939-bc416543ae24</code> 这个是最新版, 我们要改成之前的版本<code>zinx@v0.0.0-20200306023939-bc416543ae24</code>.</p> <p>​		回到<code>/aceld/modules_test</code>项目目录下,执行</p> <div class="language-go extra-class"><pre class="language-go"><code>$ <span class="token keyword">go</span> mod edit <span class="token operator">-</span>replace<span class="token operator">=</span>zinx@v0<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token operator">-</span><span class="token number">20200306023939</span><span class="token operator">-</span>bc416543ae24<span class="token operator">=</span>zinx@v0<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token operator">-</span><span class="token number">20200221135252</span><span class="token operator">-</span>8a8954e75100
</code></pre></div><p>​	然后我们打开go.mod查看一下</p> <div class="language-go extra-class"><pre class="language-go"><code>module github<span class="token punctuation">.</span>com<span class="token operator">/</span>aceld<span class="token operator">/</span>modules_test

<span class="token keyword">go</span> <span class="token number">1.14</span>

require github<span class="token punctuation">.</span>com<span class="token operator">/</span>aceld<span class="token operator">/</span>zinx v0<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token operator">-</span><span class="token number">20200306023939</span><span class="token operator">-</span>bc416543ae24 <span class="token comment">// indirect</span>

replace zinx v0<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token operator">-</span><span class="token number">20200306023939</span><span class="token operator">-</span>bc416543ae24 <span class="token operator">=</span><span class="token operator">&gt;</span> zinx v0<span class="token punctuation">.</span><span class="token number">0.0</span><span class="token operator">-</span><span class="token number">20200221135252</span><span class="token operator">-</span>8a8954e75100
</code></pre></div><p>​	这里出现了<code>replace</code>关键字.用于将一个模块版本替换为另外一个模块版本。</p> <h2 id="goroutine"><a href="#goroutine" class="header-anchor">#</a> goroutine</h2> <h4 id="协程并发"><a href="#协程并发" class="header-anchor">#</a> 协程并发</h4> <p>协程：coroutine。也叫轻量级线程。</p> <p>与传统的系统级线程和进程相比，协程最大的优势在于“轻量级”。可以轻松创建上万个而不会导致系统资源衰竭。而线程和进程通常很难超过1万个。这也是协程别称“轻量级线程”的原因。</p> <p>一个线程中可以有任意多个协程，但某一时刻只能有一个协程在运行，<strong>多个协程分享该线程分配到的计算机资源</strong>。</p> <p>多数语言在语法层面并不直接支持协程，而是通过库的方式支持，但用库的方式支持的功能也并不完整，比如仅仅提供协程的创建、销毁与切换等能力。如果在这样的轻量级线程中调用一个同步 IO 操作，比如网络通信、本地文件读写，都会阻塞其他的并发执行轻量级线程，从而无法真正达到轻量级线程本身期望达到的目标。</p> <p>在协程中，调用一个任务就像调用一个函数一样，消耗的系统资源最少！但能达到进程、线程并发相同的效果。</p> <p>在一次并发任务中，进程、线程、协程均可以实现。从系统资源消耗的角度出发来看，进程相当多，线程次之，协程最少。</p> <h4 id="go并发"><a href="#go并发" class="header-anchor">#</a> Go并发</h4> <p>Go 在语言级别支持协程，叫goroutine。Go 语言标准库提供的所有系统调用操作（包括所有同步IO操作），都会出让CPU给其他goroutine。这让轻量级线程的切换管理不依赖于系统的线程和进程，也不需要依赖于CPU的核心数量。</p> <p>有人把Go比作21世纪的C语言。第一是因为Go语言设计简单，第二，21世纪最重要的就是并行程序设计，而Go从语言层面就支持并发。同时，并发程序的内存管理有时候是非常复杂的，而Go语言提供了自动垃圾回收机制。</p> <p>Go语言为并发编程而内置的上层API基于顺序通信进程模型CSP(communicating sequential processes)。这就意味着显式锁都是可以避免的，因为Go通过相对安全的通道发送和接受数据以实现同步，这大大地简化了并发程序的编写。</p> <p>Go语言中的并发程序主要使用两种手段来实现。goroutine和channel。</p> <h4 id="什么是goroutine"><a href="#什么是goroutine" class="header-anchor">#</a> 什么是Goroutine</h4> <p>goroutine是Go语言并行设计的核心，有人称之为go程。 Goroutine从量级上看很像协程，它比线程更小，十几个goroutine可能体现在底层就是五六个线程，Go语言内部帮你实现了这些goroutine之间的内存共享。执行goroutine只需极少的栈内存(大概是4~5KB)，当然会根据相应的数据伸缩。也正因为如此，可同时运行成千上万个并发任务。goroutine比thread更易用、更高效、更轻便。</p> <p>一般情况下，一个普通计算机跑几十个线程就有点负载过大了，但是同样的机器却可以轻松地让成百上千个goroutine进行资源竞争。</p> <h4 id="创建goroutine"><a href="#创建goroutine" class="header-anchor">#</a> 创建Goroutine</h4> <p>只需在函数调⽤语句前添加 <strong>go</strong> 关键字，就可创建并发执⾏单元。开发⼈员无需了解任何执⾏细节，调度器会自动将其安排到合适的系统线程上执行。</p> <p>在并发编程中，我们通常想将一个过程切分成几块，然后让每个goroutine各自负责一块工作，当一个程序启动时，主函数在一个单独的goroutine中运行，我们叫它main goroutine。新的goroutine会用go语句来创建。而go语言的并发设计，让我们很轻松就可以达成这一目的。</p> <p>示例代码：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main
 
<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>
 
<span class="token keyword">func</span> <span class="token function">newTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    i <span class="token operator">:=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> <span class="token punctuation">{</span>
        i<span class="token operator">++</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;new goroutine: i = %d\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span> <span class="token comment">//延时1s</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//创建一个 goroutine，启动另外一个任务</span>
    <span class="token keyword">go</span> <span class="token function">newTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    i <span class="token operator">:=</span> <span class="token number">0</span>
    <span class="token comment">//main goroutine 循环打印</span>
    <span class="token keyword">for</span> <span class="token punctuation">{</span>
        i<span class="token operator">++</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;main goroutine: i = %d\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span> <span class="token comment">//延时1s</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>程序运行结果：</p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501170148062.png" alt="image-20220501170148062"></p> <h4 id="goroutine特性"><a href="#goroutine特性" class="header-anchor">#</a> Goroutine特性</h4> <p><strong>主goroutine退出后，其它的工作goroutine也会自动退出：</strong></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main
 
<span class="token keyword">import</span> <span class="token punctuation">(</span>
<span class="token string">&quot;fmt&quot;</span>
<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>
 
<span class="token keyword">func</span> <span class="token function">newTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    i <span class="token operator">:=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> <span class="token punctuation">{</span>
        i<span class="token operator">++</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;new goroutine: i = %d\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span> <span class="token comment">//延时1s</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//创建一个 goroutine，启动另外一个任务</span>
    <span class="token keyword">go</span> <span class="token function">newTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;main goroutine exit&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>程序运行结果：</p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501170259060.png" alt="image-20220501170259060"></p> <h4 id="goexit函数"><a href="#goexit函数" class="header-anchor">#</a> Goexit函数</h4> <p>调用 runtime.Goexit() 将立即终止当前 goroutine 执⾏，调度器确保所有已注册 defer 延迟调用被执行。</p> <p>示例代码：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main
 
<span class="token keyword">import</span> <span class="token punctuation">(</span>
<span class="token string">&quot;fmt&quot;</span>
<span class="token string">&quot;runtime&quot;</span>
<span class="token punctuation">)</span>
 
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">defer</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;A.defer&quot;</span><span class="token punctuation">)</span>
 
        <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">defer</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;B.defer&quot;</span><span class="token punctuation">)</span>
            runtime<span class="token punctuation">.</span><span class="token function">Goexit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 终止当前 goroutine, import &quot;runtime&quot;</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 不会执行</span>
        <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 不会执行</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token comment">//不要忘记()</span>
 
    <span class="token comment">//死循环，目的不让主goroutine结束</span>
    <span class="token keyword">for</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>程序运行结果：</p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501170327191.png" alt="image-20220501170327191"></p> <h2 id="channel"><a href="#channel" class="header-anchor">#</a> channel</h2> <p>channel是Go语言中的一个<strong>核心类型</strong>，可以把它看成管道。并发核心单元通过它就可以发送或者接收数据进行通讯，这在一定程度上又进一步降低了编程的难度。</p> <p>channel是一个数据类型，主要用来解决go程的同步问题以及go程之间数据共享（数据传递）的问题。</p> <p>goroutine运行在相同的地址空间，因此访问共享内存必须做好同步。goroutine 奉行通过通信来共享内存，而不是共享内存来通信。</p> <p>引⽤类型 channel可用于多个 goroutine 通讯。其内部实现了同步，确保并发安全。</p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/1650606672440-8838ebc8-89bd-48af-9481-3e402623a5da.png" alt="img"></p> <h4 id="定义channel变量"><a href="#定义channel变量" class="header-anchor">#</a> 定义channel变量</h4> <p>和map类似，channel也一个对应make创建的底层数据结构的<strong>引用</strong>。</p> <p>当我们复制一个channel或用于函数参数传递时，我们只是拷贝了一个channel引用，因此调用者和被调用者将引用同一个channel对象。和其它的引用类型一样，channel的零值也是nil。</p> <p>定义一个channel时，也需要定义发送到channel的值的类型。channel可以使用内置的make()函数来创建：</p> <p><strong>chan</strong>是创建channel所需使用的关键字。Type 代表指定channel收发数据的类型。</p> <div class="language-go extra-class"><pre class="language-go"><code>    <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> Type<span class="token punctuation">)</span>  <span class="token comment">//等价于make(chan Type, 0)</span>
    <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> Type<span class="token punctuation">,</span> capacity<span class="token punctuation">)</span>
</code></pre></div><p>当我们复制一个channel或用于函数参数传递时，我们只是拷贝了一个channel引用，因此调用者和被调用者将引用同一个channel对象。和其它的引用类型一样，channel的零值也是nil。</p> <p>当 参数capacity= 0 时，channel 是无缓冲阻塞读写的；当capacity &gt; 0 时，channel 有缓冲、是非阻塞的，直到写满 capacity个元素才阻塞写入。</p> <p>channel非常像生活中的管道，一边可以存放东西，另一边可以取出东西。channel通过操作符 &lt;- 来接收和发送数据，发送和接收数据语法：</p> <div class="language-go extra-class"><pre class="language-go"><code>    channel <span class="token operator">&lt;-</span> value      <span class="token comment">//发送value到channel</span>
    <span class="token operator">&lt;-</span>channel             <span class="token comment">//接收并将其丢弃</span>
    x <span class="token operator">:=</span> <span class="token operator">&lt;-</span>channel        <span class="token comment">//从channel中接收数据，并赋值给x</span>
    x<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span>channel    <span class="token comment">//功能同上，同时检查通道是否已关闭或者是否为空</span>
</code></pre></div><p>默认情况下，channel接收和发送数据都是阻塞的，除非另一端已经准备好，这样就使得goroutine同步变的更加的简单，而<strong>不需要显式的lock。</strong></p> <p>示例代码：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main
 
<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
<span class="token punctuation">)</span>
 
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
 
    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">defer</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;子go程结束&quot;</span><span class="token punctuation">)</span>
 
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;子go程正在运行……&quot;</span><span class="token punctuation">)</span>
 
        c <span class="token operator">&lt;-</span> <span class="token number">666</span> <span class="token comment">//666发送到c</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 
    num <span class="token operator">:=</span> <span class="token operator">&lt;-</span>c <span class="token comment">//从c中接收数据，并赋值给num</span>
 
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;num = &quot;</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;main go程结束&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>程序运行结果：</p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501170541738.png" alt="image-20220501170541738"></p> <h4 id="无缓冲的channel"><a href="#无缓冲的channel" class="header-anchor">#</a> 无缓冲的channel</h4> <p>无缓冲的通道（unbuffered channel）是指在接收前没有能力保存任何数据值的通道。</p> <p>这种类型的通道要求发送goroutine和接收goroutine同时准备好，才能完成发送和接收操作。否则，通道会导致先执行发送或接收操作的 goroutine 阻塞等待。</p> <p>这种对通道进行发送和接收的交互行为本身就是同步的。其中任意一个操作都无法离开另一个操作单独存在。</p> <p>**阻塞：**由于某种原因数据没有到达，当前go程（线程）持续处于等待状态，直到条件满足，才解除阻塞。</p> <p>**同步：**在两个或多个go程（线程）间，保持数据内容一致性的机制。</p> <p>下图展示两个 goroutine 如何利用无缓冲的通道来共享一个值：</p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/1650606704122-b43e4b58-5688-4c53-a82c-fcd8073ab6cf.png" alt="img"></p> <p>在第 1 步，两个 goroutine 都到达通道，但哪个都没有开始执行发送或者接收。</p> <p>● 在第 2 步，左侧的 goroutine 将它的手伸进了通道，这模拟了向通道发送数据的行为。这时，这个 goroutine 会在通道中被锁住，直到交换完成。</p> <p>● 在第 3 步，右侧的 goroutine 将它的手放入通道，这模拟了从通道里接收数据。这个 goroutine 一样也会在通道中被锁住，直到交换完成。</p> <p>● 在第 4 步和第 5 步，进行交换，并最终，在第 6 步，两个 goroutine 都将它们的手从通道里拿出来，这模拟了被锁住的 goroutine 得到释放。两个 goroutine 现在都可以去做其他事情了。</p> <p>无缓冲的channel创建格式：</p> <div class="language-go extra-class"><pre class="language-go"><code>    <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> Type<span class="token punctuation">)</span>   <span class="token comment">//等价于make(chan Type, 0)</span>
</code></pre></div><p>如果没有指定缓冲区容量，那么该通道就是同步的，因此会阻塞到发送者准备好发送和接收者准备好接收。</p> <p>示例代码：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main
 
<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>
 
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//创建无缓冲的通道 c </span>
 
    <span class="token comment">//内置函数 len 返回未被读取的缓冲元素数量，cap 返回缓冲区大小</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;len(c)=%d, cap(c)=%d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>
 
    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">defer</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;子go程结束&quot;</span><span class="token punctuation">)</span>
 
        <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
            c <span class="token operator">&lt;-</span> i
            fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;子go程正在运行[%d]: len(c)=%d, cap(c)=%d\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 
    time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span> <span class="token comment">//延时2s</span>
 
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        num <span class="token operator">:=</span> <span class="token operator">&lt;-</span>c <span class="token comment">//从c中接收数据，并赋值给num</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;num = &quot;</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
 
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;main进程结束&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>程序运行结果：</p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501170720748.png" alt="image-20220501170720748"></p> <h4 id="有缓冲的channel"><a href="#有缓冲的channel" class="header-anchor">#</a> 有缓冲的channel</h4> <p>有缓冲的通道（buffered channel）是一种在被接收前能存储一个或者多个数据值的通道。</p> <p>这种类型的通道并不强制要求 goroutine 之间必须同时完成发送和接收。通道会阻塞发送和接收动作的条件也不同。</p> <p>只有通道中没有要接收的值时，接收动作才会阻塞。</p> <p>只有通道没有可用缓冲区容纳被发送的值时，发送动作才会阻塞。</p> <p>这导致有缓冲的通道和无缓冲的通道之间的一个很大的不同：无缓冲的通道保证进行发送和接收的 goroutine 会在同一时间进行数据交换；有缓冲的通道没有这种保证。</p> <p>示例图如下：</p> <p>通道</p> <p>通道</p> <p>2</p> <p>GOROUTINE</p> <p>GOROUTINE</p> <p>GOROUTINE</p> <p>GOROUTINE</p> <p>通道</p> <p>通道</p> <p>3</p> <p>GOROUTINE</p> <p>GOROUTINE</p> <p>GOROUTINE</p> <p>GOROUTINE</p> <p>使用有缓冲的通道在GOROUTINE之间同步数据</p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/1650606751449-c12b6106-ffbb-4f15-a83a-ff09d04754ee.png" alt="24-channel4.png"></p> <p>图片为转载</p> <p>● 在第 1 步，右侧的 goroutine 正在从通道接收一个值。</p> <p>● 在第 2 步，右侧的这个 goroutine独立完成了接收值的动作，而左侧的 goroutine 正在发送一个新值到通道里。</p> <p>● 在第 3 步，左侧的goroutine 还在向通道发送新值，而右侧的 goroutine 正在从通道接收另外一个值。这个步骤里的两个操作既不是同步的，也不会互相阻塞。</p> <p>● 最后，在第 4 步，所有的发送和接收都完成，而通道里还有几个值，也有一些空间可以存更多的值。</p> <p>有缓冲的channel创建格式：</p> <div class="language-go extra-class"><pre class="language-go"><code>    <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> Type<span class="token punctuation">,</span> capacity<span class="token punctuation">)</span>
</code></pre></div><p>如果给定了一个缓冲区容量，通道就是异步的。只要缓冲区有未使用空间用于发送数据，或还包含可以接收的数据，那么其通信就会无阻塞地进行。</p> <p>借助函数 <strong>len(ch)</strong> 求取缓冲区中剩余元素个数， <strong>cap(ch)</strong> 求取缓冲区元素容量大小。</p> <p>示例代码：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">//带缓冲的通道</span>
 
    <span class="token comment">//内置函数 len 返回未被读取的缓冲元素数量， cap 返回缓冲区大小</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;len(c)=%d, cap(c)=%d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>
 
    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">defer</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;子go程结束&quot;</span><span class="token punctuation">)</span>
 
        <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
            c <span class="token operator">&lt;-</span> i
            fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;子go程正在运行[%d]: len(c)=%d, cap(c)=%d\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 
    time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span> <span class="token comment">//延时2s</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        num <span class="token operator">:=</span> <span class="token operator">&lt;-</span>c <span class="token comment">//从c中接收数据，并赋值给num</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;num = &quot;</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;main进程结束&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>程序运行结果：</p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501170805523.png" alt="image-20220501170805523"></p> <h4 id="关闭channel"><a href="#关闭channel" class="header-anchor">#</a> 关闭channel</h4> <p>如果发送者知道，没有更多的值需要发送到channel的话，那么让接收者也能及时知道没有多余的值可接收将是有用的，因为接收者可以停止不必要的接收等待。这可以通过内置的close函数来关闭channel实现。</p> <p>示例代码：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main
 
<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
<span class="token punctuation">)</span>
 
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
 
    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
            c <span class="token operator">&lt;-</span> i
        <span class="token punctuation">}</span>
        <span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 
    <span class="token keyword">for</span> <span class="token punctuation">{</span>
        <span class="token comment">//ok为true说明channel没有关闭，为false说明管道已经关闭</span>
        <span class="token keyword">if</span> data<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span>c<span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Finished&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>程序运行结果：</p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/image-20220501170836186.png" alt="image-20220501170836186"></p> <p><strong>注意：</strong></p> <p>l channel不像文件一样需要经常去关闭，只有当你确实没有任何发送数据了，或者你想显式的结束range循环之类的，才去关闭channel；</p> <p>l 关闭channel后，无法向channel 再发送数据(引发 panic 错误后导致接收立即返回零值)；</p> <p>l 关闭channel后，可以继续从channel接收数据；</p> <p>l 对于nil channel，无论收发都会被阻塞。</p> <p>可以使用 <strong>range</strong> 来迭代不断操作channel：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main
 
<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
<span class="token punctuation">)</span>
 
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
 
    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
            c <span class="token operator">&lt;-</span> i
        <span class="token punctuation">}</span>
        <span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 
    <span class="token keyword">for</span> data <span class="token operator">:=</span> <span class="token keyword">range</span> c <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Finished&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="单向channel及应用"><a href="#单向channel及应用" class="header-anchor">#</a> 单向channel及应用</h4> <p>默认情况下，通道channel是双向的，也就是，既可以往里面发送数据也可以同里面接收数据。</p> <p>但是，我们经常见一个通道作为参数进行传递而只希望对方是单向使用的，要么只让它发送数据，要么只让它接收数据，这时候我们可以指定通道的方向。</p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/1650606808398-a8f28336-26c0-446f-b507-37805127b795.png" alt="img"></p> <p>单向channel变量的声明非常简单，如下：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> ch1 <span class="token keyword">chan</span> <span class="token builtin">int</span>       <span class="token comment">// ch1是一个正常的channel，是双向的</span>
<span class="token keyword">var</span> ch2 <span class="token keyword">chan</span><span class="token operator">&lt;-</span> <span class="token builtin">float64</span> <span class="token comment">// ch2是单向channel，只用于写float64数据</span>
<span class="token keyword">var</span> ch3 <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span>     <span class="token comment">// ch3是单向channel，只用于读int数据</span>
</code></pre></div><p>l chan&lt;- 表示数据进入管道，要把数据写进管道，对于调用者就是输出。</p> <p>l &lt;-chan 表示数据从管道出来，对于调用者就是得到管道的数据，当然就是输入。</p> <p>可以将 channel 隐式转换为单向队列，只收或只发，不能将单向 channel 转换为普通 channel：</p> <div class="language-go extra-class"><pre class="language-go"><code>    c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> send <span class="token keyword">chan</span><span class="token operator">&lt;-</span> <span class="token builtin">int</span> <span class="token operator">=</span> c <span class="token comment">// send-only</span>
    <span class="token keyword">var</span> recv <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span> <span class="token operator">=</span> c <span class="token comment">// receive-only</span>
    send <span class="token operator">&lt;-</span> <span class="token number">1</span>
    <span class="token comment">//&lt;-send //invalid operation: &lt;-send (receive from send-only type chan&lt;- int)</span>
    <span class="token operator">&lt;-</span>recv
    <span class="token comment">//recv &lt;- 2 //invalid operation: recv &lt;- 2 (send to receive-only type &lt;-chan int)</span>
 
    <span class="token comment">//不能将单向 channel 转换为普通 channel</span>
    d1 <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>send<span class="token punctuation">)</span> <span class="token comment">//cannot convert send (type chan&lt;- int) to type chan int</span>
    d2 <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>recv<span class="token punctuation">)</span> <span class="token comment">//cannot convert recv (type &lt;-chan int) to type chan int</span>
</code></pre></div><p>示例代码：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">//   chan&lt;- //只写</span>
<span class="token keyword">func</span> <span class="token function">counter</span><span class="token punctuation">(</span>out <span class="token keyword">chan</span><span class="token operator">&lt;-</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        out <span class="token operator">&lt;-</span> i <span class="token comment">//如果对方不读 会阻塞</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token comment">//   &lt;-chan //只读</span>
<span class="token keyword">func</span> <span class="token function">printer</span><span class="token punctuation">(</span>in <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> num <span class="token operator">:=</span> <span class="token keyword">range</span> in <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token comment">//   chan   //读写</span>
 
    <span class="token keyword">go</span> <span class="token function">counter</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token comment">//生产者</span>
    <span class="token function">printer</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>    <span class="token comment">//消费者</span>
 
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;done&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="select"><a href="#select" class="header-anchor">#</a> Select</h2> <h4 id="select作用"><a href="#select作用" class="header-anchor">#</a> select作用</h4> <p>Go里面提供了一个关键字select，通过select可以监听channel上的数据流动。</p> <p>有时候我们希望能够借助channel发送或接收数据，并避免因为发送或者接收导致的阻塞，尤其是当channel没有准备好写或者读时。select语句就可以实现这样的功能。</p> <p>select的用法与switch语言非常类似，由select开始一个新的选择块，每个选择条件由case语句来描述。</p> <p>与switch语句相比，select有比较多的限制，其中最大的一条限制就是每个<strong>case语句里必须是一个IO操作</strong>，大致的结构如下：</p> <div class="language-go extra-class"><pre class="language-go"><code>    <span class="token keyword">select</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token operator">&lt;-</span> chan1<span class="token punctuation">:</span>
        <span class="token comment">// 如果chan1成功读到数据，则进行该case处理语句</span>
    <span class="token keyword">case</span> chan2 <span class="token operator">&lt;-</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token comment">// 如果成功向chan2写入数据，则进行该case处理语句</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
        <span class="token comment">// 如果上面都没有成功，则进入default处理流程</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>在一个select语句中，Go语言会按顺序从头至尾评估每一个发送和接收的语句。</p> <p>如果其中的任意一语句可以继续执行(即没有被阻塞)，那么就从那些可以执行的语句中任意选择一条来使用。</p> <p>如果没有任意一条语句可以执行(即所有的通道都被阻塞)，那么有两种可能的情况：</p> <p>l 如果给出了default语句，那么就会执行default语句，同时程序的执行会从select语句后的语句中恢复。</p> <p>l 如果没有default语句，那么select语句将被阻塞，直到至少有一个通信可以进行下去。</p> <p>示例代码：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main
 
<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
<span class="token punctuation">)</span>
 
<span class="token keyword">func</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> quit <span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">,</span> y <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span>
    <span class="token keyword">for</span> <span class="token punctuation">{</span>
        <span class="token keyword">select</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> c <span class="token operator">&lt;-</span> x<span class="token punctuation">:</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> y<span class="token punctuation">,</span> x<span class="token operator">+</span>y
        <span class="token keyword">case</span> <span class="token operator">&lt;-</span>quit<span class="token punctuation">:</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;quit&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
    quit <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
 
    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>c<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        quit <span class="token operator">&lt;-</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 
    <span class="token function">fibonacci</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> quit<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>运行结果如下：</p> <p><img src="/img/ethandu/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/go%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91.assets/1650606871451-8fcc3dd6-d3fc-40c1-b781-d996c7563e53.png" alt="img"></p> <p>若有收获，就点个赞吧</p></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/05/02, 13:19:36</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/5a3138/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">C++自救指南-项目实战篇</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/5a3138/" class="prev">C++自救指南-项目实战篇</a></span> <!----></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="https://github.com/Backend-Develop-Help/Backend-Develop-Help.github.io" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2024
    <span>Backend Development | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f107c529.js" defer></script><script src="/assets/js/2.388f75b7.js" defer></script><script src="/assets/js/17.b615de32.js" defer></script>
  </body>
</html>
